{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/T7/cometa/cometa-separated-projects/cometa-frontend-nextjs/src/app/api/resources/equipment-assignments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n);\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const equipment_id = searchParams.get(\"equipment_id\");\n    const crew_id = searchParams.get(\"crew_id\");\n    const project_id = searchParams.get(\"project_id\");\n    const active_only = searchParams.get(\"active_only\") === \"true\";\n\n    let query = supabase\n      .from(\"equipment_assignments\")\n      .select(`\n        id,\n        equipment_id,\n        crew_id,\n        project_id,\n        from_ts,\n        to_ts,\n        is_permanent,\n        rental_cost_per_day,\n        is_active,\n        equipment:equipment(\n          id,\n          name,\n          type,\n          inventory_no\n        )\n      `);\n\n    if (equipment_id) {\n      query = query.eq(\"equipment_id\", equipment_id);\n    }\n\n    if (crew_id) {\n      query = query.eq(\"crew_id\", crew_id);\n    }\n\n    if (project_id) {\n      query = query.eq(\"project_id\", project_id);\n    }\n\n    if (active_only) {\n      query = query.eq(\"is_active\", true);\n    }\n\n    const { data: assignments, error } = await query.order(\"from_ts\", { ascending: false });\n\n    if (error) {\n      console.error(\"Supabase equipment assignments query error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to fetch equipment assignments\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(assignments || []);\n  } catch (error) {\n    console.error(\"Equipment assignments API error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n\n    // Validate required fields\n    if (!body.equipment_id || !body.crew_id) {\n      return NextResponse.json(\n        { error: \"Equipment ID and Crew ID are required\" },\n        { status: 400 }\n      );\n    }\n\n    const assignmentData = {\n      equipment_id: body.equipment_id,\n      crew_id: body.crew_id,\n      project_id: body.project_id || null,\n      from_ts: body.from_ts,\n      to_ts: body.to_ts || null,\n      is_permanent: body.is_permanent || false,\n      rental_cost_per_day: body.rental_cost_per_day || 0,\n      is_active: true,\n    };\n\n    const { data: assignment, error } = await supabase\n      .from(\"equipment_assignments\")\n      .insert([assignmentData])\n      .select()\n      .single();\n\n    if (error) {\n      console.error(\"Supabase equipment assignment creation error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to create equipment assignment\" },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(\n      {\n        success: true,\n        assignment_id: assignment.id,\n        message: \"Equipment assignment created successfully\",\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error(\"Equipment assignment creation API error:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,yMAAY;AAKtB,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,eAAe,aAAa,GAAG,CAAC;QACtC,MAAM,UAAU,aAAa,GAAG,CAAC;QACjC,MAAM,aAAa,aAAa,GAAG,CAAC;QACpC,MAAM,cAAc,aAAa,GAAG,CAAC,mBAAmB;QAExD,IAAI,QAAQ,SACT,IAAI,CAAC,yBACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;MAgBT,CAAC;QAEH,IAAI,cAAc;YAChB,QAAQ,MAAM,EAAE,CAAC,gBAAgB;QACnC;QAEA,IAAI,SAAS;YACX,QAAQ,MAAM,EAAE,CAAC,WAAW;QAC9B;QAEA,IAAI,YAAY;YACd,QAAQ,MAAM,EAAE,CAAC,cAAc;QACjC;QAEA,IAAI,aAAa;YACf,QAAQ,MAAM,EAAE,CAAC,aAAa;QAChC;QAEA,MAAM,EAAE,MAAM,WAAW,EAAE,KAAK,EAAE,GAAG,MAAM,MAAM,KAAK,CAAC,WAAW;YAAE,WAAW;QAAM;QAErF,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,+CAA+C;YAC7D,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwC,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,eAAe,EAAE;IAC5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2BAA2B;QAC3B,IAAI,CAAC,KAAK,YAAY,IAAI,CAAC,KAAK,OAAO,EAAE;YACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwC,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,iBAAiB;YACrB,cAAc,KAAK,YAAY;YAC/B,SAAS,KAAK,OAAO;YACrB,YAAY,KAAK,UAAU,IAAI;YAC/B,SAAS,KAAK,OAAO;YACrB,OAAO,KAAK,KAAK,IAAI;YACrB,cAAc,KAAK,YAAY,IAAI;YACnC,qBAAqB,KAAK,mBAAmB,IAAI;YACjD,WAAW;QACb;QAEA,MAAM,EAAE,MAAM,UAAU,EAAE,KAAK,EAAE,GAAG,MAAM,SACvC,IAAI,CAAC,yBACL,MAAM,CAAC;YAAC;SAAe,EACvB,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,iDAAiD;YAC/D,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwC,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,eAAe,WAAW,EAAE;YAC5B,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4CAA4C;QAC1D,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}