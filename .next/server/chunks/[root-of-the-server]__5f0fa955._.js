module.exports = [
"[project]/.next-internal/server/app/api/project-preparation/costs/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/src/lib/supabase.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "FILE_UPLOAD_CONFIG",
    ()=>FILE_UPLOAD_CONFIG,
    "STORAGE_BUCKETS",
    ()=>STORAGE_BUCKETS,
    "generateSecureFileName",
    ()=>generateSecureFileName,
    "getFileCategoryFromBucket",
    ()=>getFileCategoryFromBucket,
    "supabase",
    ()=>supabase,
    "validateFile",
    ()=>validateFile
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
// Supabase configuration
const supabaseUrl = ("TURBOPACK compile-time value", "https://oijmohlhdxoawzvctnxx.supabase.co");
const supabaseAnonKey = ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro");
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(supabaseUrl, supabaseAnonKey, {
    auth: {
        persistSession: true,
        autoRefreshToken: true
    }
});
const STORAGE_BUCKETS = {
    PROJECT_PHOTOS: process.env.SUPABASE_PROJECT_PHOTOS_BUCKET || 'project-photos',
    WORK_PHOTOS: process.env.SUPABASE_WORK_PHOTOS_BUCKET || 'work-photos',
    PROJECT_DOCUMENTS: process.env.SUPABASE_PROJECT_DOCUMENTS_BUCKET || 'project-documents',
    HOUSE_DOCUMENTS: process.env.SUPABASE_HOUSE_DOCUMENTS_BUCKET || 'house-documents',
    USER_AVATARS: process.env.SUPABASE_USER_AVATARS_BUCKET || 'user-avatars',
    REPORTS: process.env.SUPABASE_REPORTS_BUCKET || 'reports'
};
const FILE_UPLOAD_CONFIG = {
    // Maximum file size: 10MB
    MAX_FILE_SIZE: 10 * 1024 * 1024,
    // Maximum files per batch upload
    MAX_FILES_PER_BATCH: 5,
    // Allowed file types
    ALLOWED_FILE_TYPES: {
        IMAGES: [
            'image/jpeg',
            'image/png',
            'image/gif',
            'image/webp'
        ],
        DOCUMENTS: [
            'application/pdf',
            'application/msword',
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
        ],
        SPREADSHEETS: [
            'application/vnd.ms-excel',
            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
        ],
        PLANS: [
            'application/pdf',
            'application/dwg',
            'application/dxf',
            'image/jpeg',
            'image/png',
            'image/gif',
            'image/webp',
            'image/bmp',
            'image/tiff'
        ]
    },
    // Get all allowed MIME types
    getAllowedTypes: ()=>{
        const allTypes = [
            ...FILE_UPLOAD_CONFIG.ALLOWED_FILE_TYPES.IMAGES,
            ...FILE_UPLOAD_CONFIG.ALLOWED_FILE_TYPES.DOCUMENTS,
            ...FILE_UPLOAD_CONFIG.ALLOWED_FILE_TYPES.SPREADSHEETS,
            ...FILE_UPLOAD_CONFIG.ALLOWED_FILE_TYPES.PLANS
        ];
        // Remove duplicates using Set
        return [
            ...new Set(allTypes)
        ];
    }
};
const validateFile = (file)=>{
    const errors = [];
    // Check file size
    if (file.size > FILE_UPLOAD_CONFIG.MAX_FILE_SIZE) {
        errors.push(`File size must be less than ${FILE_UPLOAD_CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB`);
    }
    // Check file type
    const allowedTypes = FILE_UPLOAD_CONFIG.getAllowedTypes();
    console.log('🔍 File validation:', {
        fileName: file.name,
        fileType: file.type,
        allowedTypes,
        isTypeAllowed: allowedTypes.includes(file.type)
    });
    if (!allowedTypes.includes(file.type)) {
        errors.push(`File type ${file.type} is not allowed`);
    }
    return {
        isValid: errors.length === 0,
        errors
    };
};
const generateSecureFileName = (originalFileName, userId)=>{
    const timestamp = Date.now();
    const randomString = Math.random().toString(36).substring(2, 15);
    const fileExtension = originalFileName.split('.').pop();
    const baseName = originalFileName.split('.')[0].toLowerCase().replace(/[^a-z0-9]/g, '-');
    const prefix = userId ? `${userId}_` : '';
    return `${prefix}${baseName}_${timestamp}_${randomString}.${fileExtension}`;
};
const getFileCategoryFromBucket = (bucketName)=>{
    const bucketMap = {
        [STORAGE_BUCKETS.PROJECT_PHOTOS]: 'project-photo',
        [STORAGE_BUCKETS.WORK_PHOTOS]: 'work-photo',
        [STORAGE_BUCKETS.PROJECT_DOCUMENTS]: 'project-document',
        [STORAGE_BUCKETS.HOUSE_DOCUMENTS]: 'house-document',
        [STORAGE_BUCKETS.USER_AVATARS]: 'user-avatar',
        [STORAGE_BUCKETS.REPORTS]: 'report'
    };
    return bucketMap[bucketName] || 'unknown';
};
}),
"[project]/src/app/api/project-preparation/costs/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/supabase.ts [app-route] (ecmascript)");
;
;
async function GET(request) {
    try {
        const searchParams = request.nextUrl.searchParams;
        const projectId = searchParams.get('project_id');
        if (!projectId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Project ID is required'
            }, {
                status: 400
            });
        }
        // Get project costs from various sources
        const [projectRes, facilitiesRes, equipmentRes, materialRes, laborRes] = await Promise.all([
            // Project information
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('projects').select('id, name, budget').eq('id', projectId).single(),
            // Facilities costs
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('facilities').select('*').eq('project_id', projectId),
            // Equipment assignment costs
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('equipment_assignments').select(`
          *,
          equipment:equipment_id (
            id,
            name,
            type,
            daily_rate
          )
        `).eq('project_id', projectId),
            // Material allocation costs
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('material_allocations').select(`
          *,
          materials:material_id (
            id,
            name,
            price_per_unit,
            unit
          )
        `).eq('project_id', projectId),
            // Labor costs from work entries
            __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$supabase$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["supabase"].from('work_entries').select('*').eq('project_id', projectId)
        ]);
        if (projectRes.error) {
            console.error('Project query error:', projectRes.error);
        }
        if (facilitiesRes.error) {
            console.error('Facilities costs query error:', facilitiesRes.error);
        }
        if (equipmentRes.error) {
            console.error('Equipment costs query error:', equipmentRes.error);
        }
        if (materialRes.error) {
            console.error('Material costs query error:', materialRes.error);
        }
        if (laborRes.error) {
            console.error('Labor costs query error:', laborRes.error);
        }
        // Calculate totals
        const facilityCosts = (facilitiesRes.data || []).reduce((total, facility)=>{
            const dailyRate = parseFloat(facility.rent_daily_eur || 0);
            const days = facility.start_date && facility.end_date ? Math.ceil((new Date(facility.end_date).getTime() - new Date(facility.start_date).getTime()) / (1000 * 60 * 60 * 24)) : 0;
            return total + dailyRate * days;
        }, 0);
        const equipmentCosts = (equipmentRes.data || []).reduce((total, assignment)=>{
            const dailyRate = parseFloat(assignment.equipment?.daily_rate || 0);
            const days = assignment.assigned_at && assignment.returned_at ? Math.ceil((new Date(assignment.returned_at).getTime() - new Date(assignment.assigned_at).getTime()) / (1000 * 60 * 60 * 24)) : 30 // Default 30 days if still assigned
            ;
            return total + dailyRate * days;
        }, 0);
        const materialCosts = (materialRes.data || []).reduce((total, allocation)=>{
            const pricePerUnit = parseFloat(allocation.materials?.price_per_unit || 0);
            const quantity = parseFloat(allocation.allocated_quantity || 0);
            return total + pricePerUnit * quantity;
        }, 0);
        const laborCosts = (laborRes.data || []).reduce((total, entry)=>{
            return total + parseFloat(entry.labor_cost || 0);
        }, 0);
        const totalCosts = facilityCosts + equipmentCosts + materialCosts + laborCosts;
        const projectBudget = parseFloat(projectRes.data?.budget || 0);
        const remainingBudget = projectBudget - totalCosts;
        const budgetUtilized = projectBudget > 0 ? totalCosts / projectBudget * 100 : 0;
        const costs = {
            project: {
                id: projectRes.data?.id,
                name: projectRes.data?.name,
                budget: projectBudget,
                remaining_budget: remainingBudget,
                budget_utilized_percentage: budgetUtilized
            },
            facilities: {
                items: facilitiesRes.data || [],
                total: facilityCosts
            },
            equipment: {
                items: equipmentRes.data || [],
                total: equipmentCosts
            },
            materials: {
                items: materialRes.data || [],
                total: materialCosts
            },
            labor: {
                items: laborRes.data || [],
                total: laborCosts
            },
            summary: {
                facilities: facilityCosts,
                equipment: equipmentCosts,
                materials: materialCosts,
                labor: laborCosts,
                total: totalCosts
            }
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(costs);
    } catch (error) {
        console.error('Project costs error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch project costs'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__5f0fa955._.js.map