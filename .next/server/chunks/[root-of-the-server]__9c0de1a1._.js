module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},95266,(e,t,r)=>{},92792,e=>{"use strict";e.s(["handler",()=>q,"patchFetch",()=>I,"routeModule",()=>A,"serverHooks",()=>N,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>E],92792);var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),i=e.i(69741),s=e.i(16795),l=e.i(87718),d=e.i(95169),c=e.i(47587),u=e.i(66012),p=e.i(70101),m=e.i(26937),_=e.i(10372),f=e.i(93695);e.i(52474);var g=e.i(220);e.s(["GET",()=>j,"POST",()=>w],46108);var y=e.i(89171),x=e.i(87464),h=e.i(69719);let v=(0,x.createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro"),R=h.z.object({project_id:h.z.string().uuid("Invalid project ID").optional(),filename:h.z.string().min(1,"Filename is required"),original_filename:h.z.string().optional(),file_type:h.z.string().optional(),file_size:h.z.number().positive().optional(),document_type:h.z.string().default("general"),category_id:h.z.string().uuid("Invalid category ID").optional(),description:h.z.string().optional(),uploaded_by:h.z.string().uuid("Invalid user ID").optional(),is_active:h.z.boolean().default(!0)});async function j(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("per_page")||"20"),n=(r-1)*a,o=t.get("project_id"),i=t.get("document_type"),s=t.get("category_id"),l=t.get("file_type"),d=t.get("uploaded_by"),c=t.get("search"),u=t.get("is_active"),p=t.get("date_from"),m=t.get("date_to"),_=v.from("documents").select(`
        id,
        project_id,
        filename,
        original_filename,
        file_type,
        file_size,
        document_type,
        category_id,
        description,
        upload_date,
        uploaded_by,
        is_active,
        created_at,
        updated_at,
        projects(id, name, city),
        document_categories(id, code, name_de, name_ru, name_en),
        users:users!documents_uploaded_by_fkey(id, first_name, last_name, email)
      `,{count:"exact"}).order("upload_date",{ascending:!1}).range(n,n+a-1);o&&(_=_.eq("project_id",o)),i&&(_=_.eq("document_type",i)),s&&(_=_.eq("category_id",s)),l&&(_=_.eq("file_type",l)),d&&(_=_.eq("uploaded_by",d)),null!==u&&(_=_.eq("is_active","true"===u)),p&&(_=_.gte("upload_date",p)),m&&(_=_.lte("upload_date",m)),c&&(_=_.or(`filename.ilike.%${c}%,original_filename.ilike.%${c}%,description.ilike.%${c}%,document_type.ilike.%${c}%`));let{data:f,error:g,count:x}=await _;if(g)return console.error("Supabase error:",g),y.NextResponse.json({error:"Failed to fetch documents from database"},{status:500});let h=(f||[]).map(e=>{let t=Array.isArray(e.projects)?e.projects[0]:e.projects,r=Array.isArray(e.document_categories)?e.document_categories[0]:e.document_categories,a=Array.isArray(e.users)?e.users[0]:e.users;return{...e,project_name:t?.name||"No Project",project_city:t?.city||"Unknown City",category_name:r?.name_en||r?.name_de||"Uncategorized",category_code:r?.code||null,uploader_name:a?`${a.first_name} ${a.last_name}`:"Unknown User",uploader_email:a?.email||null,file_size_mb:e.file_size?(e.file_size/1048576).toFixed(2):null,upload_date_formatted:e.upload_date?new Date(e.upload_date).toLocaleDateString():null}}),R=h.reduce((e,t)=>(e[t.document_type]=(e[t.document_type]||0)+1,e),{}),j=h.reduce((e,t)=>(t.file_type&&(e[t.file_type]=(e[t.file_type]||0)+1),e),{}),w=h.reduce((e,t)=>e+(t.file_size||0),0);return y.NextResponse.json({items:h,total:x||0,page:r,per_page:a,total_pages:Math.ceil((x||0)/a),summary:{document_type_counts:R,file_type_counts:j,total_size_bytes:w,total_size_mb:(w/1048576).toFixed(2),active_documents:h.filter(e=>e.is_active).length,inactive_documents:h.filter(e=>!e.is_active).length}})}catch(e){return console.error("Documents API error:",e),y.NextResponse.json({error:"Failed to fetch documents"},{status:500})}}async function w(e){try{let t=await e.json(),r=R.safeParse(t);if(!r.success)return y.NextResponse.json({error:"Validation failed",details:r.error.issues},{status:400});let a=r.data;if(a.project_id){let{data:e,error:t}=await v.from("projects").select("id, name").eq("id",a.project_id).single();if(t||!e)return y.NextResponse.json({error:"Project not found"},{status:404})}if(a.category_id){let{data:e,error:t}=await v.from("document_categories").select("id, code").eq("id",a.category_id).single();if(t||!e)return y.NextResponse.json({error:"Document category not found"},{status:404})}if(a.uploaded_by){let{data:e,error:t}=await v.from("users").select("id, first_name, last_name").eq("id",a.uploaded_by).single();if(t||!e)return y.NextResponse.json({error:"User not found"},{status:404})}if(a.project_id&&a.filename){let{data:e,error:t}=await v.from("documents").select("id").eq("project_id",a.project_id).eq("filename",a.filename).eq("is_active",!0).maybeSingle();if(t)return console.error("Duplicate check error:",t),y.NextResponse.json({error:"Failed to check for duplicate document"},{status:500});if(e)return y.NextResponse.json({error:"Document with this filename already exists in the project"},{status:409})}let n={...a,upload_date:new Date().toISOString()},{data:o,error:i}=await v.from("documents").insert([n]).select(`
        id,
        project_id,
        filename,
        original_filename,
        file_type,
        file_size,
        document_type,
        category_id,
        description,
        upload_date,
        uploaded_by,
        is_active,
        created_at,
        updated_at,
        projects(id, name, city),
        document_categories(id, code, name_de, name_ru, name_en),
        users:users!documents_uploaded_by_fkey(id, first_name, last_name, email)
      `).single();if(i)return console.error("Supabase error creating document:",i),y.NextResponse.json({error:"Failed to create document record in database"},{status:500});let s=Array.isArray(o.projects)?o.projects[0]:o.projects,l=Array.isArray(o.document_categories)?o.document_categories[0]:o.document_categories,d=Array.isArray(o.users)?o.users[0]:o.users,c={...o,project_name:s?.name||"No Project",project_city:s?.city||"Unknown City",category_name:l?.name_en||l?.name_de||"Uncategorized",category_code:l?.code||null,uploader_name:d?`${d.first_name} ${d.last_name}`:"Unknown User",uploader_email:d?.email||null,file_size_mb:o.file_size?(o.file_size/1048576).toFixed(2):null};return y.NextResponse.json({message:"Document created successfully",document:c},{status:201})}catch(e){return console.error("Create document error:",e),y.NextResponse.json({error:"Failed to create document"},{status:500})}}var b=e.i(46108);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/documents/route",pathname:"/api/documents",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/documents/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:C,workUnitAsyncStorage:E,serverHooks:N}=A;function I(){return(0,a.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:E})}async function q(e,t,a){var y;let x="/api/documents/route";x=x.replace(/\/index$/,"")||"/";let h=await A.prepare(e,t,{srcPage:x,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:j,isDraftMode:w,prerenderManifest:b,routerServerContext:C,isOnDemandRevalidate:E,revalidateOnlyGenerated:N,resolvedPathname:I}=h,q=(0,i.normalizeAppPath)(x),k=!!(b.dynamicRoutes[q]||b.routes[I]);if(k&&!w){let e=!!b.routes[I],t=b.dynamicRoutes[q];if(t&&!1===t.fallback&&!e)throw new f.NoFallbackError}let z=null;!k||A.isDev||w||(z="/index"===(z=I)?"/":z);let P=!0===A.isDev||!k,U=k&&!P,S=e.method||"GET",O=(0,o.getTracer)(),D=O.getActiveScopeSpan(),T={params:R,prerenderManifest:b,renderOpts:{experimental:{cacheComponents:!!j.experimental.cacheComponents,authInterrupts:!!j.experimental.authInterrupts},supportsDynamicResponse:P,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(y=j.experimental)?void 0:y.cacheLife,isRevalidate:U,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>A.onRequestError(e,t,a,C)},sharedContext:{buildId:v}},F=new s.NodeNextRequest(e),M=new s.NodeNextResponse(t),H=l.NextRequestAdapter.fromNodeNextRequest(F,(0,l.signalFromNodeResponse)(t));try{let i=async r=>A.handle(H,T).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=O.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${S} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${S} ${e.url}`)}),s=async o=>{var s,l;let d=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&E&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(o);e.fetchMetrics=T.renderOpts.fetchMetrics;let l=T.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=T.renderOpts.collectedTags;if(!k)return await (0,u.sendResponse)(F,M,s,T.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[_.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==T.renderOpts.collectedRevalidate&&!(T.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&T.renderOpts.collectedRevalidate,a=void 0===T.renderOpts.collectedExpire||T.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:T.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:E})},C),t}},f=await A.handleResponse({req:e,nextConfig:j,cacheKey:z,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:E,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:a.waitUntil});if(!k)return null;if((null==f||null==(s=f.value)?void 0:s.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(l=f.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",E?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,p.fromNodeOutgoingHttpHeaders)(f.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&k||y.delete(_.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,m.getCacheControlHeader)(f.cacheControl)),await (0,u.sendResponse)(F,M,new Response(f.value.body,{headers:y,status:f.value.status||200})),null};D?await s(D):await O.withPropagatedContext(e.headers,()=>O.trace(d.BaseServerSpan.handleRequest,{spanName:`${S} ${e.url}`,kind:o.SpanKind.SERVER,attributes:{"http.method":S,"http.target":e.url}},s))}catch(t){if(D||t instanceof f.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:E})}),k)throw t;return await (0,u.sendResponse)(F,M,new Response(null,{status:500})),null}}},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9c0de1a1._.js.map