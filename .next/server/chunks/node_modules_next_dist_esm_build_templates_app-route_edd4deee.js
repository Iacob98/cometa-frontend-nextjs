module.exports=[91648,e=>{"use strict";e.s(["handler",()=>T,"patchFetch",()=>q,"routeModule",()=>E,"serverHooks",()=>I,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>A],91648);var t=e.i(47909),n=e.i(74017),o=e.i(96250),r=e.i(59756),s=e.i(61916),i=e.i(69741),a=e.i(16795),u=e.i(87718),l=e.i(95169),d=e.i(47587),c=e.i(66012),p=e.i(70101),h=e.i(26937),_=e.i(10372),m=e.i(93695);e.i(52474);var f=e.i(220);e.s(["DELETE",()=>v,"GET",()=>x,"PUT",()=>b],48570);var g=e.i(89171),R=e.i(87464),y=e.i(69719);let w=(0,R.createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro"),j=y.z.object({project_id:y.z.string().uuid("Invalid project ID").optional(),house_id:y.z.string().uuid("Invalid house ID").optional(),unit_number:y.z.string().optional(),unit_type:y.z.enum(["apartment","office","commercial","basement","attic"]).optional(),floor:y.z.number().int().optional(),room_count:y.z.number().int().min(1).optional(),area_sqm:y.z.number().positive().optional(),contact_person:y.z.string().optional(),contact_phone:y.z.string().optional(),access_instructions:y.z.string().optional(),installation_notes:y.z.string().optional(),status:y.z.enum(["pending","scheduled","in_progress","completed","cancelled"]).optional()});async function x(e,{params:t}){try{let{id:e}=await t;if(!e)return g.NextResponse.json({error:"Housing unit ID is required"},{status:400});let{data:n,error:o}=await w.from("housing_units").select(`
        id,
        project_id,
        house_id,
        unit_number,
        unit_type,
        floor,
        room_count,
        area_sqm,
        contact_person,
        contact_phone,
        access_instructions,
        installation_notes,
        status,
        created_at,
        updated_at,
        projects(id, name, city),
        houses(id, street, city, house_number, postal_code),
        housing_allocations(
          id,
          crew_id,
          user_id,
          allocation_date,
          status,
          notes,
          crews(id, name),
          users(id, first_name, last_name, email)
        )
      `).eq("id",e).single();if(o){if("PGRST116"===o.code)return g.NextResponse.json({error:"Housing unit not found"},{status:404});return console.error("Supabase error:",o),g.NextResponse.json({error:"Failed to fetch housing unit from database"},{status:500})}let r=Array.isArray(n.projects)?n.projects[0]:n.projects,s=Array.isArray(n.houses)?n.houses[0]:n.houses,i={...n,project_name:r?.name||"Unknown Project",project_city:r?.city||"Unknown City",house_street:s?.street||"Unknown Street",house_city:s?.city||"Unknown City",house_number:s?.house_number||null,postal_code:s?.postal_code||null,full_address:s?.street&&s?.house_number?`${s.street} ${s.house_number}, ${s.city||""}`:s?.street||"Unknown Address",allocations_count:n.housing_allocations?.length||0};return g.NextResponse.json(i)}catch(e){return console.error("Housing unit GET error:",e),g.NextResponse.json({error:"Failed to fetch housing unit"},{status:500})}}async function b(e,{params:t}){try{let{id:n}=await t,o=await e.json();if(!n)return g.NextResponse.json({error:"Housing unit ID is required"},{status:400});let r=j.safeParse(o);if(!r.success)return g.NextResponse.json({error:"Validation failed",details:r.error.issues},{status:400});let s=r.data,{data:i,error:a}=await w.from("housing_units").select("id, project_id, house_id, unit_number").eq("id",n).single();if(a||!i)return g.NextResponse.json({error:"Housing unit not found"},{status:404});if(s.project_id&&s.project_id!==i.project_id){let{data:e,error:t}=await w.from("projects").select("id, name, city").eq("id",s.project_id).single();if(t||!e)return g.NextResponse.json({error:"Project not found"},{status:404})}if(s.house_id&&s.house_id!==i.house_id){let{data:e,error:t}=await w.from("houses").select("id, address").eq("id",s.house_id).single();if(t||!e)return g.NextResponse.json({error:"House not found"},{status:404})}let u=s.house_id||i.house_id,l=s.unit_number||i.unit_number;if(u&&l&&(s.house_id!==i.house_id||s.unit_number!==i.unit_number)){let{data:e,error:t}=await w.from("housing_units").select("id").eq("house_id",u).eq("unit_number",l).neq("id",n).maybeSingle();if(t)return console.error("Duplicate check error:",t),g.NextResponse.json({error:"Failed to check for duplicate unit"},{status:500});if(e)return g.NextResponse.json({error:"Unit number already exists in this house"},{status:409})}let d={};for(let e of["project_id","house_id","unit_number","unit_type","floor","room_count","area_sqm","contact_person","contact_phone","access_instructions","installation_notes","status"])void 0!==s[e]&&(d[e]=s[e]);if(0===Object.keys(d).length)return g.NextResponse.json({error:"No valid fields to update"},{status:400});d.updated_at=new Date().toISOString();let{data:c,error:p}=await w.from("housing_units").update(d).eq("id",n).select(`
        id,
        project_id,
        house_id,
        unit_number,
        unit_type,
        floor,
        room_count,
        area_sqm,
        contact_person,
        contact_phone,
        access_instructions,
        installation_notes,
        status,
        created_at,
        updated_at,
        projects(id, name, city),
        houses(id, street, city, house_number, postal_code)
      `).single();if(p)return console.error("Supabase update error:",p),g.NextResponse.json({error:"Failed to update housing unit"},{status:500});let h=Array.isArray(c.projects)?c.projects[0]:c.projects,_=Array.isArray(c.houses)?c.houses[0]:c.houses,m={...c,project_name:h?.name||"Unknown Project",project_city:h?.city||"Unknown City",house_street:_?.street||"Unknown Street",house_city:_?.city||"Unknown City",house_number:_?.house_number||null,postal_code:_?.postal_code||null,full_address:_?.street&&_?.house_number?`${_.street} ${_.house_number}, ${_.city||""}`:_?.street||"Unknown Address"};return g.NextResponse.json({message:"Housing unit updated successfully",housing_unit:m})}catch(e){return console.error("Housing unit PUT error:",e),g.NextResponse.json({error:"Failed to update housing unit"},{status:500})}}async function v(e,{params:t}){try{let{id:e}=await t;if(!e)return g.NextResponse.json({error:"Housing unit ID is required"},{status:400});let{data:n,error:o}=await w.from("housing_units").select("id, unit_number, unit_type").eq("id",e).single();if(o||!n)return g.NextResponse.json({error:"Housing unit not found"},{status:404});let{count:r,error:s}=await w.from("housing_allocations").select("*",{count:"exact",head:!0}).eq("housing_unit_id",e);if(s)return console.error("Allocations check error:",s),g.NextResponse.json({error:"Failed to check housing unit dependencies"},{status:500});if(r&&r>0)return g.NextResponse.json({error:"Cannot delete housing unit with active allocations",details:`This housing unit has ${r} allocation(s). Remove allocations first.`},{status:409});let{error:i}=await w.from("housing_units").delete().eq("id",e);if(i)return console.error("Supabase delete error:",i),g.NextResponse.json({error:"Failed to delete housing unit"},{status:500});return g.NextResponse.json({message:"Housing unit deleted successfully",deleted_housing_unit:{id:n.id,unit_number:n.unit_number,unit_type:n.unit_type}})}catch(e){return console.error("Housing unit DELETE error:",e),g.NextResponse.json({error:"Failed to delete housing unit"},{status:500})}}var N=e.i(48570);let E=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/housing-units/[id]/route",pathname:"/api/housing-units/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/housing-units/[id]/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:C,workUnitAsyncStorage:A,serverHooks:I}=E;function q(){return(0,o.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:A})}async function T(e,t,o){var g;let R="/api/housing-units/[id]/route";R=R.replace(/\/index$/,"")||"/";let y=await E.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:w,params:j,nextConfig:x,isDraftMode:b,prerenderManifest:v,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:I}=y,q=(0,i.normalizeAppPath)(R),T=!!(v.dynamicRoutes[q]||v.routes[I]);if(T&&!b){let e=!!v.routes[I],t=v.dynamicRoutes[q];if(t&&!1===t.fallback&&!e)throw new m.NoFallbackError}let U=null;!T||E.isDev||b||(U="/index"===(U=I)?"/":U);let H=!0===E.isDev||!T,S=T&&!H,k=e.method||"GET",P=(0,s.getTracer)(),O=P.getActiveScopeSpan(),D={params:j,prerenderManifest:v,renderOpts:{experimental:{cacheComponents:!!x.experimental.cacheComponents,authInterrupts:!!x.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(g=x.experimental)?void 0:g.cacheLife,isRevalidate:S,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,o)=>E.onRequestError(e,t,o,N)},sharedContext:{buildId:w}},z=new a.NodeNextRequest(e),F=new a.NodeNextResponse(t),M=u.NextRequestAdapter.fromNodeNextRequest(z,(0,u.signalFromNodeResponse)(t));try{let i=async n=>E.handle(M,D).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=P.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=o.get("next.route");if(r){let e=`${k} ${r}`;n.setAttributes({"next.route":r,"http.route":r,"next.span_name":e}),n.updateName(e)}else n.updateName(`${k} ${e.url}`)}),a=async s=>{var a,u;let l=async({previousCacheEntry:n})=>{try{if(!(0,r.getRequestMeta)(e,"minimalMode")&&C&&A&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await i(s);e.fetchMetrics=D.renderOpts.fetchMetrics;let u=D.renderOpts.pendingWaitUntil;u&&o.waitUntil&&(o.waitUntil(u),u=void 0);let l=D.renderOpts.collectedTags;if(!T)return await (0,c.sendResponse)(z,F,a,D.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[_.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==D.renderOpts.collectedRevalidate&&!(D.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&D.renderOpts.collectedRevalidate,o=void 0===D.renderOpts.collectedExpire||D.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:D.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==n?void 0:n.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:S,isOnDemandRevalidate:C})},N),t}},m=await E.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:v,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:l,waitUntil:o.waitUntil});if(!T)return null;if((null==m||null==(a=m.value)?void 0:a.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==m||null==(u=m.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,r.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",C?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,p.fromNodeOutgoingHttpHeaders)(m.value.headers);return(0,r.getRequestMeta)(e,"minimalMode")&&T||g.delete(_.NEXT_CACHE_TAGS_HEADER),!m.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,h.getCacheControlHeader)(m.cacheControl)),await (0,c.sendResponse)(z,F,new Response(m.value.body,{headers:g,status:m.value.status||200})),null};O?await a(O):await P.withPropagatedContext(e.headers,()=>P.trace(l.BaseServerSpan.handleRequest,{spanName:`${k} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},a))}catch(t){if(O||t instanceof m.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:S,isOnDemandRevalidate:C})}),T)throw t;return await (0,c.sendResponse)(z,F,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_edd4deee.js.map