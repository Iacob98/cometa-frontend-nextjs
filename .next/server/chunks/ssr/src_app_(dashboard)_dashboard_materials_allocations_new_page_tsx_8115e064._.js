module.exports=[21564,a=>{"use strict";a.s(["default",()=>E],21564);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95245),f=a.i(59501),g=a.i(56757),h=a.i(210),i=a.i(14548),j=a.i(33508),k=a.i(83497);let l=(0,a.i(70106).default)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);var m=a.i(73570),n=a.i(99570),o=a.i(66718),p=a.i(91119),q=a.i(41921),r=a.i(80701),s=a.i(29246),t=a.i(65151),u=a.i(68114);let v=c.createContext({}),w=c.forwardRef(({className:a,value:c,onValueChange:d,name:e,...f},g)=>(0,b.jsx)(v.Provider,{value:{value:c,onValueChange:d,name:e},children:(0,b.jsx)("div",{className:(0,u.cn)("grid gap-2",a),ref:g,role:"radiogroup",...f})}));w.displayName="RadioGroup";let x=c.forwardRef(({className:a,value:d,...e},f)=>{let g=c.useContext(v),h=g.value===d;return(0,b.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,b.jsx)("input",{ref:f,type:"radio",value:d,checked:h,onChange:a=>{a.target.checked&&g.onValueChange&&g.onValueChange(d)},name:g.name,className:"sr-only",...e}),(0,b.jsx)("div",{className:(0,u.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 flex items-center justify-center",a),children:h&&(0,b.jsx)(t.Circle,{className:"h-2.5 w-2.5 fill-current text-current"})})]})});x.displayName="RadioGroupItem";var y=a.i(70430),z=a.i(7671),A=a.i(86456),B=a.i(38408),C=a.i(40533);let D=g.z.object({material_id:g.z.string().min(1,"Material is required"),allocation_type:g.z.enum(["project","crew"],{required_error:"Please select allocation type"}),project_id:g.z.string().optional(),crew_id:g.z.string().optional(),allocated_qty:g.z.coerce.number().min(.001,"Quantity must be greater than 0"),allocation_date:g.z.string().min(1,"Allocation date is required"),notes:g.z.string().optional()}).refine(a=>("project"!==a.allocation_type||!!a.project_id)&&("crew"!==a.allocation_type||!!a.crew_id),{message:"Please select a target for allocation",path:["allocation_type"]});function E(){let a=(0,d.useRouter)(),g=(0,C.useCreateAllocation)(),[t,u]=(0,c.useState)(null),{data:v}=(0,z.useMaterials)({per_page:1e3}),{data:E}=(0,A.useProjects)({status:"active"}),{data:F}=(0,B.useCrews)(),G=(0,e.useForm)({resolver:(0,f.zodResolver)(D),defaultValues:{material_id:"",allocation_type:"project",project_id:"",crew_id:"",allocated_qty:0,allocation_date:new Date().toISOString().split("T")[0],notes:""}}),H=G.watch(),{allocated_qty:I,allocation_type:J}=H,K=v?.items?.find(a=>a.id===H.material_id),L=K?K.current_stock_qty-K.reserved_qty:0,M=K&&I?I*K.default_price_eur:0,N=L-(I||0),O=a=>{u(v?.items?.find(b=>b.id===a)),G.setValue("material_id",a),G.setValue("allocated_qty",0)},P=a=>{G.setValue("allocation_type",a),"project"===a?G.setValue("crew_id",""):"crew"===a&&G.setValue("project_id","")},Q=async b=>{try{let c={material_id:b.material_id,project_id:"project"===b.allocation_type?b.project_id:void 0,crew_id:"crew"===b.allocation_type?b.crew_id:void 0,allocated_qty:b.allocated_qty,allocation_date:b.allocation_date,notes:b.notes,allocated_by:"6f3da2a8-7cd6-4f9e-84fb-9669a41e85bb"};await g.mutateAsync(c),a.push("/dashboard/materials/allocations")}catch(a){console.error("Failed to create allocation:",a)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:()=>a.back(),className:"flex items-center space-x-2",children:[(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Back"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Material Allocation"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Allocate materials from warehouse to projects or crews"})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)(p.Card,{children:[(0,b.jsxs)(p.CardHeader,{children:[(0,b.jsxs)(p.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(k.Package,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Allocation Details"})]}),(0,b.jsx)(p.CardDescription,{children:"Select material and target for allocation"})]}),(0,b.jsx)(p.CardContent,{children:(0,b.jsx)(q.Form,{...G,children:(0,b.jsxs)("form",{onSubmit:G.handleSubmit(Q),className:"space-y-6",children:[(0,b.jsx)(q.FormField,{control:G.control,name:"material_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Material *"}),(0,b.jsxs)(r.Select,{onValueChange:O,value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.SelectTrigger,{children:(0,b.jsx)(r.SelectValue,{placeholder:"Select material"})})}),(0,b.jsx)(r.SelectContent,{children:v?.items?.filter(a=>a.current_stock_qty-a.reserved_qty>0)?.map(a=>{let c=a.current_stock_qty-a.reserved_qty;return(0,b.jsx)(r.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,b.jsx)("span",{children:a.name}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground ml-2",children:[c.toFixed(2)," ",a.unit," available"]})]})},a.id)})})]}),(0,b.jsx)(q.FormMessage,{})]})}),K&&(0,b.jsxs)("div",{className:"rounded-lg border p-4 bg-muted/50",children:[(0,b.jsx)("h4",{className:"font-medium mb-2",children:"Material Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Unit:"})," ",K.unit]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Price:"})," €",K.default_price_eur.toFixed(2),"/",K.unit]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Available:"})," ",L.toFixed(2)," ",K.unit]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Category:"})," ",K.category]})]})]}),(0,b.jsx)(q.FormField,{control:G.control,name:"allocated_qty",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Quantity to Allocate *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(o.Input,{type:"number",step:"0.001",min:"0",max:L,placeholder:"0",...a})}),(0,b.jsxs)(q.FormDescription,{children:["Maximum available: ",L.toFixed(3)," ",K?.unit||"units"]}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:G.control,name:"allocation_type",render:({field:a})=>(0,b.jsxs)(q.FormItem,{className:"space-y-3",children:[(0,b.jsx)(q.FormLabel,{children:"Allocate to *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsxs)(w,{onValueChange:P,value:a.value,className:"flex flex-col space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(x,{value:"project",id:"project"}),(0,b.jsx)(y.Label,{htmlFor:"project",children:"Project"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(x,{value:"crew",id:"crew"}),(0,b.jsx)(y.Label,{htmlFor:"crew",children:"Crew"})]})]})}),(0,b.jsx)(q.FormMessage,{})]})}),"project"===J&&(0,b.jsx)(q.FormField,{control:G.control,name:"project_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Project *"}),(0,b.jsxs)(r.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.SelectTrigger,{children:(0,b.jsx)(r.SelectValue,{placeholder:"Select project"})})}),(0,b.jsx)(r.SelectContent,{children:E?.items?.map(a=>(0,b.jsx)(r.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:a.name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.city," • ",a.status]})]})},a.id))})]}),(0,b.jsx)(q.FormMessage,{})]})}),"crew"===J&&(0,b.jsx)(q.FormField,{control:G.control,name:"crew_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Crew *"}),(0,b.jsxs)(r.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.SelectTrigger,{children:(0,b.jsx)(r.SelectValue,{placeholder:"Select crew"})})}),(0,b.jsx)(r.SelectContent,{children:F?.map(a=>(0,b.jsx)(r.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:a.name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.member_count," members • ",a.project_name||"No project assigned"]})]})},a.id))})]}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:G.control,name:"allocation_date",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Allocation Date *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(o.Input,{type:"date",...a})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:G.control,name:"notes",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Notes (optional)"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.Textarea,{placeholder:"Additional notes about this allocation...",rows:3,...a})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,b.jsxs)(n.Button,{type:"button",variant:"outline",onClick:()=>a.back(),children:[(0,b.jsx)(j.X,{className:"mr-2 h-4 w-4"}),"Cancel"]}),(0,b.jsxs)(n.Button,{type:"submit",disabled:g.isPending||!K||I<=0,children:[g.isPending?(0,b.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent mr-2"}):(0,b.jsx)(i.Save,{className:"mr-2 h-4 w-4"}),"Create Allocation"]})]})]})})})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[K&&I>0&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)(p.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(l,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Allocation Summary"})]})}),(0,b.jsxs)(p.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Material:"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:K.name})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Quantity:"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[I," ",K.unit]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Unit Price:"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:["€",K.default_price_eur.toFixed(2)]})]}),(0,b.jsx)("div",{className:"border-t pt-2",children:(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Total Cost:"}),(0,b.jsxs)("span",{className:"text-sm font-bold",children:["€",M.toFixed(2)]})]})})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Stock Impact"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Current Available:"}),(0,b.jsxs)("span",{children:[L.toFixed(2)," ",K.unit]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"After Allocation:"}),(0,b.jsxs)("span",{className:N<0?"text-red-600 font-medium":"",children:[N.toFixed(2)," ",K.unit]})]})]})]}),N<0&&(0,b.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(m.AlertTriangle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)("span",{className:"text-sm text-red-800 font-medium",children:"Insufficient Stock"})]}),(0,b.jsx)("p",{className:"text-xs text-red-700 mt-1",children:"The requested quantity exceeds available stock."})]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Quick Tips"})}),(0,b.jsxs)(p.CardContent,{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Material Selection"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Only materials with available stock are shown in the dropdown."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Allocation Type"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Choose between allocating to a specific project or crew for better tracking."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Stock Tracking"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Allocated materials are automatically reserved and deducted from available stock."})]})]})]})]})]})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_dashboard_materials_allocations_new_page_tsx_8115e064._.js.map