module.exports=[86456,a=>{"use strict";a.s(["useCreateProject",()=>j,"useDeleteProject",()=>l,"useProject",()=>i,"useProjectStats",()=>m,"useProjects",()=>h,"useUpdateProject",()=>k]);var b=a.i(33217),c=a.i(70025),d=a.i(37927),e=a.i(23292),f=a.i(91938);let g={all:["projects"],lists:()=>[...g.all,"list"],list:a=>[...g.lists(),a],details:()=>[...g.all,"detail"],detail:a=>[...g.details(),a]};function h(a){return(0,b.useQuery)({queryKey:g.list(a||{}),queryFn:()=>f.projectsApi.getProjects(a),staleTime:3e5})}function i(a){return(0,b.useQuery)({queryKey:g.detail(a),queryFn:()=>f.projectsApi.getProject(a),enabled:!!a,staleTime:3e5})}function j(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:a=>f.projectsApi.createProject(a),onSuccess:b=>{a.invalidateQueries({queryKey:g.lists()}),a.setQueryData(g.detail(b.id),b),e.toast.success("Project created successfully")},onError:a=>{e.toast.error(`Failed to create project: ${a.message}`)}})}function k(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:({id:a,data:b})=>f.projectsApi.updateProject(a,b),onMutate:async({id:b,data:c})=>{await a.cancelQueries({queryKey:g.detail(b)});let d=a.getQueryData(g.detail(b));return a.setQueryData(g.detail(b),a=>a?{...a,...c}:a),{previousProject:d}},onError:(b,{id:c},d)=>{d?.previousProject&&a.setQueryData(g.detail(c),d.previousProject),e.toast.error(`Failed to update project: ${b.message}`)},onSuccess:b=>{a.invalidateQueries({queryKey:g.lists()}),e.toast.success("Project updated successfully")},onSettled:(b,c,{id:d})=>{a.invalidateQueries({queryKey:g.detail(d)})}})}function l(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:a=>f.projectsApi.deleteProject(a),onSuccess:(b,c)=>{a.removeQueries({queryKey:g.detail(c)}),a.invalidateQueries({queryKey:g.lists()}),e.toast.success("Project deleted successfully")},onError:a=>{e.toast.error(`Failed to delete project: ${a.message}`)}})}function m(a){return(0,b.useQuery)({queryKey:[...g.detail(a),"stats"],queryFn:async()=>{let b=await fetch(`/api/projects/${a}/stats`);if(!b.ok)throw Error("Failed to fetch project statistics");return b.json()},staleTime:12e4,enabled:!!a})}},29246,a=>{"use strict";a.s(["Textarea",()=>e]);var b=a.i(87924),c=a.i(72131),d=a.i(68114);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("textarea",{className:(0,d.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:e,...c}));e.displayName="Textarea"},210,a=>{"use strict";a.s(["ArrowLeft",()=>b],210);let b=(0,a.i(70106).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},14548,a=>{"use strict";a.s(["Save",()=>b],14548);let b=(0,a.i(70106).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},44750,a=>{"use strict";a.s(["useCreateCrew",()=>j,"useCreateTeam",()=>o,"useCrew",()=>i,"useDeleteCrew",()=>l,"useForemenUsers",()=>n,"useGlobalTeams",()=>m,"useProjectTeams",()=>p,"useTeams",()=>h,"useUpdateCrew",()=>k,"useUpdateTeam",()=>q]);var b=a.i(33217),c=a.i(70025),d=a.i(37927),e=a.i(23292),f=a.i(91938);let g={all:["teams"],crews:()=>[...g.all,"crews"],crew:a=>[...g.all,"crew",a]};function h(){return(0,b.useQuery)({queryKey:g.crews(),queryFn:async()=>{let a=await fetch("/api/crews");if(!a.ok)throw Error("Failed to fetch crews");return(await a.json()).crews||[]},staleTime:3e4})}function i(a){return(0,b.useQuery)({queryKey:g.crew(a),queryFn:()=>f.teamsApi.getCrew(a),enabled:!!a,staleTime:3e5})}function j(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:a=>f.teamsApi.createCrew(a),onSuccess:b=>{a.invalidateQueries({queryKey:g.crews()}),a.setQueryData(g.crew(b.id),b),e.toast.success("Team created successfully")},onError:a=>{e.toast.error(`Failed to create team: ${a.message}`)}})}function k(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:({id:a,data:b})=>f.teamsApi.updateCrew(a,b),onMutate:async({id:b,data:c})=>{await a.cancelQueries({queryKey:g.crew(b)});let d=a.getQueryData(g.crew(b));return a.setQueryData(g.crew(b),a=>a?{...a,...c}:a),{previousCrew:d}},onError:(b,{id:c},d)=>{d?.previousCrew&&a.setQueryData(g.crew(c),d.previousCrew),e.toast.error(`Failed to update team: ${b.message}`)},onSuccess:()=>{a.invalidateQueries({queryKey:g.crews()}),e.toast.success("Team updated successfully")},onSettled:(b,c,{id:d})=>{a.invalidateQueries({queryKey:g.crew(d)})}})}function l(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:a=>f.teamsApi.deleteCrew(a),onSuccess:(b,c)=>{a.removeQueries({queryKey:g.crew(c)}),a.invalidateQueries({queryKey:g.crews()}),e.toast.success("Team deleted successfully")},onError:a=>{e.toast.error(`Failed to delete team: ${a.message}`)}})}function m(){return(0,b.useQuery)({queryKey:["global-teams"],queryFn:async()=>{let a=await fetch("/api/crews");if(!a.ok)throw Error("Failed to fetch global teams");let b=(await a.json()).crews||[],c={};return b.forEach(a=>{a.project_id&&(c[a.name]=(c[a.name]||0)+1)}),b.map(a=>({id:a.id,name:a.name,foreman_name:a.foreman?.full_name||a.foreman_name,is_active:"active"===a.status,project_count:c[a.name]||0,specialization:"mixed"}))}})}function n(){return(0,b.useQuery)({queryKey:["foremen-users"],queryFn:async()=>{let a=await fetch("/api/users?role=foreman&is_active=true");if(!a.ok){let a=await fetch("/api/users?role=pm&is_active=true");if(!a.ok)throw Error("Failed to fetch users");return(await a.json()).items||[]}let b=await a.json();if(0===b.items.length){let a=await fetch("/api/users?is_active=true");if(!a.ok)throw Error("Failed to fetch users");return((await a.json()).items||[]).filter(a=>"foreman"===a.role||"pm"===a.role)}return b.items||[]}})}function o(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:async a=>{let b=await fetch("/api/crews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw Error((await b.json()).error||"Failed to create team");return b.json()},onSuccess:(b,c)=>{c.project_id&&(a.invalidateQueries({queryKey:["project-teams",c.project_id]}),a.invalidateQueries({queryKey:["project-preparation",c.project_id]})),a.invalidateQueries({queryKey:["global-teams"]}),a.invalidateQueries({queryKey:g.crews()}),e.toast.success(b.message||"Team created successfully")},onError:a=>{e.toast.error(a.message)}})}function p(a){return(0,b.useQuery)({queryKey:["project-teams",a],queryFn:async()=>{let b=await fetch(`/api/crews?project_id=${a}`);if(!b.ok)throw Error("Failed to fetch project teams");return(await b.json()).crews||[]},enabled:!!a})}function q(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:async({id:a,data:b})=>{let c=await fetch(`/api/crews/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok)throw Error((await c.json()).error||"Failed to update team");return c.json()},onSuccess:(b,c)=>{a.invalidateQueries({queryKey:["project-teams"]}),a.invalidateQueries({queryKey:["global-teams"]}),a.invalidateQueries({queryKey:g.crews()}),a.invalidateQueries({queryKey:["project-preparation"]}),e.toast.success(b.message||"Team updated successfully")},onError:a=>{e.toast.error(a.message)}})}},10778,a=>{"use strict";a.s(["useDeleteUser",()=>j,"useProjectManagers",()=>k,"useUpdateUser",()=>i,"useUsers",()=>h]);var b=a.i(33217),c=a.i(70025),d=a.i(37927),e=a.i(23292),f=a.i(91938);let g={all:["users"],lists:()=>[...g.all,"list"],list:a=>[...g.lists(),a],details:()=>[...g.all,"detail"],detail:a=>[...g.details(),a]};function h(a){return(0,b.useQuery)({queryKey:g.list(a||{}),queryFn:()=>f.usersApi.getUsers(a),staleTime:3e5})}function i(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:({id:a,data:b})=>f.usersApi.updateUser(a,b),onMutate:async({id:b,data:c})=>{await a.cancelQueries({queryKey:g.detail(b)});let d=a.getQueryData(g.detail(b));return a.setQueryData(g.detail(b),a=>a?{...a,...c}:a),{previousUser:d}},onError:(b,{id:c},d)=>{d?.previousUser&&a.setQueryData(g.detail(c),d.previousUser),e.toast.error(`Failed to update user: ${b.message}`)},onSuccess:()=>{a.invalidateQueries({queryKey:g.lists()}),e.toast.success("User updated successfully")},onSettled:(b,c,{id:d})=>{a.invalidateQueries({queryKey:g.detail(d)})}})}function j(){let a=(0,d.useQueryClient)();return(0,c.useMutation)({mutationFn:a=>f.usersApi.deleteUser(a),onSuccess:(b,c)=>{a.removeQueries({queryKey:g.detail(c)}),a.invalidateQueries({queryKey:g.lists()}),e.toast.success("User deleted successfully")},onError:a=>{e.toast.error(`Failed to delete user: ${a.message}`)}})}function k(){return h({role:"pm",page:1,per_page:50})}},71079,a=>{"use strict";a.s(["default",()=>u]);var b=a.i(87924),c=a.i(50944),d=a.i(95245),e=a.i(59501),f=a.i(56757),g=a.i(210),h=a.i(60246),i=a.i(14548),j=a.i(33508),k=a.i(99570),l=a.i(66718),m=a.i(29246),n=a.i(91119),o=a.i(41921),p=a.i(80701),q=a.i(10778),r=a.i(44750),s=a.i(86456);let t=f.z.object({name:f.z.string().min(1,"Team name is required"),description:f.z.string().optional(),foreman_user_id:f.z.string().optional(),project_id:f.z.string().optional()});function u(){let a=(0,c.useRouter)(),f=(0,r.useCreateCrew)(),u=(0,d.useForm)({resolver:(0,e.zodResolver)(t),defaultValues:{name:"",description:"",foreman_user_id:"",project_id:""}}),{data:v,isLoading:w}=(0,q.useUsers)({page:1,per_page:100}),{data:x,isLoading:y}=(0,s.useProjects)({page:1,per_page:50}),z=v?.items||[],A=x?.items||[],B=z.filter(a=>["foreman","pm","admin"].includes(a.role)),C=async b=>{try{let c={name:b.name,description:b.description,foreman_user_id:"none"===b.foreman_user_id?void 0:b.foreman_user_id,project_id:"none"===b.project_id?void 0:b.project_id},d=await f.mutateAsync(c);a.push(`/dashboard/teams/${d.id}/members`)}catch(b){console.error("Failed to create team:",b),a.push("/dashboard/teams")}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)(k.Button,{variant:"ghost",size:"sm",onClick:()=>a.back(),className:"flex items-center space-x-2",children:[(0,b.jsx)(g.ArrowLeft,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Back"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Create New Team"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Set up a new work crew with basic information"})]})]})}),(0,b.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,b.jsxs)(n.Card,{children:[(0,b.jsxs)(n.CardHeader,{children:[(0,b.jsxs)(n.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Users,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Team Information"})]}),(0,b.jsx)(n.CardDescription,{children:"Basic team details and leadership assignment"})]}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)(o.Form,{...u,children:(0,b.jsxs)("form",{onSubmit:u.handleSubmit(C),className:"space-y-4",children:[(0,b.jsx)(o.FormField,{control:u.control,name:"name",render:({field:a})=>(0,b.jsxs)(o.FormItem,{children:[(0,b.jsx)(o.FormLabel,{children:"Team Name *"}),(0,b.jsx)(o.FormControl,{children:(0,b.jsx)(l.Input,{placeholder:"e.g., Installation Team Alpha",...a})}),(0,b.jsx)(o.FormMessage,{})]})}),(0,b.jsx)(o.FormField,{control:u.control,name:"description",render:({field:a})=>(0,b.jsxs)(o.FormItem,{children:[(0,b.jsx)(o.FormLabel,{children:"Description"}),(0,b.jsx)(o.FormControl,{children:(0,b.jsx)(m.Textarea,{placeholder:"Brief description of team purpose and responsibilities",...a})}),(0,b.jsx)(o.FormMessage,{})]})}),(0,b.jsx)(o.FormField,{control:u.control,name:"foreman_user_id",render:({field:a})=>(0,b.jsxs)(o.FormItem,{children:[(0,b.jsx)(o.FormLabel,{children:"Team Leader / Foreman"}),(0,b.jsxs)(p.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(o.FormControl,{children:(0,b.jsx)(p.SelectTrigger,{children:(0,b.jsx)(p.SelectValue,{placeholder:"Select team leader"})})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"none",children:"No leader assigned"}),B.map(a=>(0,b.jsxs)(p.SelectItem,{value:a.id,children:[a.full_name," (",a.role,")"]},a.id))]})]}),(0,b.jsx)(o.FormMessage,{})]})}),(0,b.jsx)(o.FormField,{control:u.control,name:"project_id",render:({field:a})=>(0,b.jsxs)(o.FormItem,{children:[(0,b.jsx)(o.FormLabel,{children:"Assign to Project"}),(0,b.jsxs)(p.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(o.FormControl,{children:(0,b.jsx)(p.SelectTrigger,{children:(0,b.jsx)(p.SelectValue,{placeholder:"Select project (optional)"})})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"none",children:"No project assigned"}),y?(0,b.jsx)(p.SelectItem,{value:"loading",disabled:!0,children:"Loading projects..."}):A.map(a=>(0,b.jsx)(p.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(0,b.jsx)(o.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,b.jsxs)(k.Button,{type:"button",variant:"outline",onClick:()=>a.back(),children:[(0,b.jsx)(j.X,{className:"mr-2 h-4 w-4"}),"Cancel"]}),(0,b.jsxs)(k.Button,{type:"submit",disabled:f.isPending,children:[f.isPending?(0,b.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent mr-2"}):(0,b.jsx)(i.Save,{className:"mr-2 h-4 w-4"}),"Create Team"]})]})]})})})]})})]})}}];

//# sourceMappingURL=_f16cc1bf._.js.map