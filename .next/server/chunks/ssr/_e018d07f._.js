module.exports=[24669,a=>{"use strict";a.s(["TrendingUp",()=>b],24669);let b=(0,a.i(70106).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},33140,a=>{"use strict";a.s(["Skeleton",()=>d]);var b=a.i(87924),c=a.i(68114);function d({className:a,...d}){return(0,b.jsx)("div",{className:(0,c.cn)("animate-pulse rounded-md bg-muted",a),...d})}},69520,a=>{"use strict";a.s(["RefreshCw",()=>b],69520);let b=(0,a.i(70106).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},89400,a=>{"use strict";a.s(["default",()=>s],89400);var b=a.i(87924),c=a.i(67900),d=a.i(60246),e=a.i(11300),f=a.i(92e3),g=a.i(24669),h=a.i(90669),i=a.i(69520),j=a.i(91119),k=a.i(86304),l=a.i(99570),m=a.i(47507),n=a.i(33217),o=a.i(37927);async function p(){let a=await fetch("/api/dashboard/stats");if(!a.ok)throw Error("Failed to fetch dashboard statistics");return a.json()}async function q(){let a=await fetch("/api/activities?page=1&per_page=10");if(!a.ok)throw Error("Failed to fetch recent activities");return(await a.json()).activities||[]}var r=a.i(33140);function s(){let{user:a,isAdmin:s,isProjectManager:t,isWorker:u,isForeman:v}=(0,m.usePermissions)(),w=u||v||t||s,{data:x,isLoading:y,error:z}=(0,n.useQuery)({queryKey:["dashboard-stats"],queryFn:p,staleTime:3e4,gcTime:3e5,refetchInterval:6e4,refetchOnWindowFocus:!0,retry:(a,b)=>{if(b instanceof Error&&"status"in b){let a=b.status;if(a>=400&&a<500)return!1}return a<3}}),{data:A,isLoading:B}=(0,n.useQuery)({queryKey:["recent-activities"],queryFn:q,staleTime:3e4,gcTime:6e5,refetchInterval:12e4,refetchOnWindowFocus:!0,retry:(a,b)=>{if(b instanceof Error&&"status"in b){let a=b.status;if(a>=400&&a<500)return!1}return a<3}}),{refreshDashboard:C}=function(){let a=(0,o.useQueryClient)();return{refreshDashboard:async()=>{await a.invalidateQueries({queryKey:["dashboard-stats"],refetchType:"active"}),await a.invalidateQueries({queryKey:["recent-activities"],refetchType:"active"})}}}(),D=A?.slice(0,3)||[],E={activeProjects:x?.projects.active||0,totalWorkEntries:x?.workEntries.total||0,pendingApprovals:x?.workEntries.pendingApprovals||0,activeWorkers:x?.team.activeWorkers||0},F=z||x?.error;return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold tracking-tight",children:["Welcome back, ",a?.first_name,"!"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Here's what's happening in your fiber optic construction projects today."}),F&&(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-amber-600",children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm",children:"Using cached data - database connection issue"})]}),x?.lastUpdated&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Last updated: ",new Date(x.lastUpdated).toLocaleTimeString()]})]}),(0,b.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:C,disabled:y,className:"flex items-center gap-2",children:[(0,b.jsx)(i.RefreshCw,{className:`h-4 w-4 ${y?"animate-spin":""}`}),"Refresh"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(j.CardTitle,{className:"text-sm font-medium",children:"Active Projects"}),(0,b.jsx)(c.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(j.CardContent,{children:[y?(0,b.jsx)(r.Skeleton,{className:"h-8 w-16 mb-1"}):(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.activeProjects}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:x?.projects.total?`of ${x.projects.total} total projects`:"Loading..."})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(j.CardTitle,{className:"text-sm font-medium",children:"Work Entries"}),(0,b.jsx)(e.ClipboardList,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(j.CardContent,{children:[y?(0,b.jsx)(r.Skeleton,{className:"h-8 w-16 mb-1"}):(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.totalWorkEntries}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:x?.workEntries.thisWeek?`+${x.workEntries.thisWeek} this week`:"Loading..."})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(j.CardTitle,{className:"text-sm font-medium",children:"Pending Approvals"}),(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(j.CardContent,{children:[y?(0,b.jsx)(r.Skeleton,{className:"h-8 w-16 mb-1"}):(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.pendingApprovals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:E.pendingApprovals>0?"Requires attention":"All caught up!"})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(j.CardTitle,{className:"text-sm font-medium",children:"Active Workers"}),(0,b.jsx)(d.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(j.CardContent,{children:[y?(0,b.jsx)(r.Skeleton,{className:"h-8 w-16 mb-1"}):(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.activeWorkers}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:x?.team.totalWorkers?`of ${x.team.totalWorkers} total workers`:"Loading..."})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[(0,b.jsxs)(j.Card,{className:"col-span-4",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Activity,{className:"h-5 w-5"}),"Recent Activity"]})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:B?Array.from({length:3}).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,b.jsx)(r.Skeleton,{className:"h-4 w-4 mt-1"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(r.Skeleton,{className:"h-4 w-full"}),(0,b.jsx)(r.Skeleton,{className:"h-3 w-1/2"})]})]},c)):D.length>0?D.map(a=>(0,b.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,b.jsxs)("div",{className:"mt-1",children:["work_entry"===a.type&&(0,b.jsx)(e.ClipboardList,{className:"h-4 w-4 text-blue-500"}),"project"===a.type&&(0,b.jsx)(c.Building2,{className:"h-4 w-4 text-green-500"}),"approval"===a.type&&(0,b.jsx)(g.TrendingUp,{className:"h-4 w-4 text-orange-500"}),!["work_entry","project","approval"].includes(a.type)&&(0,b.jsx)(h.Activity,{className:"h-4 w-4 text-gray-500"})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsx)("p",{className:"text-sm",children:a.description}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["by ",a.user?.name||"Unknown User"," â€¢ ",new Date(a.created_at).toLocaleString()]})]})]},a.id)):(0,b.jsxs)("div",{className:"text-center py-6 text-muted-foreground",children:[(0,b.jsx)(h.Activity,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"No recent activity"})]})})})]}),(0,b.jsxs)(j.Card,{className:"col-span-3",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(c.Building2,{className:"h-5 w-5"}),"Project Status"]})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:y?Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(r.Skeleton,{className:"h-4 w-20"}),(0,b.jsx)(r.Skeleton,{className:"h-6 w-12"})]},c)):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Active"}),(0,b.jsx)(k.Badge,{variant:"default",children:x?.projects.active||0})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Planning"}),(0,b.jsx)(k.Badge,{variant:"secondary",children:x?.projects.planning||0})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Completed"}),(0,b.jsx)(k.Badge,{variant:"outline",children:x?.projects.completed||0})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"On Hold"}),(0,b.jsx)(k.Badge,{variant:"destructive",children:x?.projects.onHold||0})]})]})})})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Quick Actions"}),(0,b.jsx)(j.CardDescription,{children:"Common tasks you can perform based on your role"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[w&&(0,b.jsxs)(l.Button,{variant:"outline",children:[(0,b.jsx)(e.ClipboardList,{className:"mr-2 h-4 w-4"}),"Create Work Entry"]}),(s||t)&&(0,b.jsxs)(l.Button,{variant:"outline",children:[(0,b.jsx)(c.Building2,{className:"mr-2 h-4 w-4"}),"New Project"]}),(s||t)&&(0,b.jsxs)(l.Button,{variant:"outline",children:[(0,b.jsx)(d.Users,{className:"mr-2 h-4 w-4"}),"Manage Teams"]}),(0,b.jsxs)(l.Button,{variant:"outline",children:[(0,b.jsx)(g.TrendingUp,{className:"mr-2 h-4 w-4"}),"View Reports"]})]})})]})]})}}];

//# sourceMappingURL=_e018d07f._.js.map