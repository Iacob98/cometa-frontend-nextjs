module.exports=[47843,a=>{"use strict";a.s(["default",()=>y]);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95245),f=a.i(59501),g=a.i(56757),h=a.i(210),i=a.i(15618),j=a.i(81560),k=a.i(83497),l=a.i(38784),m=a.i(99570),n=a.i(66718),o=a.i(29246),p=a.i(91119),q=a.i(41921),r=a.i(15055),s=a.i(80701),t=a.i(6015),u=a.i(95669),v=a.i(86456),w=a.i(10999);let x=g.z.object({project_id:g.z.string().min(1,"Project is required"),supplier_id:g.z.string().min(1,"Supplier is required"),expected_delivery_date:g.z.string().optional(),notes:g.z.string().optional(),deduct_from_budget:g.z.boolean().default(!0),items:g.z.array(g.z.object({material_id:g.z.string().min(1,"Material is required"),quantity:g.z.coerce.number().positive("Quantity must be positive"),unit_cost:g.z.coerce.number().positive("Unit cost must be positive").optional()})).min(1,"At least one item is required")});function y(){let a=(0,d.useRouter)(),g=(0,d.useSearchParams)().get("project_id")||"",[y,z]=(0,c.useState)(""),A=(0,u.useCreateMaterialOrderWithBudget)(),{data:B}=(0,v.useProjects)(),{data:C=[]}=(0,w.useSuppliers)(),{data:D=[]}=(0,w.useSupplierMaterials)(y),E=B?.items||[],F=(0,e.useForm)({resolver:(0,f.zodResolver)(x),defaultValues:{project_id:g,supplier_id:"",expected_delivery_date:"",notes:"",deduct_from_budget:!0,items:[{material_id:"",quantity:1,unit_cost:0}]}}),{fields:G,append:H,remove:I}=(0,e.useFieldArray)({control:F.control,name:"items"}),J=F.watch("supplier_id");J!==y&&(z(J),y&&J!==y&&F.setValue("items",[{material_id:"",quantity:1,unit_cost:0}]));let K=async b=>{try{for(let a of b.items){let c={project_id:b.project_id,supplier_material_id:a.material_id,quantity:a.quantity,unit_price_eur:a.unit_cost||void 0,expected_delivery_date:b.expected_delivery_date||void 0,notes:b.notes||void 0,deduct_from_budget:b.deduct_from_budget};await A.mutateAsync(c)}a.push("/dashboard/materials")}catch(a){console.error("Failed to create order:",a)}},L=E.find(a=>a.id===F.watch("project_id")),M=C.find(a=>a.id===y);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)(m.Button,{variant:"ghost",size:"sm",onClick:()=>a.back(),className:"flex items-center space-x-2",children:[(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Back"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Materials"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Create a material order for your project"})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)(p.Card,{children:[(0,b.jsxs)(p.CardHeader,{children:[(0,b.jsxs)(p.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(l.ShoppingCart,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Order Details"})]}),(0,b.jsx)(p.CardDescription,{children:"Select project, supplier, and materials to order"})]}),(0,b.jsx)(p.CardContent,{children:(0,b.jsx)(q.Form,{...F,children:(0,b.jsxs)("form",{onSubmit:F.handleSubmit(K),className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(q.FormField,{control:F.control,name:"project_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Project *"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select project"})})}),(0,b.jsx)(s.SelectContent,{children:E.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:a.name},a.id))})]}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:F.control,name:"supplier_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Supplier *"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select supplier"})})}),(0,b.jsx)(s.SelectContent,{children:C.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:a.org_name},a.id))})]}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:F.control,name:"expected_delivery_date",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Expected Delivery Date"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(n.Input,{type:"date",...a})}),(0,b.jsx)(q.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Materials"}),(0,b.jsxs)(m.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{H({material_id:"",quantity:1,unit_cost:0})},disabled:!y,children:[(0,b.jsx)(i.Plus,{className:"mr-2 h-4 w-4"}),"Add Item"]})]}),!y&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Please select a supplier to add materials"}),y&&0===D.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No materials available from this supplier"}),y&&D.length>0&&(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:(0,b.jsxs)(t.TableRow,{children:[(0,b.jsx)(t.TableHead,{children:"Material"}),(0,b.jsx)(t.TableHead,{children:"Quantity"}),(0,b.jsx)(t.TableHead,{children:"Unit Cost (€)"}),(0,b.jsx)(t.TableHead,{children:"Total (€)"}),(0,b.jsx)(t.TableHead,{className:"w-[50px]"})]})}),(0,b.jsx)(t.TableBody,{children:G.map((a,c)=>{let d=D.find(a=>a.id===F.watch(`items.${c}.material_id`)),e=F.watch(`items.${c}.quantity`)||0,f=F.watch(`items.${c}.unit_cost`)||d?.unit_price_eur||0;return(0,b.jsxs)(t.TableRow,{children:[(0,b.jsxs)(t.TableCell,{children:[(0,b.jsx)(q.FormField,{control:F.control,name:`items.${c}.material_id`,render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsxs)(s.Select,{onValueChange:b=>{a.onChange(b);let d=D.find(a=>a.id===b);d&&F.setValue(`items.${c}.unit_cost`,d.unit_price_eur)},value:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select material"})})}),(0,b.jsx)(s.SelectContent,{children:D.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:a.material_type}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["€",a.unit_price_eur,"/",a.unit]})]})},a.id))})]}),(0,b.jsx)(q.FormMessage,{})]})}),d&&(0,b.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["Unit: ",d.unit,d.min_order_quantity>1&&(0,b.jsxs)("span",{className:"ml-1",children:["(Min: ",d.min_order_quantity,")"]})]})]}),(0,b.jsx)(t.TableCell,{children:(0,b.jsx)(q.FormField,{control:F.control,name:`items.${c}.quantity`,render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(n.Input,{type:"number",step:"0.001",min:d?.min_order_quantity||1,...a})}),(0,b.jsx)(q.FormMessage,{})]})})}),(0,b.jsx)(t.TableCell,{children:(0,b.jsx)(q.FormField,{control:F.control,name:`items.${c}.unit_cost`,render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(n.Input,{type:"number",step:"0.01",min:"0",...a})}),(0,b.jsx)(q.FormMessage,{})]})})}),(0,b.jsx)(t.TableCell,{children:(0,b.jsxs)("span",{className:"font-medium",children:["€",(e*f).toFixed(2)]})}),(0,b.jsx)(t.TableCell,{children:G.length>1&&(0,b.jsx)(m.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>I(c),children:(0,b.jsx)(j.Trash2,{className:"h-4 w-4"})})})]},a.id)})})]})})]}),(0,b.jsx)(q.FormField,{control:F.control,name:"notes",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Notes"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(o.Textarea,{placeholder:"Additional notes for this order...",rows:3,...a})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:F.control,name:"deduct_from_budget",render:({field:a})=>(0,b.jsxs)(q.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.Checkbox,{checked:a.value,onCheckedChange:a.onChange})}),(0,b.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,b.jsx)(q.FormLabel,{children:"Automatically deduct from project budget"}),(0,b.jsx)(q.FormDescription,{children:"When enabled, the order cost will be automatically deducted from the project's budget as an expense transaction. You can manage this manually later if disabled."})]})]})}),(0,b.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,b.jsx)(m.Button,{type:"button",variant:"outline",onClick:()=>a.back(),children:"Cancel"}),(0,b.jsxs)(m.Button,{type:"submit",disabled:A.isPending,children:[A.isPending?(0,b.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent mr-2"}):(0,b.jsx)(k.Package,{className:"mr-2 h-4 w-4"}),"Create Order"]})]})]})})})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Order Summary"})}),(0,b.jsxs)(p.CardContent,{className:"space-y-4",children:[L&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:"Project"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:L.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:L.customer})]}),M&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:"Supplier"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:M.org_name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:M.contact_person})]}),(0,b.jsxs)("div",{className:"pt-2 border-t",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total Cost"}),(0,b.jsxs)("span",{className:"text-lg font-bold",children:["€",F.getValues("items").reduce((a,b)=>a+b.quantity*(b.unit_cost||0),0).toFixed(2)]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Excludes delivery costs"})]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Order Information"})}),(0,b.jsxs)(p.CardContent,{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Order Process"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:'Orders are created with "pending" status and can be tracked through delivery'})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Costs"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Order costs will be deducted from the project budget automatically"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium",children:"Delivery"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Check with supplier for delivery costs and minimum order requirements"})]})]})]})]})]})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_dashboard_materials_order_page_tsx_b056ec2f._.js.map