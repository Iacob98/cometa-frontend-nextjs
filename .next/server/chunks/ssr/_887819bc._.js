module.exports=[23312,50451,a=>{"use strict";a.s(["Bell",()=>b],23312);let b=(0,a.i(70106).default)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);a.s(["useNotificationActions",()=>s,"useNotificationPreferences",()=>l,"useRecentNotifications",()=>r,"useUnreadNotificationCount",()=>k,"useUnreadNotifications",()=>p,"useUpdateNotificationPreferences",()=>m,"useUrgentNotifications",()=>q,"useUserNotifications",()=>o,"useWebSocketNotifications",()=>n],50451);var c=a.i(33217),d=a.i(70025),e=a.i(37927),f=a.i(23292),g=a.i(72131),h=a.i(91938);let i={all:["notifications"],lists:()=>[...i.all,"list"],list:a=>[...i.lists(),a],details:()=>[...i.all,"detail"],detail:a=>[...i.details(),a],unreadCount:a=>[...i.all,"unread-count",a],preferences:a=>[...i.all,"preferences",a],templates:()=>[...i.all,"templates"]};function j(a){return(0,c.useQuery)({queryKey:i.list(a||{}),queryFn:()=>h.notificationsApi.getNotifications(a),staleTime:3e4})}function k(a){return(0,c.useQuery)({queryKey:i.unreadCount(a),queryFn:()=>h.notificationsApi.getUnreadCount(a),enabled:!!a,refetchInterval:3e4,staleTime:0})}function l(a){return(0,c.useQuery)({queryKey:i.preferences(a),queryFn:()=>h.notificationPreferencesApi.getPreferences(a),enabled:!!a,staleTime:3e5})}function m(){let a=(0,e.useQueryClient)();return(0,d.useMutation)({mutationFn:({userId:a,data:b})=>h.notificationPreferencesApi.updatePreferences(a,b),onSuccess:b=>{a.setQueryData(i.preferences(b.user_id),b),f.toast.success("Notification preferences updated")},onError:a=>{f.toast.error(`Failed to update preferences: ${a.message}`)}})}function n(a,b=!0){let c=(0,e.useQueryClient)(),d=(0,g.useRef)(0),j=(0,g.useCallback)(b=>{c.invalidateQueries({queryKey:i.lists()}),c.invalidateQueries({queryKey:i.unreadCount(a)}),c.setQueryData(i.detail(b.id),b),("high"===b.priority||"urgent"===b.priority)&&f.toast.info(b.title,{description:b.body,action:"urgent"===b.priority?{label:"View",onClick:()=>{console.log("Navigate to notification:",b.id)}}:void 0})},[c,a]),k=(0,g.useCallback)(a=>{switch(a.entity_type){case"project":c.invalidateQueries({queryKey:["projects"]});break;case"work_entry":c.invalidateQueries({queryKey:["work-entries"]});break;case"material_allocation":c.invalidateQueries({queryKey:["material-allocations"]});break;case"house":c.invalidateQueries({queryKey:["houses"]});break;default:c.invalidateQueries()}("status_changed"===a.type||"assignment_changed"===a.type)&&f.toast.info("Update received",{description:`${a.entity_type} has been updated`})},[c]);return(0,g.useEffect)(()=>{if(!b||!a)return;let c=async()=>{try{await h.wsApi.connect(a),d.current=0,h.wsApi.subscribe("notification",j),h.wsApi.subscribe("realtime_update",k)}catch(a){console.error("WebSocket connection failed:",a),d.current<5&&(d.current++,setTimeout(()=>{c()},1e3*Math.pow(2,d.current)))}};return c(),()=>{h.wsApi.unsubscribe("notification",j),h.wsApi.unsubscribe("realtime_update",k),h.wsApi.disconnect()}},[a,b,j,k]),{sendMessage:(a,b)=>h.wsApi.send(a,b),subscribe:(a,b)=>h.wsApi.subscribe(a,b),unsubscribe:(a,b)=>h.wsApi.unsubscribe(a,b)}}function o(a){return j({user_id:a,page:1,per_page:20})}function p(a){return j({user_id:a,read:!1,page:1,per_page:50})}function q(a){return j({user_id:a,priority:"urgent",read:!1,page:1,per_page:10})}function r(a){let b=new Date(new Date);return b.setDate(b.getDate()-1),j({user_id:a,created_after:b.toISOString(),page:1,per_page:20})}function s(){let a=function(){let a=(0,e.useQueryClient)();return(0,d.useMutation)({mutationFn:a=>h.notificationsApi.markAsRead(a),onMutate:async b=>{await a.cancelQueries({queryKey:i.detail(b)});let c=a.getQueryData(i.detail(b));return a.setQueryData(i.detail(b),a=>a?{...a,read_at:new Date().toISOString()}:a),{previousNotification:c}},onError:(b,c,d)=>{d?.previousNotification&&a.setQueryData(i.detail(c),d.previousNotification),f.toast.error(`Failed to mark notification as read: ${b.message}`)},onSuccess:b=>{a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:i.unreadCount(b.user_id)})},onSettled:(b,c,d)=>{a.invalidateQueries({queryKey:i.detail(d)})}})}(),b=function(){let a=(0,e.useQueryClient)();return(0,d.useMutation)({mutationFn:a=>h.notificationsApi.markAllAsRead(a),onSuccess:(b,c)=>{a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:i.unreadCount(c)}),f.toast.success("All notifications marked as read")},onError:a=>{f.toast.error(`Failed to mark all notifications as read: ${a.message}`)}})}(),c=function(){let a=(0,e.useQueryClient)();return(0,d.useMutation)({mutationFn:a=>h.notificationsApi.deleteNotification(a),onSuccess:(b,c)=>{a.removeQueries({queryKey:i.detail(c)}),a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:i.all}),f.toast.success("Notification deleted")},onError:a=>{f.toast.error(`Failed to delete notification: ${a.message}`)}})}(),g=function(){let a=(0,e.useQueryClient)();return(0,d.useMutation)({mutationFn:a=>h.notificationsApi.createNotification(a),onSuccess:b=>{a.invalidateQueries({queryKey:i.lists()}),a.invalidateQueries({queryKey:i.unreadCount(b.user_id)}),a.setQueryData(i.detail(b.id),b),("high"===b.priority||"urgent"===b.priority)&&f.toast.info(b.title,{description:b.body})},onError:a=>{f.toast.error(`Failed to create notification: ${a.message}`)}})}();return{markAsRead:a.mutate,markAllAsRead:b.mutate,delete:c.mutate,create:g.mutate,isLoading:a.isPending||b.isPending||c.isPending||g.isPending}}},2323,a=>{"use strict";a.s(["NotificationItem",()=>n],2323);var b=a.i(87924),c=a.i(33508),d=a.i(16201),e=a.i(92e3);let f=(0,a.i(70106).default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var g=a.i(73570),h=a.i(99570),i=a.i(86304),j=a.i(68114),k=a.i(50451),l=a.i(94632);let m={low:{icon:f,color:"text-blue-600",bgColor:"bg-blue-50",badgeVariant:"secondary"},normal:{icon:f,color:"text-gray-600",bgColor:"bg-gray-50",badgeVariant:"outline"},high:{icon:e.AlertCircle,color:"text-orange-600",bgColor:"bg-orange-50",badgeVariant:"default"},urgent:{icon:g.AlertTriangle,color:"text-red-600",bgColor:"bg-red-50",badgeVariant:"destructive"}};function n({notification:a,onClose:e}){var f;let{markAsRead:g,delete:n}=(0,k.useNotificationActions)(),o=m[a.priority],p=o.icon,q=!a.read_at;return(0,b.jsxs)("div",{className:(0,j.cn)("group relative p-3 rounded-lg border transition-colors cursor-pointer hover:bg-muted/50",q&&"border-l-4 border-l-primary bg-primary/5",!q&&"opacity-75"),onClick:()=>{if(q&&g(a.id),a.data){let{project_id:b,work_entry_id:c,house_id:d,material_id:e}=a.data;b?window.location.href=`/dashboard/projects/${b}`:c?window.location.href=`/dashboard/work-entries/${c}`:d?window.location.href=`/dashboard/houses/${d}`:e&&(window.location.href=`/dashboard/materials/${e}`)}e?.()},children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:(0,j.cn)("rounded-full p-1",o.bgColor),children:(0,b.jsx)(p,{className:(0,j.cn)("h-4 w-4",o.color)})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[(0,b.jsx)(i.Badge,{variant:o.badgeVariant,className:"text-xs",children:{work_entry_created:"Work Entry Created",work_entry_approved:"Work Entry Approved",work_entry_rejected:"Work Entry Rejected",project_status_changed:"Project Status Updated",project_assigned:"Project Assigned",team_assignment_changed:"Team Assignment",material_low_stock:"Low Stock Alert",material_order_delivered:"Order Delivered",house_appointment_scheduled:"Appointment Scheduled",house_connection_completed:"Connection Completed",budget_alert:"Budget Alert",deadline_reminder:"Deadline Reminder",system_maintenance:"System Maintenance",user_mention:"Mentioned",approval_required:"Approval Required"}[f=a.type]||f.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,l.formatDistanceToNow)(new Date(a.created_at),{addSuffix:!0})}),q&&(0,b.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full"})]})]}),(0,b.jsx)("h4",{className:"text-sm font-medium text-foreground mb-1 line-clamp-1",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.body}),a.data&&(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-1",children:[a.data.project_name&&(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:a.data.project_name}),a.data.user_name&&(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:a.data.user_name}),a.data.stage_code&&(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:a.data.stage_code})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[q&&(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),q&&g(a.id)},className:"h-6 w-6 p-0",title:"Mark as read",children:(0,b.jsx)(d.CheckCircle,{className:"h-3 w-3"})}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),n(a.id)},className:"h-6 w-6 p-0 text-muted-foreground hover:text-destructive",title:"Delete notification",children:(0,b.jsx)(c.X,{className:"h-3 w-3"})})]})]}),a.expires_at&&new Date(a.expires_at)<new Date&&(0,b.jsx)("div",{className:"absolute top-1 right-1",children:(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs bg-yellow-50 text-yellow-700 border-yellow-200",children:"Expired"})})]})}},96043,a=>{"use strict";a.s(["NotificationPreferences",()=>s]);var b=a.i(87924),c=a.i(72131),d=a.i(95245),e=a.i(59501),f=a.i(56757),g=a.i(99570),h=a.i(63658),i=a.i(70430),j=a.i(41921),k=a.i(80701),l=a.i(66718),m=a.i(91119),n=a.i(75083),o=a.i(50451);let p=["websocket","push","email","sms","in_app"],q=[{type:"work_entry_created",label:"Work Entry Created",description:"When a new work entry is submitted"},{type:"work_entry_approved",label:"Work Entry Approved",description:"When your work entry is approved"},{type:"work_entry_rejected",label:"Work Entry Rejected",description:"When your work entry is rejected"},{type:"project_status_changed",label:"Project Status Changes",description:"When project status is updated"},{type:"project_assigned",label:"Project Assignment",description:"When you&apos;re assigned to a project"},{type:"team_assignment_changed",label:"Team Assignment",description:"When team assignments change"},{type:"material_low_stock",label:"Low Stock Alerts",description:"When materials are running low"},{type:"material_order_delivered",label:"Order Delivered",description:"When material orders are delivered"},{type:"house_appointment_scheduled",label:"Appointment Scheduled",description:"When house appointments are scheduled"},{type:"house_connection_completed",label:"Connection Completed",description:"When house connections are completed"},{type:"budget_alert",label:"Budget Alerts",description:"When budget thresholds are exceeded"},{type:"deadline_reminder",label:"Deadline Reminders",description:"When project deadlines approach"},{type:"system_maintenance",label:"System Maintenance",description:"System maintenance notifications"},{type:"user_mention",label:"User Mentions",description:"When you&apos;re mentioned in comments"},{type:"approval_required",label:"Approval Required",description:"When your approval is needed"}],r=f.z.object({enabled_channels:f.z.array(f.z.string()).min(1,"Select at least one channel"),notification_types:f.z.record(f.z.object({enabled:f.z.boolean(),channels:f.z.array(f.z.string()),frequency:f.z.enum(["immediate","hourly","daily","weekly"]).optional()})),quiet_hours_start:f.z.string().optional(),quiet_hours_end:f.z.string().optional(),timezone:f.z.string().optional(),language:f.z.string().optional()});function s({userId:a}){let{data:f,isLoading:s}=(0,o.useNotificationPreferences)(a),t=(0,o.useUpdateNotificationPreferences)(),u=(0,d.useForm)({resolver:(0,e.zodResolver)(r),defaultValues:{enabled_channels:["websocket","in_app"],notification_types:{},quiet_hours_start:"22:00",quiet_hours_end:"08:00",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:"en"}});return(c.default.useEffect(()=>{f&&u.reset({enabled_channels:f.enabled_channels,notification_types:f.notification_types,quiet_hours_start:f.quiet_hours_start||"22:00",quiet_hours_end:f.quiet_hours_end||"08:00",timezone:f.timezone,language:f.language})},[f,u]),s)?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):(0,b.jsx)(j.Form,{...u,children:(0,b.jsxs)("form",{onSubmit:u.handleSubmit(b=>{t.mutate({userId:a,data:{enabled_channels:b.enabled_channels,notification_types:b.notification_types,quiet_hours_start:b.quiet_hours_start,quiet_hours_end:b.quiet_hours_end,timezone:b.timezone,language:b.language}})}),className:"space-y-6",children:[(0,b.jsxs)(n.Tabs,{defaultValue:"channels",className:"w-full",children:[(0,b.jsxs)(n.TabsList,{className:"grid w-full grid-cols-3",children:[(0,b.jsx)(n.TabsTrigger,{value:"channels",children:"Channels"}),(0,b.jsx)(n.TabsTrigger,{value:"types",children:"Notification Types"}),(0,b.jsx)(n.TabsTrigger,{value:"settings",children:"Settings"})]}),(0,b.jsx)(n.TabsContent,{value:"channels",className:"space-y-4",children:(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Notification Channels"}),(0,b.jsx)(m.CardDescription,{children:"Choose how you want to receive notifications"})]}),(0,b.jsx)(m.CardContent,{className:"space-y-4",children:(0,b.jsx)(j.FormField,{control:u.control,name:"enabled_channels",render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{children:"Enabled Channels"}),(0,b.jsx)("div",{className:"space-y-3",children:p.map(c=>(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Switch,{id:c,checked:a.value.includes(c),onCheckedChange:b=>{b?a.onChange([...a.value,c]):a.onChange(a.value.filter(a=>a!==c))}}),(0,b.jsx)(i.Label,{htmlFor:c,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 capitalize",children:c.replace("_"," ")})]},c))}),(0,b.jsx)(j.FormMessage,{})]})})})]})}),(0,b.jsx)(n.TabsContent,{value:"types",className:"space-y-4",children:(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Notification Types"}),(0,b.jsx)(m.CardDescription,{children:"Configure which notifications you want to receive"})]}),(0,b.jsx)(m.CardContent,{className:"space-y-4",children:q.map(({type:a,label:c,description:d})=>(0,b.jsxs)("div",{className:"space-y-3 p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{className:"text-sm font-medium",children:c}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:d})]}),(0,b.jsx)(j.FormField,{control:u.control,name:`notification_types.${a}.enabled`,render:({field:a})=>(0,b.jsx)(j.FormItem,{children:(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(h.Switch,{checked:a.value||!1,onCheckedChange:a.onChange})})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(j.FormField,{control:u.control,name:`notification_types.${a}.frequency`,render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{className:"text-xs",children:"Frequency"}),(0,b.jsxs)(k.Select,{onValueChange:a.onChange,defaultValue:a.value||"immediate",children:[(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(k.SelectTrigger,{className:"h-8",children:(0,b.jsx)(k.SelectValue,{placeholder:"Select frequency"})})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"immediate",children:"Immediate"}),(0,b.jsx)(k.SelectItem,{value:"hourly",children:"Hourly"}),(0,b.jsx)(k.SelectItem,{value:"daily",children:"Daily"}),(0,b.jsx)(k.SelectItem,{value:"weekly",children:"Weekly"})]})]})]})}),(0,b.jsx)(j.FormField,{control:u.control,name:`notification_types.${a}.channels`,render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{className:"text-xs",children:"Channels"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:u.watch("enabled_channels").map(c=>(0,b.jsxs)(i.Label,{className:"flex items-center space-x-1 text-xs cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",className:"w-3 h-3",checked:a.value?.includes(c)||!1,onChange:b=>{let d=a.value||[];b.target.checked?a.onChange([...d,c]):a.onChange(d.filter(a=>a!==c))}}),(0,b.jsx)("span",{className:"capitalize",children:c.replace("_"," ")})]},c))})]})})]})]},a))})]})}),(0,b.jsx)(n.TabsContent,{value:"settings",className:"space-y-4",children:(0,b.jsxs)(m.Card,{children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"General Settings"}),(0,b.jsx)(m.CardDescription,{children:"Configure quiet hours and other preferences"})]}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(j.FormField,{control:u.control,name:"quiet_hours_start",render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{children:"Quiet Hours Start"}),(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(l.Input,{type:"time",...a})}),(0,b.jsx)(j.FormDescription,{children:"No notifications during quiet hours"}),(0,b.jsx)(j.FormMessage,{})]})}),(0,b.jsx)(j.FormField,{control:u.control,name:"quiet_hours_end",render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{children:"Quiet Hours End"}),(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(l.Input,{type:"time",...a})}),(0,b.jsx)(j.FormMessage,{})]})})]}),(0,b.jsx)(j.FormField,{control:u.control,name:"timezone",render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{children:"Timezone"}),(0,b.jsxs)(k.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Select timezone"})})}),(0,b.jsx)(k.SelectContent,{children:Intl.supportedValuesOf("timeZone").map(a=>(0,b.jsx)(k.SelectItem,{value:a,children:a},a))})]}),(0,b.jsx)(j.FormMessage,{})]})}),(0,b.jsx)(j.FormField,{control:u.control,name:"language",render:({field:a})=>(0,b.jsxs)(j.FormItem,{children:[(0,b.jsx)(j.FormLabel,{children:"Language"}),(0,b.jsxs)(k.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(j.FormControl,{children:(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{placeholder:"Select language"})})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"en",children:"English"}),(0,b.jsx)(k.SelectItem,{value:"ru",children:"Русский"}),(0,b.jsx)(k.SelectItem,{value:"de",children:"Deutsch"}),(0,b.jsx)(k.SelectItem,{value:"uz",children:"Oʻzbekcha"}),(0,b.jsx)(k.SelectItem,{value:"tr",children:"Türkçe"})]})]}),(0,b.jsx)(j.FormMessage,{})]})})]})]})})]}),(0,b.jsx)("div",{className:"flex justify-end gap-2",children:(0,b.jsx)(g.Button,{type:"submit",disabled:t.isPending,className:"w-full",children:t.isPending?"Saving...":"Save Preferences"})})]})})}}];

//# sourceMappingURL=_887819bc._.js.map