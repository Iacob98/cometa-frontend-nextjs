module.exports=[24655,a=>{"use strict";a.s(["default",()=>x]);var b=a.i(87924),c=a.i(59501),d=a.i(95245),e=a.i(56757),f=a.i(72131),g=a.i(50944),h=a.i(210),i=a.i(14548),j=a.i(96221),k=a.i(60246),l=a.i(79808),m=a.i(67900),n=a.i(10227),o=a.i(23292),p=a.i(99570),q=a.i(41921),r=a.i(66718),s=a.i(80701),t=a.i(91119),u=a.i(5084),v=a.i(15055);let w=e.z.object({equipment_id:e.z.string().optional(),vehicle_id:e.z.string().optional(),crew_id:e.z.string().min(1,"Crew selection is required"),project_id:e.z.string().optional(),assignment_type:e.z.enum(["equipment","vehicle"]),from_ts:e.z.string().min(1,"Start date is required"),to_ts:e.z.string().optional(),is_permanent:e.z.boolean().default(!1),rental_cost_per_day:e.z.string().optional().transform(a=>a?parseFloat(a):void 0)}).refine(a=>("equipment"!==a.assignment_type||!!a.equipment_id)&&("vehicle"!==a.assignment_type||!!a.vehicle_id),{message:"Resource selection is required",path:["equipment_id"]});function x(){let a=(0,g.useRouter)(),[e,x]=(0,f.useState)(!1),[y,z]=(0,f.useState)([]),[A,B]=(0,f.useState)([]),[C,D]=(0,f.useState)([]),[E,F]=(0,f.useState)([]),[G,H]=(0,f.useState)(!0),I=(0,d.useForm)({resolver:(0,c.zodResolver)(w),defaultValues:{equipment_id:"",vehicle_id:"",crew_id:"",project_id:"",assignment_type:"equipment",from_ts:"",to_ts:"",is_permanent:!1}});async function J(b){x(!0);try{let c="vehicle"===b.assignment_type,d={...c?{vehicle_id:b.vehicle_id}:{equipment_id:b.equipment_id},crew_id:b.crew_id,project_id:b.project_id||void 0,from_ts:b.from_ts,to_ts:b.to_ts||void 0,is_permanent:b.is_permanent,rental_cost_per_day:b.rental_cost_per_day},e=await fetch(c?"/api/vehicles/assignments":"/api/equipment/assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!e.ok){let a=await e.json();throw Error(a.error||`Failed to create ${b.assignment_type} assignment`)}await e.json(),o.toast.success(`${"vehicle"===b.assignment_type?"Vehicle":"Equipment"} assignment created successfully!`),a.push("/dashboard/equipment")}catch(a){console.error("Assignment creation error:",a),o.toast.error(a instanceof Error?a.message:"Failed to create assignment")}finally{x(!1)}}return((0,f.useEffect)(()=>{(async()=>{try{H(!0);let a=await fetch("/api/equipment"),b=await a.json(),c=(b.items||b).filter(a=>"available"===a.status);z(c);let d=await fetch("/api/vehicles"),e=await d.json(),f=(e.items||e).filter(a=>"available"===a.status);B(f);let g=await fetch("/api/projects?status=active"),h=await g.json();D(h.items||h);let i=await fetch("/api/crews"),j=await i.json();F(j)}catch(a){console.error("Failed to load data:",a),o.toast.error("Failed to load form data")}finally{H(!1)}})()},[]),G)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)(p.Button,{variant:"ghost",size:"sm",onClick:()=>a.back(),className:"flex items-center",children:[(0,b.jsx)(h.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Create Resource Assignment"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Assign equipment or vehicles to crews for project work"})]})]})}),(0,b.jsx)(u.Separator,{}),(0,b.jsx)("div",{className:"max-w-4xl",children:(0,b.jsx)(q.Form,{...I,children:(0,b.jsxs)("form",{onSubmit:I.handleSubmit(J),className:"space-y-8",children:[(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{children:[(0,b.jsxs)(t.CardTitle,{className:"flex items-center",children:[(0,b.jsx)(l.Wrench,{className:"h-5 w-5 mr-2"}),"Assignment Details"]}),(0,b.jsx)(t.CardDescription,{children:"Assign equipment or vehicles to crews. Projects will be auto-assigned when crews join them."})]}),(0,b.jsxs)(t.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsx)(q.FormField,{control:I.control,name:"assignment_type",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Resource Type *"}),(0,b.jsxs)(s.Select,{onValueChange:b=>{a.onChange(b),I.setValue("equipment_id",""),I.setValue("vehicle_id","")},defaultValue:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select resource type"})})}),(0,b.jsxs)(s.SelectContent,{children:[(0,b.jsx)(s.SelectItem,{value:"equipment",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(l.Wrench,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{children:"Equipment"})]})}),(0,b.jsx)(s.SelectItem,{value:"vehicle",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(n.Truck,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{children:"Vehicle"})]})})]})]}),(0,b.jsx)(q.FormDescription,{children:"Choose whether to assign equipment or vehicles"}),(0,b.jsx)(q.FormMessage,{})]})}),"equipment"===I.watch("assignment_type")&&(0,b.jsx)(q.FormField,{control:I.control,name:"equipment_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Equipment *"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select equipment"})})}),(0,b.jsx)(s.SelectContent,{children:y.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(l.Wrench,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{children:a.name}),a.inventory_no&&(0,b.jsxs)("span",{className:"text-muted-foreground ml-2",children:["(",a.inventory_no,")"]})]})},a.id))})]}),(0,b.jsx)(q.FormDescription,{children:"Only available equipment is shown"}),(0,b.jsx)(q.FormMessage,{})]})}),"vehicle"===I.watch("assignment_type")&&(0,b.jsx)(q.FormField,{control:I.control,name:"vehicle_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Vehicle *"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select vehicle"})})}),(0,b.jsx)(s.SelectContent,{children:A.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(n.Truck,{className:"h-4 w-4 mr-2"}),(0,b.jsxs)("span",{children:[a.brand," ",a.model]}),(0,b.jsxs)("span",{className:"text-muted-foreground ml-2",children:["(",a.plate_number,")"]})]})},a.id))})]}),(0,b.jsx)(q.FormDescription,{children:"Only available vehicles are shown"}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:I.control,name:"crew_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Crew *"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select crew"})})}),(0,b.jsx)(s.SelectContent,{children:E.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(k.Users,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{children:a.name}),a.project_name&&(0,b.jsxs)("span",{className:"text-muted-foreground ml-2",children:["(Project: ",a.project_name,")"]})]})},a.id))})]}),(0,b.jsx)(q.FormDescription,{children:"Resources are assigned to crews first, then auto-assigned to projects when crews join them"}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:I.control,name:"project_id",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Project (Optional)"}),(0,b.jsxs)(s.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(s.SelectTrigger,{children:(0,b.jsx)(s.SelectValue,{placeholder:"Select project (optional)"})})}),(0,b.jsx)(s.SelectContent,{children:C.map(a=>(0,b.jsx)(s.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(m.Building2,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{children:a.name}),(0,b.jsxs)("span",{className:"text-muted-foreground ml-2",children:["(",a.customer,")"]})]})},a.id))})]}),(0,b.jsx)(q.FormDescription,{children:"Optional direct project assignment (will be auto-assigned when crew joins project)"}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:I.control,name:"rental_cost_per_day",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Daily Rental Cost (â‚¬)"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.Input,{type:"number",step:"0.01",placeholder:"0.00",...a})}),(0,b.jsx)(q.FormDescription,{children:"Daily cost for this assignment (optional)"}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:I.control,name:"from_ts",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Start Date & Time *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.Input,{type:"datetime-local",...a})}),(0,b.jsx)(q.FormDescription,{children:"When the assignment begins"}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:I.control,name:"to_ts",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"End Date & Time"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(r.Input,{type:"datetime-local",...a,disabled:I.watch("is_permanent")})}),(0,b.jsx)(q.FormDescription,{children:"When the assignment ends (leave empty for ongoing)"}),(0,b.jsx)(q.FormMessage,{})]})})]}),(0,b.jsx)(q.FormField,{control:I.control,name:"is_permanent",render:({field:a})=>(0,b.jsxs)(q.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(v.Checkbox,{checked:a.value,onCheckedChange:b=>{a.onChange(b),b&&I.setValue("to_ts","")}})}),(0,b.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,b.jsx)(q.FormLabel,{children:"Permanent Assignment"}),(0,b.jsx)(q.FormDescription,{children:"Check if this is a permanent assignment (no end date)"})]}),(0,b.jsx)(q.FormMessage,{})]})})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end space-x-4 pt-6",children:[(0,b.jsx)(p.Button,{type:"button",variant:"outline",onClick:()=>a.back(),disabled:e,children:"Cancel"}),(0,b.jsx)(p.Button,{type:"submit",disabled:e,children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating Assignment..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Save,{className:"h-4 w-4 mr-2"}),"Create ","vehicle"===I.watch("assignment_type")?"Vehicle":"Equipment"," Assignment"]})})]})]})})})]})}}];

//# sourceMappingURL=src_app_%28dashboard%29_dashboard_equipment_assignments_new_page_tsx_113d0311._.js.map