module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},6953,(e,t,r)=>{},76856,e=>{"use strict";e.s(["handler",()=>N,"patchFetch",()=>E,"routeModule",()=>v,"serverHooks",()=>b,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>w],76856);var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),s=e.i(69741),i=e.i(16795),c=e.i(87718),l=e.i(95169),p=e.i(47587),d=e.i(66012),u=e.i(70101),m=e.i(26937),_=e.i(10372),x=e.i(93695);e.i(52474);var y=e.i(220);e.s(["GET",()=>g],51918);var h=e.i(89171);let j=(0,e.i(87464).createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro");async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("project_id"),a=t.get("start_date"),n=t.get("end_date"),o=t.get("year"),s=t.get("month"),i=j.from("costs").select(`
        id,
        project_id,
        cost_type,
        date,
        amount_eur,
        description,
        reference_type,
        reference_id,
        created_at,
        project:projects!costs_project_id_fkey(
          id,
          name,
          city
        )
      `),c=j.from("transactions").select(`
        id,
        project_id,
        amount,
        transaction_type,
        description,
        date,
        reference_id,
        created_at,
        project:projects!transactions_project_id_fkey(
          id,
          name,
          city
        )
      `);if(r&&(i=i.eq("project_id",r),c=c.eq("project_id",r)),a&&n)i=i.gte("date",a).lte("date",n),c=c.gte("date",a).lte("date",n);else if(o){let e=`${o}-01-01`,t=`${o}-12-31`;if(i=i.gte("date",e).lte("date",t),c=c.gte("date",e).lte("date",t),s){let e=s.padStart(2,"0"),t=`${o}-${e}-01`,r=new Date(parseInt(o),parseInt(s),0),a=`${o}-${e}-${r.getDate().toString().padStart(2,"0")}`;i=i.gte("date",t).lte("date",a),c=c.gte("date",t).lte("date",a)}}let[l,p]=await Promise.all([i,c]);if(l.error)return console.error("Supabase costs query error:",l.error),h.NextResponse.json({error:"Failed to fetch costs data"},{status:500});if(p.error)return console.error("Supabase transactions query error:",p.error),h.NextResponse.json({error:"Failed to fetch transactions data"},{status:500});let d=l.data||[],u=p.data||[],m=d.reduce((e,t)=>{let r=t.cost_type||"other";return e[r]||(e[r]={type:r,total:0,count:0,items:[]}),e[r].total+=Number(t.amount_eur)||0,e[r].count+=1,e[r].items.push(t),e},{}),_=u.reduce((e,t)=>{let r=t.transaction_type||"expense";return e[r]||(e[r]={type:r,total:0,count:0,items:[]}),e[r].total+=Number(t.amount)||0,e[r].count+=1,e[r].items.push(t),e},{}),x=d.reduce((e,t)=>e+(Number(t.amount_eur)||0),0),y=_.income?.total||0,g=_.expense?.total||0,f=y+g,v=null;o&&(v=Array.from({length:12},(e,t)=>{let r=t+1;r.toString().padStart(2,"0");let a=d.filter(e=>new Date(e.date).getMonth()+1===r).reduce((e,t)=>e+(Number(t.amount_eur)||0),0),n=u.filter(e=>new Date(e.date).getMonth()+1===r&&"income"===e.transaction_type).reduce((e,t)=>e+(Number(t.amount)||0),0),s=u.filter(e=>new Date(e.date).getMonth()+1===r&&"expense"===e.transaction_type).reduce((e,t)=>e+(Number(t.amount)||0),0);return{month:r,monthName:new Date(parseInt(o),t,1).toLocaleString("en",{month:"long"}),costs:a,income:n,expenses:s,net:n-s-a}}));let R=null;if(!r){let e=d.reduce((e,t)=>{let r=t.project_id;return e[r]||(e[r]={project_id:r,project_name:t.project?.name||"Unknown Project",project_city:t.project?.city||"",total_costs:0,costs_count:0}),e[r].total_costs+=Number(t.amount_eur)||0,e[r].costs_count+=1,e},{}),t=u.reduce((e,t)=>{let r=t.project_id;return e[r]||(e[r]={project_id:r,project_name:t.project?.name||"Unknown Project",project_city:t.project?.city||"",total_income:0,total_expenses:0,transactions_count:0}),"income"===t.transaction_type?e[r].total_income+=Number(t.amount)||0:e[r].total_expenses+=Number(t.amount)||0,e[r].transactions_count+=1,e},{}),r=new Set([...Object.keys(e),...Object.keys(t)]);R=Array.from(r).map(r=>{let a=e[r]||{},n=t[r]||{};return{project_id:r,project_name:a.project_name||n.project_name||"Unknown Project",project_city:a.project_city||n.project_city||"",total_costs:a.total_costs||0,total_income:n.total_income||0,total_expenses:n.total_expenses||0,net_profit:(n.total_income||0)-(n.total_expenses||0)-(a.total_costs||0),costs_count:a.costs_count||0,transactions_count:n.transactions_count||0}})}let w=[...d.map(e=>({id:e.id,type:"cost",subtype:e.cost_type,amount:Number(e.amount_eur)||0,description:e.description||`${e.cost_type} cost`,date:e.date,project:e.project?.name||"Unknown Project",created_at:e.created_at})),...u.map(e=>({id:e.id,type:"transaction",subtype:e.transaction_type,amount:Number(e.amount)||0,description:e.description||`${e.transaction_type} transaction`,date:e.date,project:e.project?.name||"Unknown Project",created_at:e.created_at}))].sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,10);return h.NextResponse.json({summary:{total_costs:x,total_income:y,total_expenses:g,total_transactions:f,net_profit:y-g-x,costs_count:d.length,transactions_count:u.length},costs_by_type:Object.values(m).map(e=>({type:e.type,total:e.total,count:e.count,percentage:x>0?(e.total/x*100).toFixed(2):0})),transactions_by_type:Object.values(_).map(e=>({type:e.type,total:e.total,count:e.count,percentage:f>0?(e.total/f*100).toFixed(2):0})),monthly_breakdown:v,project_summaries:R,recent_activity:w,filters:{project_id:r,start_date:a,end_date:n,year:o,month:s}})}catch(e){return console.error("Financial summary API error:",e),h.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}var f=e.i(51918);let v=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/financial/summary/route",pathname:"/api/financial/summary",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/financial/summary/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:R,workUnitAsyncStorage:w,serverHooks:b}=v;function E(){return(0,a.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:w})}async function N(e,t,a){var h;let j="/api/financial/summary/route";j=j.replace(/\/index$/,"")||"/";let g=await v.prepare(e,t,{srcPage:j,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:f,params:R,nextConfig:w,isDraftMode:b,prerenderManifest:E,routerServerContext:N,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:I}=g,k=(0,s.normalizeAppPath)(j),P=!!(E.dynamicRoutes[k]||E.routes[I]);if(P&&!b){let e=!!E.routes[I],t=E.dynamicRoutes[k];if(t&&!1===t.fallback&&!e)throw new x.NoFallbackError}let S=null;!P||v.isDev||b||(S="/index"===(S=I)?"/":S);let O=!0===v.isDev||!P,q=P&&!O,T=e.method||"GET",U=(0,o.getTracer)(),D=U.getActiveScopeSpan(),M={params:R,prerenderManifest:E,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:O,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(h=w.experimental)?void 0:h.cacheLife,isRevalidate:q,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>v.onRequestError(e,t,a,N)},sharedContext:{buildId:f}},H=new i.NodeNextRequest(e),$=new i.NodeNextResponse(t),F=c.NextRequestAdapter.fromNodeNextRequest(H,(0,c.signalFromNodeResponse)(t));try{let s=async r=>v.handle(F,M).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=U.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${T} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${T} ${e.url}`)}),i=async o=>{var i,c;let l=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&C&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(o);e.fetchMetrics=M.renderOpts.fetchMetrics;let c=M.renderOpts.pendingWaitUntil;c&&a.waitUntil&&(a.waitUntil(c),c=void 0);let l=M.renderOpts.collectedTags;if(!P)return await (0,d.sendResponse)(H,$,i,M.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,u.toNodeOutgoingHttpHeaders)(i.headers);l&&(t[_.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,a=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:q,isOnDemandRevalidate:C})},N),t}},x=await v.handleResponse({req:e,nextConfig:w,cacheKey:S,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:l,waitUntil:a.waitUntil});if(!P)return null;if((null==x||null==(i=x.value)?void 0:i.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==x||null==(c=x.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",C?"REVALIDATED":x.isMiss?"MISS":x.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,u.fromNodeOutgoingHttpHeaders)(x.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&P||h.delete(_.NEXT_CACHE_TAGS_HEADER),!x.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(x.cacheControl)),await (0,d.sendResponse)(H,$,new Response(x.value.body,{headers:h,status:x.value.status||200})),null};D?await i(D):await U.withPropagatedContext(e.headers,()=>U.trace(l.BaseServerSpan.handleRequest,{spanName:`${T} ${e.url}`,kind:o.SpanKind.SERVER,attributes:{"http.method":T,"http.target":e.url}},i))}catch(t){if(D||t instanceof x.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isRevalidate:q,isOnDemandRevalidate:C})}),P)throw t;return await (0,d.sendResponse)(H,$,new Response(null,{status:500})),null}}},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__09971278._.js.map