module.exports=[40874,e=>{"use strict";e.s(["handler",()=>C,"patchFetch",()=>I,"routeModule",()=>x,"serverHooks",()=>j,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>E],40874);var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),s=e.i(61916),i=e.i(69741),l=e.i(16795),o=e.i(87718),u=e.i(95169),d=e.i(47587),c=e.i(66012),p=e.i(70101),_=e.i(26937),m=e.i(10372),h=e.i(93695);e.i(52474);var v=e.i(220);e.s(["GET",()=>g,"POST",()=>R,"PUT",()=>b],86103);var f=e.i(89171);let y=(0,e.i(87464).createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro");async function g(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("per_page")||"20"),n=(r-1)*a,s=t.get("status"),i=t.get("type"),l=t.get("search"),o="true"===t.get("available_only"),u=t.get("project_id"),d=y.from("vehicles").select(`
        id,
        brand,
        model,
        plate_number,
        type,
        status,
        rental_cost_per_day,
        fuel_type,
        year_manufactured,
        description,
        is_active,
        created_at,
        updated_at,
        vehicle_assignments(
          id,
          project_id,
          crew_id,
          user_id,
          from_ts,
          to_ts,
          is_permanent,
          rental_cost_per_day,
          notes,
          created_at,
          project:projects(id, name, city),
          crew:crews(id, name),
          user:users(id, first_name, last_name, email)
        )
      `,{count:"exact"}).eq("is_active",!0).order("created_at",{ascending:!1}).range(n,n+a-1);s&&(d=d.eq("status",s)),i&&(d=d.eq("type",i)),l&&(d=d.or(`brand.ilike.%${l}%,model.ilike.%${l}%,plate_number.ilike.%${l}%`)),o&&(d=d.eq("status","available"));let{data:c,error:p,count:_}=await d;if(p)return console.error("Supabase vehicles query error:",p),f.NextResponse.json({error:"Failed to fetch vehicles data"},{status:500});let m=(c||[]).map(e=>{let t=(e.vehicle_assignments||[]).filter(e=>!e.to_ts||new Date(e.to_ts)>new Date),r=null;return(t.length>0&&(r=t[0]),u&&(!r||r.project_id!==u))?null:{id:e.id,brand:e.brand||"",model:e.model||"",plate_number:e.plate_number,type:e.type||"truck",status:e.status||"available",rental_cost_per_day:Number(e.rental_cost_per_day)||0,fuel_type:e.fuel_type||"diesel",year_manufactured:e.year_manufactured,description:e.description||"",is_active:e.is_active,full_name:`${e.brand||""} ${e.model||""} (${e.plate_number})`.trim(),age:e.year_manufactured?new Date().getFullYear()-e.year_manufactured:null,current_assignment:r?{id:r.id,project_id:r.project_id,crew_id:r.crew_id,user_id:r.user_id,from_ts:r.from_ts,to_ts:r.to_ts,is_permanent:r.is_permanent,rental_cost_per_day:Number(r.rental_cost_per_day)||0,notes:r.notes||"",project:r.project?{id:r.project.id,name:r.project.name,city:r.project.city}:null,crew:r.crew?{id:r.crew.id,name:r.crew.name}:null,assigned_user:r.user?{id:r.user.id,name:`${r.user.first_name} ${r.user.last_name}`,email:r.user.email}:null,duration_days:r.to_ts?Math.ceil((new Date(r.to_ts).getTime()-new Date(r.from_ts).getTime())/864e5):null}:null,assignments_count:e.vehicle_assignments?.length||0,created_at:e.created_at,updated_at:e.updated_at}}).filter(e=>null!==e),h=_||0,v={available:0,in_use:0,maintenance:0,broken:0},g={car:0,truck:0,van:0,trailer:0};m.forEach(e=>{v.hasOwnProperty(e.status)&&v[e.status]++,g.hasOwnProperty(e.type)&&g[e.type]++});let R=m.length>0?m.reduce((e,t)=>e+t.rental_cost_per_day,0)/m.length:0,b=m.filter(e=>null!==e.age).length>0?m.filter(e=>null!==e.age).reduce((e,t)=>e+t.age,0)/m.filter(e=>null!==e.age).length:0;return f.NextResponse.json({vehicles:m,pagination:{page:r,per_page:a,total:u?m.length:h,total_pages:Math.ceil((u?m.length:h)/a)},summary:{total_vehicles:u?m.length:h,status_counts:v,type_counts:g,assigned_vehicles:m.filter(e=>e.current_assignment).length,available_vehicles:v.available,average_rental_cost:Math.round(100*R)/100,average_age:Math.round(10*b)/10}})}catch(e){return console.error("Vehicles API error:",e),f.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function R(e){try{let{brand:t,model:r,plate_number:a,type:n="truck",status:s="available",rental_cost_per_day:i=0,fuel_type:l="diesel",year_manufactured:o,description:u=""}=await e.json();if(!a)return f.NextResponse.json({error:"Plate number is required"},{status:400});let d=["available","in_use","maintenance","broken"],c=["car","truck","van","trailer"],p=["diesel","petrol","electric","hybrid"];if(!d.includes(s))return f.NextResponse.json({error:`Invalid status. Must be one of: ${d.join(", ")}`},{status:400});if(!c.includes(n))return f.NextResponse.json({error:`Invalid type. Must be one of: ${c.join(", ")}`},{status:400});if(!p.includes(l))return f.NextResponse.json({error:`Invalid fuel type. Must be one of: ${p.join(", ")}`},{status:400});let{data:_}=await y.from("vehicles").select("id").eq("plate_number",a).single();if(_)return f.NextResponse.json({error:"Vehicle with this plate number already exists"},{status:409});let{data:m,error:h}=await y.from("vehicles").insert({brand:t||"",model:r||"",plate_number:a,type:n,status:s,rental_cost_per_day:Number(i),fuel_type:l,year_manufactured:o?parseInt(o):null,description:u,is_active:!0}).select(`
        id,
        brand,
        model,
        plate_number,
        type,
        status,
        rental_cost_per_day,
        fuel_type,
        year_manufactured,
        description,
        is_active,
        created_at,
        updated_at
      `).single();if(h)return console.error("Supabase vehicle creation error:",h),f.NextResponse.json({error:"Failed to create vehicle"},{status:500});let v={id:m.id,brand:m.brand||"",model:m.model||"",plate_number:m.plate_number,type:m.type,status:m.status,rental_cost_per_day:Number(m.rental_cost_per_day),fuel_type:m.fuel_type,year_manufactured:m.year_manufactured,description:m.description||"",is_active:m.is_active,full_name:`${m.brand||""} ${m.model||""} (${m.plate_number})`.trim(),age:m.year_manufactured?new Date().getFullYear()-m.year_manufactured:null,current_assignment:null,assignments_count:0,created_at:m.created_at,updated_at:m.updated_at};return f.NextResponse.json({message:"Vehicle created successfully",vehicle:v},{status:201})}catch(e){return console.error("Vehicles POST error:",e),f.NextResponse.json({error:"Failed to create vehicle"},{status:500})}}async function b(e){try{let{id:t,brand:r,model:a,status:n,rental_cost_per_day:s,fuel_type:i,year_manufactured:l,description:o}=await e.json();if(!t)return f.NextResponse.json({error:"Vehicle ID is required"},{status:400});let u={updated_at:new Date().toISOString()};void 0!==r&&(u.brand=r),void 0!==a&&(u.model=a),void 0!==n&&(u.status=n),void 0!==s&&(u.rental_cost_per_day=Number(s)),void 0!==i&&(u.fuel_type=i),void 0!==l&&(u.year_manufactured=l?parseInt(l):null),void 0!==o&&(u.description=o);let{data:d,error:c}=await y.from("vehicles").update(u).eq("id",t).select(`
        id,
        brand,
        model,
        plate_number,
        type,
        status,
        rental_cost_per_day,
        fuel_type,
        year_manufactured,
        description,
        is_active,
        created_at,
        updated_at
      `).single();if(c)return console.error("Supabase vehicle update error:",c),f.NextResponse.json({error:"Failed to update vehicle"},{status:500});return f.NextResponse.json({message:"Vehicle updated successfully",vehicle:d})}catch(e){return console.error("Vehicles PUT error:",e),f.NextResponse.json({error:"Failed to update vehicle"},{status:500})}}var w=e.i(86103);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/vehicles/route",pathname:"/api/vehicles",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/vehicles/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:N,workUnitAsyncStorage:E,serverHooks:j}=x;function I(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:E})}async function C(e,t,a){var f;let y="/api/vehicles/route";y=y.replace(/\/index$/,"")||"/";let g=await x.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:b,nextConfig:w,isDraftMode:N,prerenderManifest:E,routerServerContext:j,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,resolvedPathname:A}=g,T=(0,i.normalizeAppPath)(y),O=!!(E.dynamicRoutes[T]||E.routes[A]);if(O&&!N){let e=!!E.routes[A],t=E.dynamicRoutes[T];if(t&&!1===t.fallback&&!e)throw new h.NoFallbackError}let P=null;!O||x.isDev||N||(P="/index"===(P=A)?"/":P);let S=!0===x.isDev||!O,M=O&&!S,q=e.method||"GET",k=(0,s.getTracer)(),D=k.getActiveScopeSpan(),U={params:b,prerenderManifest:E,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:S,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(f=w.experimental)?void 0:f.cacheLife,isRevalidate:M,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>x.onRequestError(e,t,a,j)},sharedContext:{buildId:R}},$=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),H=o.NextRequestAdapter.fromNodeNextRequest($,(0,o.signalFromNodeResponse)(t));try{let i=async r=>x.handle(H,U).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=k.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${q} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${q} ${e.url}`)}),l=async s=>{var l,o;let u=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&I&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let l=await i(s);e.fetchMetrics=U.renderOpts.fetchMetrics;let o=U.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let u=U.renderOpts.collectedTags;if(!O)return await (0,c.sendResponse)($,F,l,U.renderOpts.pendingWaitUntil),null;{let e=await l.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(l.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==U.renderOpts.collectedRevalidate&&!(U.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&U.renderOpts.collectedRevalidate,a=void 0===U.renderOpts.collectedExpire||U.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:U.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:l.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:I})},j),t}},h=await x.handleResponse({req:e,nextConfig:w,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:a.waitUntil});if(!O)return null;if((null==h||null==(l=h.value)?void 0:l.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(o=h.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",I?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,p.fromNodeOutgoingHttpHeaders)(h.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&O||f.delete(m.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,_.getCacheControlHeader)(h.cacheControl)),await (0,c.sendResponse)($,F,new Response(h.value.body,{headers:f,status:h.value.status||200})),null};D?await l(D):await k.withPropagatedContext(e.headers,()=>k.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(D||t instanceof h.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:M,isOnDemandRevalidate:I})}),O)throw t;return await (0,c.sendResponse)($,F,new Response(null,{status:500})),null}}}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_1ef8fcb3.js.map