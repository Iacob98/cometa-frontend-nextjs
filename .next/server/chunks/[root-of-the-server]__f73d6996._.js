module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},44070,e=>{"use strict";e.s(["generateSecureFileName",()=>o,"supabase",()=>t]);let t=(0,e.i(87464).createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro",{auth:{persistSession:!0,autoRefreshToken:!0}});process.env.SUPABASE_PROJECT_PHOTOS_BUCKET,process.env.SUPABASE_WORK_PHOTOS_BUCKET,process.env.SUPABASE_PROJECT_DOCUMENTS_BUCKET,process.env.SUPABASE_HOUSE_DOCUMENTS_BUCKET,process.env.SUPABASE_USER_AVATARS_BUCKET,process.env.SUPABASE_REPORTS_BUCKET;let r={MAX_FILE_SIZE:0xa00000,MAX_FILES_PER_BATCH:5,ALLOWED_FILE_TYPES:{IMAGES:["image/jpeg","image/png","image/gif","image/webp"],DOCUMENTS:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],SPREADSHEETS:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],PLANS:["application/pdf","application/dwg","application/dxf"]},getAllowedTypes:()=>[...r.ALLOWED_FILE_TYPES.IMAGES,...r.ALLOWED_FILE_TYPES.DOCUMENTS,...r.ALLOWED_FILE_TYPES.SPREADSHEETS,...r.ALLOWED_FILE_TYPES.PLANS]},o=(e,t)=>{let r=Date.now(),o=Math.random().toString(36).substring(2,15),a=e.split(".").pop(),s=e.split(".")[0].toLowerCase().replace(/[^a-z0-9]/g,"-"),i=t?`${t}_`:"";return`${i}${s}_${r}_${o}.${a}`}},59757,e=>{"use strict";e.s(["BUCKET_CONFIGS",()=>t,"generateFolderPath",()=>o,"validateFileForBucket",()=>r]),e.i(44070);let t={"project-photos":{name:"project-photos",public:!1,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:0xa00000,description:"Project construction photos and progress images",folderStructure:"projects/{project_id}/{category}/{date}/",examplePath:"projects/abc123/before/2024-01-15/"},"work-photos":{name:"work-photos",public:!1,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:0xa00000,description:"Work entry photos showing completed work",folderStructure:"work-entries/{work_entry_id}/{timestamp}/",examplePath:"work-entries/we456/2024-01-15T10:30:00Z/"},"project-documents":{name:"project-documents",public:!1,allowedMimeTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/dwg","application/dxf"],fileSizeLimit:0x3200000,description:"Project documents, plans, and technical files",folderStructure:"projects/{project_id}/{document_type}/",examplePath:"projects/abc123/plans/"},"house-documents":{name:"house-documents",public:!1,allowedMimeTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"],fileSizeLimit:0xa00000,description:"House-specific documents and certificates",folderStructure:"houses/{project_id}/{house_id}/",examplePath:"houses/abc123/house_001/"},"user-avatars":{name:"user-avatars",public:!0,allowedMimeTypes:["image/jpeg","image/png","image/webp"],fileSizeLimit:2097152,description:"User profile pictures and avatars",folderStructure:"users/{user_id}/",examplePath:"users/user789/"},reports:{name:"reports",public:!1,allowedMimeTypes:["application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"],fileSizeLimit:0x1900000,description:"Generated reports and analytics files",folderStructure:"reports/{report_type}/{date}/",examplePath:"reports/financial/2024-01-15/"}};function r(e,r){let o=t[r],a=[];return e.size>o.fileSizeLimit&&a.push(`File size exceeds ${o.fileSizeLimit/1048576}MB limit for ${r}`),o.allowedMimeTypes.includes(e.type)||a.push(`File type ${e.type} is not allowed for ${r}`),{isValid:0===a.length,errors:a,config:o}}function o(e,r){let o=t[e].folderStructure;if(r.projectId&&(o=o.replace("{project_id}",r.projectId)),r.userId&&(o=o.replace("{user_id}",r.userId)),r.workEntryId&&(o=o.replace("{work_entry_id}",r.workEntryId)),r.houseId&&(o=o.replace("{house_id}",r.houseId)),r.reportType&&(o=o.replace("{report_type}",r.reportType)),r.category&&(o=o.replace("{category}",r.category)),r.date)o=o.replace("{date}",r.date);else{let e=new Date().toISOString().split("T")[0];o=(o=o.replace("{date}",e)).replace("{timestamp}",new Date().toISOString())}return o}},77175,(e,t,r)=>{},2068,e=>{"use strict";e.s(["handler",()=>b,"patchFetch",()=>P,"routeModule",()=>_,"serverHooks",()=>A,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>T],2068);var t=e.i(47909),r=e.i(74017),o=e.i(96250),a=e.i(59756),s=e.i(61916),i=e.i(69741),n=e.i(16795),p=e.i(87718),l=e.i(95169),c=e.i(47587),d=e.i(66012),u=e.i(70101),m=e.i(26937),h=e.i(10372),g=e.i(93695);e.i(52474);var f=e.i(220);e.s(["GET",()=>S,"POST",()=>w],33494);var x=e.i(89171),E=e.i(44070),y=e.i(59757),j=e.i(69719);let v=j.z.object({projectId:j.z.string().uuid(),category:j.z.enum(["before","progress","after","issues","materials","equipment"]).optional().default("progress"),description:j.z.string().optional(),tags:j.z.array(j.z.string()).optional(),location:j.z.object({latitude:j.z.number().optional(),longitude:j.z.number().optional(),address:j.z.string().optional()}).optional(),workEntryId:j.z.string().uuid().optional(),userId:j.z.string().uuid().optional()});async function w(e){try{let t,r=await e.formData(),o=r.get("metadata");if(!o)return x.NextResponse.json({error:"Missing project photo metadata"},{status:400});try{t=v.parse(JSON.parse(o))}catch(e){return x.NextResponse.json({error:"Invalid project photo metadata",details:e},{status:400})}let a=[];for(let[e,t]of r.entries())e.startsWith("file")&&t instanceof File&&a.push(t);if(0===a.length)return x.NextResponse.json({error:"No photo files provided"},{status:400});let s=[];for(let e of a){let t=(0,y.validateFileForBucket)(e,"project-photos");t.isValid||s.push(`${e.name}: ${t.errors.join(", ")}`)}if(s.length>0)return x.NextResponse.json({error:"Photo validation failed",details:s},{status:400});let i=(0,y.generateFolderPath)("project-photos",{projectId:t.projectId,category:t.category}),n=[],p=[];for(let e of a)try{let r=(0,E.generateSecureFileName)(e.name,t.userId),o=`${i}${r}`,a={projectId:t.projectId,category:t.category,description:t.description,tags:t.tags,location:t.location,workEntryId:t.workEntryId,uploadedBy:t.userId,originalName:e.name,mimeType:e.type,size:e.size},{data:s,error:l}=await E.supabase.storage.from("project-photos").upload(o,e,{contentType:e.type,cacheControl:"3600",upsert:!1,metadata:a});if(l){p.push({fileName:e.name,error:l.message});continue}let{data:c}=E.supabase.storage.from("project-photos").getPublicUrl(s.path),d={id:crypto.randomUUID(),fileName:r,originalName:e.name,size:e.size,type:e.type,url:c.publicUrl,path:s.path,bucketName:"project-photos",uploadedAt:new Date().toISOString(),metadata:a};n.push(d),console.log(`✅ Project photo uploaded: ${e.name} -> ${s.path}`)}catch(t){console.error(`❌ Error uploading project photo ${e.name}:`,t),p.push({fileName:e.name,error:t instanceof Error?t.message:"Unknown error"})}let l={success:n.length>0,message:`${n.length} project photo(s) uploaded successfully`,photos:n,errors:p,totalFiles:a.length,successCount:n.length,errorCount:p.length,projectId:t.projectId,category:t.category},c=n.length===a.length?200:207;return x.NextResponse.json(l,{status:c})}catch(e){return console.error("Project photo upload API error:",e),x.NextResponse.json({error:"Internal server error during project photo upload",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function S(e){try{let{searchParams:t}=new URL(e.url),r=t.get("projectId"),o=t.get("category"),a=parseInt(t.get("limit")||"50");if(!r)return x.NextResponse.json({error:"Project ID is required"},{status:400});let s=`projects/${r}/`;o&&(s+=`${o}/`);let{data:i,error:n}=await E.supabase.storage.from("project-photos").list(s,{limit:a,sortBy:{column:"created_at",order:"desc"}});if(n)return x.NextResponse.json({error:"Failed to list project photos",details:n.message},{status:500});let p=[];for(let e of i||[])if(e.id&&!e.name.endsWith("/")){let t=`${s}${e.name}`,{data:r}=E.supabase.storage.from("project-photos").getPublicUrl(t);p.push({id:e.id,name:e.name,size:e.metadata?.size||0,type:e.metadata?.mimetype||"image/jpeg",lastModified:e.updated_at||e.created_at,path:t,url:r.publicUrl,metadata:e.metadata||{}})}return x.NextResponse.json({projectId:r,category:o,photos:p,total:p.length,path:s})}catch(e){return console.error("Project photos listing API error:",e),x.NextResponse.json({error:"Internal server error during project photos listing",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}var R=e.i(33494);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/upload/project-photos/route",pathname:"/api/upload/project-photos",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/upload/project-photos/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:I,workUnitAsyncStorage:T,serverHooks:A}=_;function P(){return(0,o.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:T})}async function b(e,t,o){var x;let E="/api/upload/project-photos/route";E=E.replace(/\/index$/,"")||"/";let y=await _.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:j,params:v,nextConfig:w,isDraftMode:S,prerenderManifest:R,routerServerContext:I,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,resolvedPathname:P}=y,b=(0,i.normalizeAppPath)(E),C=!!(R.dynamicRoutes[b]||R.routes[P]);if(C&&!S){let e=!!R.routes[P],t=R.dynamicRoutes[b];if(t&&!1===t.fallback&&!e)throw new g.NoFallbackError}let N=null;!C||_.isDev||S||(N="/index"===(N=P)?"/":N);let O=!0===_.isDev||!C,U=C&&!O,k=e.method||"GET",M=(0,s.getTracer)(),z=M.getActiveScopeSpan(),L={params:v,prerenderManifest:R,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:O,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(x=w.experimental)?void 0:x.cacheLife,isRevalidate:U,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>_.onRequestError(e,t,o,I)},sharedContext:{buildId:j}},D=new n.NodeNextRequest(e),F=new n.NodeNextResponse(t),$=p.NextRequestAdapter.fromNodeNextRequest(D,(0,p.signalFromNodeResponse)(t));try{let i=async r=>_.handle($,L).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=M.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=o.get("next.route");if(a){let e=`${k} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${k} ${e.url}`)}),n=async s=>{var n,p;let l=async({previousCacheEntry:r})=>{try{if(!(0,a.getRequestMeta)(e,"minimalMode")&&T&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let p=L.renderOpts.pendingWaitUntil;p&&o.waitUntil&&(o.waitUntil(p),p=void 0);let l=L.renderOpts.collectedTags;if(!C)return await (0,d.sendResponse)(D,F,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,u.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[h.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,o=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:T})},I),t}},g=await _.handleResponse({req:e,nextConfig:w,cacheKey:N,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,responseGenerator:l,waitUntil:o.waitUntil});if(!C)return null;if((null==g||null==(n=g.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==g||null==(p=g.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,a.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",T?"REVALIDATED":g.isMiss?"MISS":g.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,u.fromNodeOutgoingHttpHeaders)(g.value.headers);return(0,a.getRequestMeta)(e,"minimalMode")&&C||x.delete(h.NEXT_CACHE_TAGS_HEADER),!g.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,m.getCacheControlHeader)(g.cacheControl)),await (0,d.sendResponse)(D,F,new Response(g.value.body,{headers:x,status:g.value.status||200})),null};z?await n(z):await M.withPropagatedContext(e.headers,()=>M.trace(l.BaseServerSpan.handleRequest,{spanName:`${k} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},n))}catch(t){if(z||t instanceof g.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:U,isOnDemandRevalidate:T})}),C)throw t;return await (0,d.sendResponse)(D,F,new Response(null,{status:500})),null}}},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f73d6996._.js.map