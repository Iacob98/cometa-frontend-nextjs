module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},61724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},44070,e=>{"use strict";e.s(["generateSecureFileName",()=>o,"supabase",()=>t]);let t=(0,e.i(87464).createClient)("https://oijmohlhdxoawzvctnxx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro",{auth:{persistSession:!0,autoRefreshToken:!0}});process.env.SUPABASE_PROJECT_PHOTOS_BUCKET,process.env.SUPABASE_WORK_PHOTOS_BUCKET,process.env.SUPABASE_PROJECT_DOCUMENTS_BUCKET,process.env.SUPABASE_HOUSE_DOCUMENTS_BUCKET,process.env.SUPABASE_USER_AVATARS_BUCKET,process.env.SUPABASE_REPORTS_BUCKET;let r={MAX_FILE_SIZE:0xa00000,MAX_FILES_PER_BATCH:5,ALLOWED_FILE_TYPES:{IMAGES:["image/jpeg","image/png","image/gif","image/webp"],DOCUMENTS:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],SPREADSHEETS:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],PLANS:["application/pdf","application/dwg","application/dxf"]},getAllowedTypes:()=>[...r.ALLOWED_FILE_TYPES.IMAGES,...r.ALLOWED_FILE_TYPES.DOCUMENTS,...r.ALLOWED_FILE_TYPES.SPREADSHEETS,...r.ALLOWED_FILE_TYPES.PLANS]},o=(e,t)=>{let r=Date.now(),o=Math.random().toString(36).substring(2,15),a=e.split(".").pop(),s=e.split(".")[0].toLowerCase().replace(/[^a-z0-9]/g,"-"),i=t?`${t}_`:"";return`${i}${s}_${r}_${o}.${a}`}},59757,e=>{"use strict";e.s(["BUCKET_CONFIGS",()=>t,"generateFolderPath",()=>o,"validateFileForBucket",()=>r]),e.i(44070);let t={"project-photos":{name:"project-photos",public:!1,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:0xa00000,description:"Project construction photos and progress images",folderStructure:"projects/{project_id}/{category}/{date}/",examplePath:"projects/abc123/before/2024-01-15/"},"work-photos":{name:"work-photos",public:!1,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:0xa00000,description:"Work entry photos showing completed work",folderStructure:"work-entries/{work_entry_id}/{timestamp}/",examplePath:"work-entries/we456/2024-01-15T10:30:00Z/"},"project-documents":{name:"project-documents",public:!1,allowedMimeTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/dwg","application/dxf"],fileSizeLimit:0x3200000,description:"Project documents, plans, and technical files",folderStructure:"projects/{project_id}/{document_type}/",examplePath:"projects/abc123/plans/"},"house-documents":{name:"house-documents",public:!1,allowedMimeTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"],fileSizeLimit:0xa00000,description:"House-specific documents and certificates",folderStructure:"houses/{project_id}/{house_id}/",examplePath:"houses/abc123/house_001/"},"user-avatars":{name:"user-avatars",public:!0,allowedMimeTypes:["image/jpeg","image/png","image/webp"],fileSizeLimit:2097152,description:"User profile pictures and avatars",folderStructure:"users/{user_id}/",examplePath:"users/user789/"},reports:{name:"reports",public:!1,allowedMimeTypes:["application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"],fileSizeLimit:0x1900000,description:"Generated reports and analytics files",folderStructure:"reports/{report_type}/{date}/",examplePath:"reports/financial/2024-01-15/"}};function r(e,r){let o=t[r],a=[];return e.size>o.fileSizeLimit&&a.push(`File size exceeds ${o.fileSizeLimit/1048576}MB limit for ${r}`),o.allowedMimeTypes.includes(e.type)||a.push(`File type ${e.type} is not allowed for ${r}`),{isValid:0===a.length,errors:a,config:o}}function o(e,r){let o=t[e].folderStructure;if(r.projectId&&(o=o.replace("{project_id}",r.projectId)),r.userId&&(o=o.replace("{user_id}",r.userId)),r.workEntryId&&(o=o.replace("{work_entry_id}",r.workEntryId)),r.houseId&&(o=o.replace("{house_id}",r.houseId)),r.reportType&&(o=o.replace("{report_type}",r.reportType)),r.category&&(o=o.replace("{category}",r.category)),r.date)o=o.replace("{date}",r.date);else{let e=new Date().toISOString().split("T")[0];o=(o=o.replace("{date}",e)).replace("{timestamp}",new Date().toISOString())}return o}},4850,(e,t,r)=>{},65211,e=>{"use strict";e.s(["handler",()=>j,"patchFetch",()=>b,"routeModule",()=>I,"serverHooks",()=>A,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>T],65211);var t=e.i(47909),r=e.i(74017),o=e.i(96250),a=e.i(59756),s=e.i(61916),i=e.i(69741),n=e.i(16795),l=e.i(87718),p=e.i(95169),d=e.i(47587),u=e.i(66012),c=e.i(70101),m=e.i(26937),g=e.i(10372),h=e.i(93695);e.i(52474);var f=e.i(220);e.s(["GET",()=>R,"POST",()=>S],2795);var x=e.i(89171),w=e.i(44070),E=e.i(59757),y=e.i(69719);let v=y.z.object({workEntryId:y.z.string().uuid(),stage:y.z.enum(["before","during","after","quality_check","issue"]).optional().default("after"),description:y.z.string().optional(),qualityRating:y.z.number().min(1).max(5).optional(),location:y.z.object({latitude:y.z.number().optional(),longitude:y.z.number().optional(),address:y.z.string().optional(),segmentId:y.z.string().uuid().optional(),cutId:y.z.string().uuid().optional()}).optional(),userId:y.z.string().uuid().optional(),issueType:y.z.enum(["safety","quality","materials","equipment","weather","other"]).optional(),tags:y.z.array(y.z.string()).optional()});async function S(e){try{let t,r=await e.formData(),o=r.get("metadata");if(!o)return x.NextResponse.json({error:"Missing work photo metadata"},{status:400});try{t=v.parse(JSON.parse(o))}catch(e){return x.NextResponse.json({error:"Invalid work photo metadata",details:e},{status:400})}let a=[];for(let[e,t]of r.entries())e.startsWith("file")&&t instanceof File&&a.push(t);if(0===a.length)return x.NextResponse.json({error:"No photo files provided"},{status:400});let s=[];for(let e of a){let t=(0,E.validateFileForBucket)(e,"work-photos");t.isValid||s.push(`${e.name}: ${t.errors.join(", ")}`)}if(s.length>0)return x.NextResponse.json({error:"Work photo validation failed",details:s},{status:400});let i=(0,E.generateFolderPath)("work-photos",{workEntryId:t.workEntryId}),n=[],l=[];for(let e of a)try{let r=(0,w.generateSecureFileName)(e.name,t.userId),o=`${i}${r}`,a={workEntryId:t.workEntryId,stage:t.stage,description:t.description,qualityRating:t.qualityRating,location:t.location,issueType:t.issueType,tags:t.tags,uploadedBy:t.userId,originalName:e.name,mimeType:e.type,size:e.size,timestamp:new Date().toISOString()},{data:s,error:p}=await w.supabase.storage.from("work-photos").upload(o,e,{contentType:e.type,cacheControl:"3600",upsert:!1,metadata:a});if(p){l.push({fileName:e.name,error:p.message});continue}let{data:d}=w.supabase.storage.from("work-photos").getPublicUrl(s.path),u={id:crypto.randomUUID(),fileName:r,originalName:e.name,size:e.size,type:e.type,url:d.publicUrl,path:s.path,bucketName:"work-photos",uploadedAt:new Date().toISOString(),metadata:a};n.push(u),console.log(`✅ Work photo uploaded: ${e.name} -> ${s.path}`)}catch(t){console.error(`❌ Error uploading work photo ${e.name}:`,t),l.push({fileName:e.name,error:t instanceof Error?t.message:"Unknown error"})}let p={success:n.length>0,message:`${n.length} work photo(s) uploaded successfully`,photos:n,errors:l,totalFiles:a.length,successCount:n.length,errorCount:l.length,workEntryId:t.workEntryId,stage:t.stage},d=n.length===a.length?200:207;return x.NextResponse.json(p,{status:d})}catch(e){return console.error("Work photo upload API error:",e),x.NextResponse.json({error:"Internal server error during work photo upload",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function R(e){try{let{searchParams:t}=new URL(e.url),r=t.get("workEntryId"),o=t.get("stage"),a=parseInt(t.get("limit")||"50");if(!r)return x.NextResponse.json({error:"Work Entry ID is required"},{status:400});let s=`work-entries/${r}/`,{data:i,error:n}=await w.supabase.storage.from("work-photos").list(s,{limit:a,sortBy:{column:"created_at",order:"desc"}});if(n)return x.NextResponse.json({error:"Failed to list work photos",details:n.message},{status:500});let l=[];for(let e of i||[])if(e.id&&!e.name.endsWith("/")){let t=`${s}${e.name}`;if(o&&e.metadata?.stage!==o)continue;let{data:r}=w.supabase.storage.from("work-photos").getPublicUrl(t);l.push({id:e.id,name:e.name,size:e.metadata?.size||0,type:e.metadata?.mimetype||"image/jpeg",lastModified:e.updated_at||e.created_at,path:t,url:r.publicUrl,metadata:e.metadata||{},stage:e.metadata?.stage||"unknown"})}return x.NextResponse.json({workEntryId:r,stage:o||"all",photos:l,total:l.length,path:s})}catch(e){return console.error("Work photos listing API error:",e),x.NextResponse.json({error:"Internal server error during work photos listing",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}var _=e.i(2795);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/upload/work-photos/route",pathname:"/api/upload/work-photos",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/upload/work-photos/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:k,workUnitAsyncStorage:T,serverHooks:A}=I;function b(){return(0,o.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:T})}async function j(e,t,o){var x;let w="/api/upload/work-photos/route";w=w.replace(/\/index$/,"")||"/";let E=await I.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:y,params:v,nextConfig:S,isDraftMode:R,prerenderManifest:_,routerServerContext:k,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,resolvedPathname:b}=E,j=(0,i.normalizeAppPath)(w),C=!!(_.dynamicRoutes[j]||_.routes[b]);if(C&&!R){let e=!!_.routes[b],t=_.dynamicRoutes[j];if(t&&!1===t.fallback&&!e)throw new h.NoFallbackError}let P=null;!C||I.isDev||R||(P="/index"===(P=b)?"/":P);let N=!0===I.isDev||!C,O=C&&!N,U=e.method||"GET",z=(0,s.getTracer)(),M=z.getActiveScopeSpan(),L={params:v,prerenderManifest:_,renderOpts:{experimental:{cacheComponents:!!S.experimental.cacheComponents,authInterrupts:!!S.experimental.authInterrupts},supportsDynamicResponse:N,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(x=S.experimental)?void 0:x.cacheLife,isRevalidate:O,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>I.onRequestError(e,t,o,k)},sharedContext:{buildId:y}},D=new n.NodeNextRequest(e),F=new n.NodeNextResponse(t),q=l.NextRequestAdapter.fromNodeNextRequest(D,(0,l.signalFromNodeResponse)(t));try{let i=async r=>I.handle(q,L).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=z.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=o.get("next.route");if(a){let e=`${U} ${a}`;r.setAttributes({"next.route":a,"http.route":a,"next.span_name":e}),r.updateName(e)}else r.updateName(`${U} ${e.url}`)}),n=async s=>{var n,l;let p=async({previousCacheEntry:r})=>{try{if(!(0,a.getRequestMeta)(e,"minimalMode")&&T&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&o.waitUntil&&(o.waitUntil(l),l=void 0);let p=L.renderOpts.collectedTags;if(!C)return await (0,u.sendResponse)(D,F,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,c.toNodeOutgoingHttpHeaders)(n.headers);p&&(t[g.NEXT_CACHE_TAGS_HEADER]=p),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,o=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:O,isOnDemandRevalidate:T})},k),t}},h=await I.handleResponse({req:e,nextConfig:S,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,responseGenerator:p,waitUntil:o.waitUntil});if(!C)return null;if((null==h||null==(n=h.value)?void 0:n.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(l=h.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,a.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",T?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,c.fromNodeOutgoingHttpHeaders)(h.value.headers);return(0,a.getRequestMeta)(e,"minimalMode")&&C||x.delete(g.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,m.getCacheControlHeader)(h.cacheControl)),await (0,u.sendResponse)(D,F,new Response(h.value.body,{headers:x,status:h.value.status||200})),null};M?await n(M):await z.withPropagatedContext(e.headers,()=>z.trace(p.BaseServerSpan.handleRequest,{spanName:`${U} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},n))}catch(t){if(M||t instanceof h.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isRevalidate:O,isOnDemandRevalidate:T})}),C)throw t;return await (0,u.sendResponse)(D,F,new Response(null,{status:500})),null}}},36145,e=>{e.v(e=>Promise.resolve().then(()=>e(2808)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1ee0af4b._.js.map