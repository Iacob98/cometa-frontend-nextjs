module.exports = [
"[project]/.next-internal/server/app/api/equipment/analytics/route/actions.js [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__, module, exports) => {

}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/src/app/api/equipment/analytics/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
;
;
const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(("TURBOPACK compile-time value", "https://oijmohlhdxoawzvctnxx.supabase.co"), ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pam1vaGxoZHhvYXd6dmN0bnh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyODUzMjcsImV4cCI6MjA3MDg2MTMyN30.vw9G5hcSfd-m5AZqeGlmzGvqc9ImYioDFR-AsiHoFro"));
async function GET(request) {
    try {
        const { searchParams } = new URL(request.url);
        const project_id = searchParams.get('project_id');
        const start_date = searchParams.get('start_date');
        const end_date = searchParams.get('end_date');
        const period = searchParams.get('period') || 'month'; // month, quarter, year
        // Get all equipment
        const { data: equipment, error: equipmentError } = await supabase.from('equipment').select(`
        id,
        name,
        type,
        inventory_no,
        status,
        rental_cost_per_day,
        purchase_date,
        warranty_until,
        description,
        is_active,
        created_at
      `).eq('is_active', true);
        if (equipmentError) {
            console.error('Supabase equipment query error:', equipmentError);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to fetch equipment data'
            }, {
                status: 500
            });
        }
        // Get equipment assignments with filters
        let assignmentsQuery = supabase.from('equipment_assignments').select(`
        id,
        equipment_id,
        project_id,
        crew_id,
        user_id,
        from_ts,
        to_ts,
        is_permanent,
        rental_cost_per_day,
        notes,
        created_at,
        equipment:equipment(
          id,
          name,
          type,
          inventory_no,
          rental_cost_per_day
        ),
        project:projects(
          id,
          name,
          city
        ),
        crew:crews(
          id,
          name
        ),
        user:users(
          id,
          first_name,
          last_name,
          email
        )
      `);
        // Apply filters
        if (project_id) {
            assignmentsQuery = assignmentsQuery.eq('project_id', project_id);
        }
        if (start_date && end_date) {
            assignmentsQuery = assignmentsQuery.gte('from_ts', start_date).lte('from_ts', end_date);
        } else if (start_date) {
            assignmentsQuery = assignmentsQuery.gte('from_ts', start_date);
        } else if (end_date) {
            assignmentsQuery = assignmentsQuery.lte('from_ts', end_date);
        }
        const { data: assignments, error: assignmentsError } = await assignmentsQuery;
        if (assignmentsError) {
            console.error('Supabase assignments query error:', assignmentsError);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to fetch assignments data'
            }, {
                status: 500
            });
        }
        // Get equipment maintenance records
        const { data: maintenance, error: maintenanceError } = await supabase.from('equipment_maintenance').select(`
        id,
        equipment_id,
        maintenance_type,
        description,
        cost,
        date,
        next_maintenance_date,
        performed_by,
        created_at,
        equipment:equipment(
          id,
          name,
          type,
          inventory_no
        )
      `);
        if (maintenanceError) {
            console.error('Supabase maintenance query error:', maintenanceError);
        // Continue without maintenance data
        }
        // Calculate analytics
        const totalEquipment = equipment?.length || 0;
        const totalAssignments = assignments?.length || 0;
        const totalMaintenance = maintenance?.length || 0;
        // Equipment status distribution
        const statusDistribution = (equipment || []).reduce((acc, item)=>{
            const status = item.status || 'available';
            acc[status] = (acc[status] || 0) + 1;
            return acc;
        }, {});
        // Equipment type distribution
        const typeDistribution = (equipment || []).reduce((acc, item)=>{
            const type = item.type || 'other';
            acc[type] = (acc[type] || 0) + 1;
            return acc;
        }, {});
        // Utilization rates (equipment that are currently assigned)
        const currentDate = new Date();
        const activeAssignments = (assignments || []).filter((assignment)=>{
            const fromDate = new Date(assignment.from_ts);
            const toDate = assignment.to_ts ? new Date(assignment.to_ts) : null;
            return fromDate <= currentDate && (!toDate || toDate > currentDate);
        });
        const utilizedEquipmentIds = new Set(activeAssignments.map((a)=>a.equipment_id));
        const utilizationRate = totalEquipment > 0 ? (utilizedEquipmentIds.size / totalEquipment * 100).toFixed(2) : 0;
        // Rental cost analytics
        const totalRentalValue = (equipment || []).reduce((sum, item)=>sum + (Number(item.rental_cost_per_day) || 0), 0);
        const averageRentalCost = totalEquipment > 0 ? totalRentalValue / totalEquipment : 0;
        // Assignment duration analytics
        const assignmentDurations = (assignments || []).map((assignment)=>{
            const fromDate = new Date(assignment.from_ts);
            const toDate = assignment.to_ts ? new Date(assignment.to_ts) : new Date();
            const durationDays = Math.ceil((toDate.getTime() - fromDate.getTime()) / (1000 * 60 * 60 * 24));
            return {
                ...assignment,
                duration_days: durationDays,
                daily_cost: Number(assignment.rental_cost_per_day) || Number(assignment.equipment?.rental_cost_per_day) || 0,
                total_cost: durationDays * (Number(assignment.rental_cost_per_day) || Number(assignment.equipment?.rental_cost_per_day) || 0)
            };
        });
        const totalRentalCosts = assignmentDurations.reduce((sum, assignment)=>sum + assignment.total_cost, 0);
        const averageAssignmentDuration = assignmentDurations.length > 0 ? assignmentDurations.reduce((sum, assignment)=>sum + assignment.duration_days, 0) / assignmentDurations.length : 0;
        // Project distribution
        const projectDistribution = {};
        (assignments || []).forEach((assignment)=>{
            const projectId = assignment.project_id;
            if (!projectDistribution[projectId]) {
                projectDistribution[projectId] = {
                    project_id: projectId,
                    project_name: assignment.project?.name || 'Unknown Project',
                    project_city: assignment.project?.city || '',
                    equipment_count: new Set(),
                    assignment_count: 0,
                    total_rental_cost: 0
                };
            }
            projectDistribution[projectId].equipment_count.add(assignment.equipment_id);
            projectDistribution[projectId].assignment_count += 1;
            projectDistribution[projectId].total_rental_cost += assignmentDurations.find((a)=>a.id === assignment.id)?.total_cost || 0;
        });
        // Convert Set to count for project distribution
        const formattedProjectDistribution = Object.values(projectDistribution).map((project)=>({
                ...project,
                equipment_count: project.equipment_count.size
            }));
        // Most used equipment
        const equipmentUsage = {};
        (assignments || []).forEach((assignment)=>{
            const equipmentId = assignment.equipment_id;
            if (!equipmentUsage[equipmentId]) {
                equipmentUsage[equipmentId] = {
                    equipment_id: equipmentId,
                    equipment_name: assignment.equipment?.name || 'Unknown Equipment',
                    equipment_type: assignment.equipment?.type || '',
                    inventory_no: assignment.equipment?.inventory_no || '',
                    assignment_count: 0,
                    total_days: 0,
                    total_cost: 0
                };
            }
            const assignmentData = assignmentDurations.find((a)=>a.id === assignment.id);
            if (assignmentData) {
                equipmentUsage[equipmentId].assignment_count += 1;
                equipmentUsage[equipmentId].total_days += assignmentData.duration_days;
                equipmentUsage[equipmentId].total_cost += assignmentData.total_cost;
            }
        });
        const topUsedEquipment = Object.values(equipmentUsage).sort((a, b)=>b.assignment_count - a.assignment_count).slice(0, 10);
        // Monthly trend (for the current year)
        const currentYear = new Date().getFullYear();
        const monthlyTrends = Array.from({
            length: 12
        }, (_, i)=>{
            const month = i + 1;
            const monthAssignments = (assignments || []).filter((assignment)=>{
                const assignmentDate = new Date(assignment.from_ts);
                return assignmentDate.getFullYear() === currentYear && assignmentDate.getMonth() + 1 === month;
            });
            const monthMaintenance = (maintenance || []).filter((m)=>{
                const maintenanceDate = new Date(m.date);
                return maintenanceDate.getFullYear() === currentYear && maintenanceDate.getMonth() + 1 === month;
            });
            const monthRentalCosts = monthAssignments.reduce((sum, assignment)=>{
                const assignmentData = assignmentDurations.find((a)=>a.id === assignment.id);
                return sum + (assignmentData?.total_cost || 0);
            }, 0);
            const monthMaintenanceCosts = monthMaintenance.reduce((sum, m)=>sum + (Number(m.cost) || 0), 0);
            return {
                month,
                monthName: new Date(currentYear, i, 1).toLocaleString('en', {
                    month: 'long'
                }),
                assignments: monthAssignments.length,
                maintenance_records: monthMaintenance.length,
                rental_costs: monthRentalCosts,
                maintenance_costs: monthMaintenanceCosts,
                total_costs: monthRentalCosts + monthMaintenanceCosts
            };
        });
        // Maintenance analytics
        const maintenanceStats = {
            total_maintenance: totalMaintenance,
            completed: 0,
            scheduled: totalMaintenance,
            overdue: (maintenance || []).filter((m)=>{
                const maintenanceDate = new Date(m.date);
                return maintenanceDate < currentDate;
            }).length,
            total_maintenance_cost: (maintenance || []).reduce((sum, m)=>sum + (Number(m.cost) || 0), 0)
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            summary: {
                total_equipment: totalEquipment,
                total_assignments: totalAssignments,
                active_assignments: activeAssignments.length,
                utilization_rate: Number(utilizationRate),
                total_rental_value: totalRentalValue,
                average_rental_cost: Math.round(averageRentalCost * 100) / 100,
                total_rental_costs: Math.round(totalRentalCosts * 100) / 100,
                average_assignment_duration: Math.round(averageAssignmentDuration * 10) / 10
            },
            distributions: {
                status: Object.entries(statusDistribution).map(([status, count])=>({
                        status,
                        count,
                        percentage: totalEquipment > 0 ? (count / totalEquipment * 100).toFixed(2) : 0
                    })),
                type: Object.entries(typeDistribution).map(([type, count])=>({
                        type,
                        count,
                        percentage: totalEquipment > 0 ? (count / totalEquipment * 100).toFixed(2) : 0
                    }))
            },
            project_distribution: formattedProjectDistribution,
            top_used_equipment: topUsedEquipment,
            monthly_trends: monthlyTrends,
            maintenance: maintenanceStats,
            filters: {
                project_id,
                start_date,
                end_date,
                period
            }
        });
    } catch (error) {
        console.error('Equipment analytics API error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error',
            details: error instanceof Error ? error.message : 'Unknown error'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__c167e094._.js.map