(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32661,e=>{"use strict";e.s(["useCreateProject",()=>u,"useDeleteProject",()=>d,"useProject",()=>l,"useProjectStats",()=>m,"useProjects",()=>o,"useUpdateProject",()=>c]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["projects"],lists:()=>[...n.all,"list"],list:e=>[...n.lists(),e],details:()=>[...n.all,"detail"],detail:e=>[...n.details(),e]};function o(e){return(0,t.useQuery)({queryKey:n.list(e||{}),queryFn:()=>i.projectsApi.getProjects(e),staleTime:3e5})}function l(e){return(0,t.useQuery)({queryKey:n.detail(e),queryFn:()=>i.projectsApi.getProject(e),enabled:!!e,staleTime:3e5})}function u(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.projectsApi.createProject(e),onSuccess:t=>{e.invalidateQueries({queryKey:n.lists()}),e.setQueryData(n.detail(t.id),t),a.toast.success("Project created successfully")},onError:e=>{a.toast.error("Failed to create project: ".concat(e.message))}})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.projectsApi.updateProject(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.detail(r)});let a=e.getQueryData(n.detail(r));return e.setQueryData(n.detail(r),e=>e?{...e,...s}:e),{previousProject:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousProject)&&e.setQueryData(n.detail(i),s.previousProject),a.toast.error("Failed to update project: ".concat(t.message))},onSuccess:t=>{e.invalidateQueries({queryKey:n.lists()}),a.toast.success("Project updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.detail(a)})}})}function d(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.projectsApi.deleteProject(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.detail(r)}),e.invalidateQueries({queryKey:n.lists()}),a.toast.success("Project deleted successfully")},onError:e=>{a.toast.error("Failed to delete project: ".concat(e.message))}})}function m(e){return(0,t.useQuery)({queryKey:[...n.detail(e),"stats"],queryFn:async()=>{let t=await fetch("/api/projects/".concat(e,"/stats"));if(!t.ok)throw Error("Failed to fetch project statistics");return t.json()},staleTime:12e4,enabled:!!e})}},24687,e=>{"use strict";e.s(["Textarea",()=>a]);var t=e.i(43476),r=e.i(71645),s=e.i(75157);let a=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...i})});a.displayName="Textarea"},71689,e=>{"use strict";e.s(["ArrowLeft",()=>t],71689);let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},56909,e=>{"use strict";e.s(["Save",()=>t],56909);let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},20306,e=>{"use strict";e.s(["useCreateCrew",()=>u,"useCreateTeam",()=>y,"useCrew",()=>l,"useDeleteCrew",()=>d,"useForemenUsers",()=>p,"useGlobalTeams",()=>m,"useProjectTeams",()=>j,"useTeams",()=>o,"useUpdateCrew",()=>c,"useUpdateTeam",()=>f]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["teams"],crews:()=>[...n.all,"crews"],crew:e=>[...n.all,"crew",e]};function o(){return(0,t.useQuery)({queryKey:n.crews(),queryFn:async()=>{let e=await fetch("/api/crews");if(!e.ok)throw Error("Failed to fetch crews");return(await e.json()).crews||[]},staleTime:3e4})}function l(e){return(0,t.useQuery)({queryKey:n.crew(e),queryFn:()=>i.teamsApi.getCrew(e),enabled:!!e,staleTime:3e5})}function u(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.teamsApi.createCrew(e),onSuccess:t=>{e.invalidateQueries({queryKey:n.crews()}),e.setQueryData(n.crew(t.id),t),a.toast.success("Team created successfully")},onError:e=>{a.toast.error("Failed to create team: ".concat(e.message))}})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.teamsApi.updateCrew(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.crew(r)});let a=e.getQueryData(n.crew(r));return e.setQueryData(n.crew(r),e=>e?{...e,...s}:e),{previousCrew:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousCrew)&&e.setQueryData(n.crew(i),s.previousCrew),a.toast.error("Failed to update team: ".concat(t.message))},onSuccess:()=>{e.invalidateQueries({queryKey:n.crews()}),a.toast.success("Team updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.crew(a)})}})}function d(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.teamsApi.deleteCrew(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.crew(r)}),e.invalidateQueries({queryKey:n.crews()}),a.toast.success("Team deleted successfully")},onError:e=>{a.toast.error("Failed to delete team: ".concat(e.message))}})}function m(){return(0,t.useQuery)({queryKey:["global-teams"],queryFn:async()=>{let e=await fetch("/api/crews");if(!e.ok)throw Error("Failed to fetch global teams");let t=(await e.json()).crews||[],r={};return t.forEach(e=>{e.project_id&&(r[e.name]=(r[e.name]||0)+1)}),t.map(e=>{var t;return{id:e.id,name:e.name,foreman_name:(null==(t=e.foreman)?void 0:t.full_name)||e.foreman_name,is_active:"active"===e.status,project_count:r[e.name]||0,specialization:"mixed"}})}})}function p(){return(0,t.useQuery)({queryKey:["foremen-users"],queryFn:async()=>{let e=await fetch("/api/users?role=foreman&is_active=true");if(!e.ok){let e=await fetch("/api/users?role=pm&is_active=true");if(!e.ok)throw Error("Failed to fetch users");return(await e.json()).items||[]}let t=await e.json();if(0===t.items.length){let e=await fetch("/api/users?is_active=true");if(!e.ok)throw Error("Failed to fetch users");return((await e.json()).items||[]).filter(e=>"foreman"===e.role||"pm"===e.role)}return t.items||[]}})}function y(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let t=await fetch("/api/crews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create team");return t.json()},onSuccess:(t,r)=>{r.project_id&&(e.invalidateQueries({queryKey:["project-teams",r.project_id]}),e.invalidateQueries({queryKey:["project-preparation",r.project_id]})),e.invalidateQueries({queryKey:["global-teams"]}),e.invalidateQueries({queryKey:n.crews()}),a.toast.success(t.message||"Team created successfully")},onError:e=>{a.toast.error(e.message)}})}function j(e){return(0,t.useQuery)({queryKey:["project-teams",e],queryFn:async()=>{let t=await fetch("/api/crews?project_id=".concat(e));if(!t.ok)throw Error("Failed to fetch project teams");return(await t.json()).crews||[]},enabled:!!e})}function f(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let{id:t,data:r}=e,s=await fetch("/api/crews/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error((await s.json()).error||"Failed to update team");return s.json()},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["project-teams"]}),e.invalidateQueries({queryKey:["global-teams"]}),e.invalidateQueries({queryKey:n.crews()}),e.invalidateQueries({queryKey:["project-preparation"]}),a.toast.success(t.message||"Team updated successfully")},onError:e=>{a.toast.error(e.message)}})}},46835,e=>{"use strict";e.s(["useDeleteUser",()=>u,"useProjectManagers",()=>c,"useUpdateUser",()=>l,"useUsers",()=>o]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["users"],lists:()=>[...n.all,"list"],list:e=>[...n.lists(),e],details:()=>[...n.all,"detail"],detail:e=>[...n.details(),e]};function o(e){return(0,t.useQuery)({queryKey:n.list(e||{}),queryFn:()=>i.usersApi.getUsers(e),staleTime:3e5})}function l(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.usersApi.updateUser(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.detail(r)});let a=e.getQueryData(n.detail(r));return e.setQueryData(n.detail(r),e=>e?{...e,...s}:e),{previousUser:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousUser)&&e.setQueryData(n.detail(i),s.previousUser),a.toast.error("Failed to update user: ".concat(t.message))},onSuccess:()=>{e.invalidateQueries({queryKey:n.lists()}),a.toast.success("User updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.detail(a)})}})}function u(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.usersApi.deleteUser(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.detail(r)}),e.invalidateQueries({queryKey:n.lists()}),a.toast.success("User deleted successfully")},onError:e=>{a.toast.error("Failed to delete user: ".concat(e.message))}})}function c(){return o({role:"pm",page:1,per_page:50})}},55444,e=>{"use strict";e.s(["default",()=>v]);var t=e.i(43476),r=e.i(18566),s=e.i(53145),a=e.i(94814),i=e.i(81307),n=e.i(71689),o=e.i(61911),l=e.i(56909),u=e.i(37727),c=e.i(19455),d=e.i(93479),m=e.i(24687),p=e.i(15288),y=e.i(3133),j=e.i(67489),f=e.i(46835),h=e.i(20306),x=e.i(32661);let w=i.z.object({name:i.z.string().min(1,"Team name is required"),description:i.z.string().optional(),foreman_user_id:i.z.string().optional(),project_id:i.z.string().optional()});function v(){let e=(0,r.useRouter)(),i=(0,h.useCreateCrew)(),v=(0,s.useForm)({resolver:(0,a.zodResolver)(w),defaultValues:{name:"",description:"",foreman_user_id:"",project_id:""}}),{data:g,isLoading:F}=(0,f.useUsers)({page:1,per_page:100}),{data:Q,isLoading:b}=(0,x.useProjects)({page:1,per_page:50}),C=(null==g?void 0:g.items)||[],q=(null==Q?void 0:Q.items)||[],S=C.filter(e=>["foreman","pm","admin"].includes(e.role)),T=async t=>{try{let r={name:t.name,description:t.description,foreman_user_id:"none"===t.foreman_user_id?void 0:t.foreman_user_id,project_id:"none"===t.project_id?void 0:t.project_id},s=await i.mutateAsync(r);e.push("/dashboard/teams/".concat(s.id,"/members"))}catch(t){console.error("Failed to create team:",t),e.push("/dashboard/teams")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(c.Button,{variant:"ghost",size:"sm",onClick:()=>e.back(),className:"flex items-center space-x-2",children:[(0,t.jsx)(n.ArrowLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Back"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Create New Team"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Set up a new work crew with basic information"})]})]})}),(0,t.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,t.jsxs)(p.Card,{children:[(0,t.jsxs)(p.CardHeader,{children:[(0,t.jsxs)(p.CardTitle,{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.Users,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Team Information"})]}),(0,t.jsx)(p.CardDescription,{children:"Basic team details and leadership assignment"})]}),(0,t.jsx)(p.CardContent,{children:(0,t.jsx)(y.Form,{...v,children:(0,t.jsxs)("form",{onSubmit:v.handleSubmit(T),className:"space-y-4",children:[(0,t.jsx)(y.FormField,{control:v.control,name:"name",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Team Name *"}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(d.Input,{placeholder:"e.g., Installation Team Alpha",...r})}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:v.control,name:"description",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Description"}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(m.Textarea,{placeholder:"Brief description of team purpose and responsibilities",...r})}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:v.control,name:"foreman_user_id",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Team Leader / Foreman"}),(0,t.jsxs)(j.Select,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(j.SelectTrigger,{children:(0,t.jsx)(j.SelectValue,{placeholder:"Select team leader"})})}),(0,t.jsxs)(j.SelectContent,{children:[(0,t.jsx)(j.SelectItem,{value:"none",children:"No leader assigned"}),S.map(e=>(0,t.jsxs)(j.SelectItem,{value:e.id,children:[e.full_name," (",e.role,")"]},e.id))]})]}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:v.control,name:"project_id",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Assign to Project"}),(0,t.jsxs)(j.Select,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(j.SelectTrigger,{children:(0,t.jsx)(j.SelectValue,{placeholder:"Select project (optional)"})})}),(0,t.jsxs)(j.SelectContent,{children:[(0,t.jsx)(j.SelectItem,{value:"none",children:"No project assigned"}),b?(0,t.jsx)(j.SelectItem,{value:"loading",disabled:!0,children:"Loading projects..."}):q.map(e=>(0,t.jsx)(j.SelectItem,{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,t.jsxs)(c.Button,{type:"button",variant:"outline",onClick:()=>e.back(),children:[(0,t.jsx)(u.X,{className:"mr-2 h-4 w-4"}),"Cancel"]}),(0,t.jsxs)(c.Button,{type:"submit",disabled:i.isPending,children:[i.isPending?(0,t.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent mr-2"}):(0,t.jsx)(l.Save,{className:"mr-2 h-4 w-4"}),"Create Team"]})]})]})})})]})})]})}}]);