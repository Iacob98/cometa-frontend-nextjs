(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87130,e=>{"use strict";e.s(["Filter",()=>s],87130);let s=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},46897,e=>{"use strict";e.s(["MapPin",()=>s],46897);let s=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},3116,e=>{"use strict";e.s(["Clock",()=>s],3116);let s=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},86536,e=>{"use strict";e.s(["Eye",()=>s],86536);let s=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7233,e=>{"use strict";e.s(["Plus",()=>s],7233);let s=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},84774,e=>{"use strict";e.s(["Table",()=>r,"TableBody",()=>n,"TableCell",()=>d,"TableHead",()=>c,"TableHeader",()=>l,"TableRow",()=>i]);var s=e.i(43476),a=e.i(71645),t=e.i(75157);let r=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:a,className:(0,t.cn)("w-full caption-bottom text-sm",r),...l})})});r.displayName="Table";let l=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("thead",{ref:a,className:(0,t.cn)("[&_tr]:border-b",r),...l})});l.displayName="TableHeader";let n=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("tbody",{ref:a,className:(0,t.cn)("[&_tr:last-child]:border-0",r),...l})});n.displayName="TableBody",a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("tfoot",{ref:a,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...l})}).displayName="TableFooter";let i=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("tr",{ref:a,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l})});i.displayName="TableRow";let c=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("th",{ref:a,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l})});c.displayName="TableHead";let d=a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("td",{ref:a,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l})});d.displayName="TableCell",a.forwardRef((e,a)=>{let{className:r,...l}=e;return(0,s.jsx)("caption",{ref:a,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",r),...l})}).displayName="TableCaption"},88980,e=>{"use strict";e.s(["useApproveWorkEntry",()=>o,"useCreateWorkEntry",()=>c,"useDeleteWorkEntry",()=>d,"usePendingApprovals",()=>u,"useWorkEntries",()=>n,"useWorkEntry",()=>i,"useWorkStages",()=>h]);var s=e.i(66027),a=e.i(54616),t=e.i(12598),r=e.i(46696);let l={all:["work-entries"],lists:()=>[...l.all,"list"],list:e=>[...l.lists(),e],details:()=>[...l.all,"detail"],detail:e=>[...l.details(),e],stages:()=>[...l.all,"stages"]};function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new URLSearchParams;return Object.entries(e).forEach(e=>{let[s,t]=e;null!=t&&""!==t&&a.append(s,t.toString())}),(0,s.useQuery)({queryKey:l.list(e),queryFn:async()=>{let e=await fetch("/api/work-entries?".concat(a.toString()));if(!e.ok)throw Error("Failed to fetch work entries");return e.json()}})}function i(e){return(0,s.useQuery)({queryKey:l.detail(e),queryFn:async()=>{let s=await fetch("/api/work-entries/".concat(e));if(!s.ok)throw Error("Failed to fetch work entry");return s.json()},enabled:!!e})}function c(){let e=(0,t.useQueryClient)();return(0,a.useMutation)({mutationFn:async e=>{let s=await fetch("/api/work-entries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw Error((await s.json()).error||"Failed to create work entry");return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:l.lists()}),r.toast.success("Work entry created successfully")},onError:e=>{r.toast.error(e.message)}})}function d(){let e=(0,t.useQueryClient)();return(0,a.useMutation)({mutationFn:async e=>{let s=await fetch("/api/work-entries/".concat(e),{method:"DELETE"});if(!s.ok)throw Error((await s.json()).error||"Failed to delete work entry");return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:l.lists()}),r.toast.success("Work entry deleted successfully")},onError:e=>{r.toast.error(e.message)}})}function o(){let e=(0,t.useQueryClient)();return(0,a.useMutation)({mutationFn:async e=>{let s=await fetch("/api/work-entries/".concat(e,"/approve"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error((await s.json()).error||"Failed to approve work entry");return s.json()},onSuccess:()=>{e.invalidateQueries({queryKey:l.lists()}),r.toast.success("Work entry approved successfully")},onError:e=>{r.toast.error(e.message)}})}function u(){return n({approved:"false",page:1,per_page:50})}function h(){return(0,s.useQuery)({queryKey:l.stages(),queryFn:async()=>{let e=await fetch("/api/work-stages");if(!e.ok)throw Error("Failed to fetch work stages");return e.json()},staleTime:6e5})}},59386,e=>{"use strict";e.s(["Ruler",()=>s],59386);let s=(0,e.i(75254).default)("ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]])},68553,e=>{"use strict";e.s(["Camera",()=>s],68553);let s=(0,e.i(75254).default)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},55283,e=>{"use strict";e.s(["default",()=>C]);var s=e.i(43476),a=e.i(71645),t=e.i(18566),r=e.i(7233),l=e.i(55436),n=e.i(87130),i=e.i(46897),c=e.i(84614),d=e.i(86536),o=e.i(69638),u=e.i(3116),h=e.i(7486),m=e.i(68553),x=e.i(59386),p=e.i(19455),j=e.i(93479),g=e.i(15288),y=e.i(87486),f=e.i(84774),v=e.i(55146),k=e.i(67489),w=e.i(77572),b=e.i(88980),N=e.i(71436);function C(){let e=(0,t.useRouter)(),{user:C}=(0,N.useAuth)(),{canApproveWork:_,canManageWork:T}=(0,N.usePermissions)(),S=(0,b.useApproveWorkEntry)(),[E,A]=(0,a.useState)(""),[P,M]=(0,a.useState)("all"),[W,F]=(0,a.useState)("all"),{data:D,isLoading:R,error:H}=(0,b.useWorkEntries)({stage_code:"all"===P?void 0:P,approved:"all"===W?void 0:"approved"===W,page:1,per_page:20}),{data:I}=(0,b.usePendingApprovals)(),B=(null==D?void 0:D.items)||[],q=(null==I?void 0:I.items)||[],Q=async e=>{try{await S.mutateAsync(e)}catch(e){console.error("Failed to approve work entry:",e)}},L=e=>({stage_1_marking:"Marking",stage_2_excavation:"Excavation",stage_3_conduit:"Conduit Installation",stage_4_cable_pulling:"Cable Pulling",stage_5_closure:"Closure",stage_6_testing:"Testing",stage_7_backfill:"Backfilling",stage_8_restoration:"Surface Restoration",stage_9_documentation:"Documentation",stage_10_quality_check:"Quality Check"})[e]||e;return H?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Work Entries"})}),(0,s.jsx)(g.Card,{children:(0,s.jsx)(g.CardContent,{className:"py-8",children:(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:"Failed to load work entries. Please try again later."})})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Work Entries"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Track and manage field work progress across all projects"})]}),(0,s.jsxs)(p.Button,{onClick:()=>e.push("/dashboard/work-entries/new"),children:[(0,s.jsx)(r.Plus,{className:"mr-2 h-4 w-4"}),"New Work Entry"]})]}),(0,s.jsxs)(w.Tabs,{defaultValue:"all",className:"space-y-4",children:[(0,s.jsxs)(w.TabsList,{children:[(0,s.jsx)(w.TabsTrigger,{value:"all",children:"All Work Entries"}),_&&(0,s.jsxs)(w.TabsTrigger,{value:"pending",children:["Pending Approval (",q.length,")"]}),(0,s.jsx)(w.TabsTrigger,{value:"my-work",children:"My Work"})]}),(0,s.jsxs)(w.TabsContent,{value:"all",className:"space-y-6",children:[(0,s.jsxs)(g.Card,{children:[(0,s.jsxs)(g.CardHeader,{children:[(0,s.jsx)(g.CardTitle,{children:"Filter Work Entries"}),(0,s.jsx)(g.CardDescription,{children:"Search and filter work entries by various criteria"})]}),(0,s.jsx)(g.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4 md:flex-row md:space-y-0 md:space-x-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(l.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(j.Input,{placeholder:"Search by project, notes, or worker...",value:E,onChange:e=>A(e.target.value),className:"pl-8"})]})}),(0,s.jsxs)(k.Select,{value:P,onValueChange:e=>M(e),children:[(0,s.jsx)(k.SelectTrigger,{className:"w-48",children:(0,s.jsx)(k.SelectValue,{placeholder:"Filter by stage"})}),(0,s.jsxs)(k.SelectContent,{children:[(0,s.jsx)(k.SelectItem,{value:"all",children:"All Stages"}),(0,s.jsx)(k.SelectItem,{value:"stage_1_marking",children:"Marking"}),(0,s.jsx)(k.SelectItem,{value:"stage_2_excavation",children:"Excavation"}),(0,s.jsx)(k.SelectItem,{value:"stage_3_conduit",children:"Conduit Installation"}),(0,s.jsx)(k.SelectItem,{value:"stage_4_cable_pulling",children:"Cable Pulling"}),(0,s.jsx)(k.SelectItem,{value:"stage_5_closure",children:"Closure"}),(0,s.jsx)(k.SelectItem,{value:"stage_6_testing",children:"Testing"}),(0,s.jsx)(k.SelectItem,{value:"stage_7_backfill",children:"Backfilling"}),(0,s.jsx)(k.SelectItem,{value:"stage_8_restoration",children:"Surface Restoration"}),(0,s.jsx)(k.SelectItem,{value:"stage_9_documentation",children:"Documentation"}),(0,s.jsx)(k.SelectItem,{value:"stage_10_quality_check",children:"Quality Check"})]})]}),(0,s.jsxs)(k.Select,{value:W,onValueChange:e=>F(e),children:[(0,s.jsx)(k.SelectTrigger,{className:"w-48",children:(0,s.jsx)(k.SelectValue,{placeholder:"Filter by approval"})}),(0,s.jsxs)(k.SelectContent,{children:[(0,s.jsx)(k.SelectItem,{value:"all",children:"All Status"}),(0,s.jsx)(k.SelectItem,{value:"approved",children:"Approved"}),(0,s.jsx)(k.SelectItem,{value:"pending",children:"Pending Approval"})]})]})]})})]}),(0,s.jsxs)(g.Card,{children:[(0,s.jsx)(g.CardHeader,{children:(0,s.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(h.Building2,{className:"h-5 w-5"}),"Work Entries (",(null==D?void 0:D.total)||0,")"]})}),(0,s.jsx)(g.CardContent,{children:R?(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded flex-1"}),(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded w-20"}),(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded w-16"})]},a))}):0===B.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(h.Building2,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"No work entries found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:E||"all"!==P||"all"!==W?"No work entries match your current filters.":"Get started by creating your first work entry."}),(0,s.jsxs)(p.Button,{className:"mt-4",onClick:()=>e.push("/dashboard/work-entries/new"),children:[(0,s.jsx)(r.Plus,{className:"mr-2 h-4 w-4"}),"Create Work Entry"]})]}):(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Date & Worker"}),(0,s.jsx)(f.TableHead,{children:"Stage & Progress"}),(0,s.jsx)(f.TableHead,{children:"Project"}),(0,s.jsx)(f.TableHead,{children:"Location"}),(0,s.jsx)(f.TableHead,{children:"Status"}),(0,s.jsx)(f.TableHead,{children:"Photos"}),(0,s.jsx)(f.TableHead,{className:"w-[100px]",children:"Actions"})]})}),(0,s.jsx)(f.TableBody,{children:B.map(a=>{var t,r,l;return(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:new Date(a.date).toLocaleDateString()}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center space-x-1",children:[(0,s.jsx)(c.User,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:(null==(t=a.user)?void 0:t.full_name)||"Unknown"})]})]})}),(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(y.Badge,{variant:!(l=a.stage_code)||l.includes("marking")||l.includes("excavation")?"secondary":l.includes("cable")||l.includes("conduit")?"default":l.includes("testing")||l.includes("quality")?"outline":"secondary",children:L(a.stage_code)}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center space-x-1",children:[(0,s.jsx)(x.Ruler,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[a.meters_done_m,"m"]})]})]})}),(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)("div",{className:"text-sm",children:["Project ",a.project_id]})}),(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)("div",{className:"text-sm flex items-center space-x-1",children:[(0,s.jsx)(i.MapPin,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsx)("span",{children:a.cut_id?"Cut ".concat(a.cut_id):a.cabinet_id?"Cabinet ".concat(a.cabinet_id):"—"})]})}),(0,s.jsx)(f.TableCell,{children:a.approved_at?(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-green-600",children:[(0,s.jsx)(o.CheckCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Approved"})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-amber-600",children:[(0,s.jsx)(u.Clock,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Pending"})]})}),(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(m.Camera,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm",children:(null==(r=a.photos)?void 0:r.length)||0})]})}),(0,s.jsx)(f.TableCell,{children:(0,s.jsxs)(v.DropdownMenu,{children:[(0,s.jsx)(v.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(p.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,s.jsx)(n.Filter,{className:"h-4 w-4"})]})}),(0,s.jsxs)(v.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(v.DropdownMenuLabel,{children:"Actions"}),(0,s.jsxs)(v.DropdownMenuItem,{onClick:()=>e.push("/dashboard/work-entries/".concat(a.id)),children:[(0,s.jsx)(d.Eye,{className:"mr-2 h-4 w-4"}),"View Details"]}),_&&!a.approved_at&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.DropdownMenuSeparator,{}),(0,s.jsxs)(v.DropdownMenuItem,{onClick:()=>Q(a.id),disabled:S.isPending,children:[(0,s.jsx)(o.CheckCircle,{className:"mr-2 h-4 w-4"}),"Approve Entry"]})]})]})]})})]},a.id)})})]})})]})]}),_&&(0,s.jsx)(w.TabsContent,{value:"pending",className:"space-y-6",children:(0,s.jsxs)(g.Card,{children:[(0,s.jsxs)(g.CardHeader,{children:[(0,s.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(u.Clock,{className:"h-5 w-5"}),"Pending Approvals (",q.length,")"]}),(0,s.jsx)(g.CardDescription,{children:"Work entries waiting for your approval"})]}),(0,s.jsx)(g.CardContent,{children:0===q.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(o.CheckCircle,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"No pending approvals"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"All work entries have been approved."})]}):(0,s.jsx)("div",{className:"space-y-4",children:q.map(a=>{var t;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"font-medium",children:[L(a.stage_code)," - ",a.meters_done_m,"m"]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[null==(t=a.user)?void 0:t.full_name," • ",new Date(a.date).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>e.push("/dashboard/work-entries/".concat(a.id)),children:[(0,s.jsx)(d.Eye,{className:"mr-2 h-4 w-4"}),"View"]}),(0,s.jsxs)(p.Button,{size:"sm",onClick:()=>Q(a.id),disabled:S.isPending,children:[(0,s.jsx)(o.CheckCircle,{className:"mr-2 h-4 w-4"}),"Approve"]})]})]},a.id)})})})]})}),(0,s.jsx)(w.TabsContent,{value:"my-work",className:"space-y-6",children:(0,s.jsxs)(g.Card,{children:[(0,s.jsxs)(g.CardHeader,{children:[(0,s.jsx)(g.CardTitle,{children:"My Work Entries"}),(0,s.jsx)(g.CardDescription,{children:"Work entries you have created"})]}),(0,s.jsx)(g.CardContent,{children:(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"My work entries view will be implemented based on current user context."})})]})})]})]})}}]);