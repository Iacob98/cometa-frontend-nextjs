(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25652,e=>{"use strict";e.s(["TrendingUp",()=>s],25652);let s=(0,e.i(75254).default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},2747,e=>{"use strict";e.s(["Skeleton",()=>a]);var s=e.i(43476),t=e.i(75157);function a(e){let{className:a,...r}=e;return(0,s.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-muted",a),...r})}},16715,e=>{"use strict";e.s(["RefreshCw",()=>s],16715);let s=(0,e.i(75254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},33602,e=>{"use strict";e.s(["default",()=>v],33602);var s=e.i(43476),t=e.i(7486),a=e.i(61911),r=e.i(91741),i=e.i(63209),n=e.i(25652),l=e.i(21218),c=e.i(16715),d=e.i(15288),o=e.i(87486),x=e.i(19455),m=e.i(71436),h=e.i(66027),u=e.i(12598);async function j(){let e=await fetch("/api/dashboard/stats");if(!e.ok)throw Error("Failed to fetch dashboard statistics");return e.json()}async function p(){let e=await fetch("/api/activities?page=1&per_page=10");if(!e.ok)throw Error("Failed to fetch recent activities");return(await e.json()).activities||[]}var f=e.i(2747);function v(){let{user:e,isAdmin:v,isProjectManager:N,isWorker:g,isForeman:y}=(0,m.usePermissions)(),w=g||y||N||v,{data:C,isLoading:b,error:k}=(0,h.useQuery)({queryKey:["dashboard-stats"],queryFn:j,staleTime:3e4,gcTime:3e5,refetchInterval:6e4,refetchOnWindowFocus:!0,retry:(e,s)=>{if(s instanceof Error&&"status"in s){let e=s.status;if(e>=400&&e<500)return!1}return e<3}}),{data:T,isLoading:A}=(0,h.useQuery)({queryKey:["recent-activities"],queryFn:p,staleTime:3e4,gcTime:6e5,refetchInterval:12e4,refetchOnWindowFocus:!0,retry:(e,s)=>{if(s instanceof Error&&"status"in s){let e=s.status;if(e>=400&&e<500)return!1}return e<3}}),{refreshDashboard:B}=function(){let e=(0,u.useQueryClient)();return{refreshDashboard:async()=>{await e.invalidateQueries({queryKey:["dashboard-stats"],refetchType:"active"}),await e.invalidateQueries({queryKey:["recent-activities"],refetchType:"active"})}}}(),W=(null==T?void 0:T.slice(0,3))||[],L={activeProjects:(null==C?void 0:C.projects.active)||0,totalWorkEntries:(null==C?void 0:C.workEntries.total)||0,pendingApprovals:(null==C?void 0:C.workEntries.pendingApprovals)||0,activeWorkers:(null==C?void 0:C.team.activeWorkers)||0},S=k||(null==C?void 0:C.error);return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold tracking-tight",children:["Welcome back, ",null==e?void 0:e.first_name,"!"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Here's what's happening in your fiber optic construction projects today."}),S&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-amber-600",children:[(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Using cached data - database connection issue"})]}),(null==C?void 0:C.lastUpdated)&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Last updated: ",new Date(C.lastUpdated).toLocaleTimeString()]})]}),(0,s.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:B,disabled:b,className:"flex items-center gap-2",children:[(0,s.jsx)(c.RefreshCw,{className:"h-4 w-4 ".concat(b?"animate-spin":"")}),"Refresh"]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Active Projects"}),(0,s.jsx)(t.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(d.CardContent,{children:[b?(0,s.jsx)(f.Skeleton,{className:"h-8 w-16 mb-1"}):(0,s.jsx)("div",{className:"text-2xl font-bold",children:L.activeProjects}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==C?void 0:C.projects.total)?"of ".concat(C.projects.total," total projects"):"Loading..."})]})]}),(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Work Entries"}),(0,s.jsx)(r.ClipboardList,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(d.CardContent,{children:[b?(0,s.jsx)(f.Skeleton,{className:"h-8 w-16 mb-1"}):(0,s.jsx)("div",{className:"text-2xl font-bold",children:L.totalWorkEntries}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==C?void 0:C.workEntries.thisWeek)?"+".concat(C.workEntries.thisWeek," this week"):"Loading..."})]})]}),(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Pending Approvals"}),(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(d.CardContent,{children:[b?(0,s.jsx)(f.Skeleton,{className:"h-8 w-16 mb-1"}):(0,s.jsx)("div",{className:"text-2xl font-bold",children:L.pendingApprovals}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:L.pendingApprovals>0?"Requires attention":"All caught up!"})]})]}),(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Active Workers"}),(0,s.jsx)(a.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(d.CardContent,{children:[b?(0,s.jsx)(f.Skeleton,{className:"h-8 w-16 mb-1"}):(0,s.jsx)("div",{className:"text-2xl font-bold",children:L.activeWorkers}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:(null==C?void 0:C.team.totalWorkers)?"of ".concat(C.team.totalWorkers," total workers"):"Loading..."})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[(0,s.jsxs)(d.Card,{className:"col-span-4",children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(l.Activity,{className:"h-5 w-5"}),"Recent Activity"]})}),(0,s.jsx)(d.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:A?Array.from({length:3}).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,s.jsx)(f.Skeleton,{className:"h-4 w-4 mt-1"}),(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)(f.Skeleton,{className:"h-4 w-full"}),(0,s.jsx)(f.Skeleton,{className:"h-3 w-1/2"})]})]},t)):W.length>0?W.map(e=>{var a;return(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,s.jsxs)("div",{className:"mt-1",children:["work_entry"===e.type&&(0,s.jsx)(r.ClipboardList,{className:"h-4 w-4 text-blue-500"}),"project"===e.type&&(0,s.jsx)(t.Building2,{className:"h-4 w-4 text-green-500"}),"approval"===e.type&&(0,s.jsx)(n.TrendingUp,{className:"h-4 w-4 text-orange-500"}),!["work_entry","project","approval"].includes(e.type)&&(0,s.jsx)(l.Activity,{className:"h-4 w-4 text-gray-500"})]}),(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("p",{className:"text-sm",children:e.description}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["by ",(null==(a=e.user)?void 0:a.name)||"Unknown User"," â€¢ ",new Date(e.created_at).toLocaleString()]})]})]},e.id)}):(0,s.jsxs)("div",{className:"text-center py-6 text-muted-foreground",children:[(0,s.jsx)(l.Activity,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"No recent activity"})]})})})]}),(0,s.jsxs)(d.Card,{className:"col-span-3",children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(t.Building2,{className:"h-5 w-5"}),"Project Status"]})}),(0,s.jsx)(d.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:b?Array.from({length:4}).map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(f.Skeleton,{className:"h-4 w-20"}),(0,s.jsx)(f.Skeleton,{className:"h-6 w-12"})]},t)):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Active"}),(0,s.jsx)(o.Badge,{variant:"default",children:(null==C?void 0:C.projects.active)||0})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Planning"}),(0,s.jsx)(o.Badge,{variant:"secondary",children:(null==C?void 0:C.projects.planning)||0})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Completed"}),(0,s.jsx)(o.Badge,{variant:"outline",children:(null==C?void 0:C.projects.completed)||0})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"On Hold"}),(0,s.jsx)(o.Badge,{variant:"destructive",children:(null==C?void 0:C.projects.onHold)||0})]})]})})})]})]}),(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{children:[(0,s.jsx)(d.CardTitle,{children:"Quick Actions"}),(0,s.jsx)(d.CardDescription,{children:"Common tasks you can perform based on your role"})]}),(0,s.jsx)(d.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[w&&(0,s.jsxs)(x.Button,{variant:"outline",children:[(0,s.jsx)(r.ClipboardList,{className:"mr-2 h-4 w-4"}),"Create Work Entry"]}),(v||N)&&(0,s.jsxs)(x.Button,{variant:"outline",children:[(0,s.jsx)(t.Building2,{className:"mr-2 h-4 w-4"}),"New Project"]}),(v||N)&&(0,s.jsxs)(x.Button,{variant:"outline",children:[(0,s.jsx)(a.Users,{className:"mr-2 h-4 w-4"}),"Manage Teams"]}),(0,s.jsxs)(x.Button,{variant:"outline",children:[(0,s.jsx)(n.TrendingUp,{className:"mr-2 h-4 w-4"}),"View Reports"]})]})})]})]})}}]);