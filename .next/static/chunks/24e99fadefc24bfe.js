(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27612,e=>{"use strict";e.s(["Trash2",()=>t],27612);let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},56909,e=>{"use strict";e.s(["Save",()=>t],56909);let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},51892,22305,e=>{"use strict";e.s(["Marker",()=>s],51892);var t=e.i(24049),n=e.i(50699),a=e.i(82310),i=e.i(32322);let s=(0,n.createLayerComponent)(function(e,n){let{position:s,...l}=e,o=new i.Marker(s,l);return(0,t.createElementObject)(o,(0,a.extendContext)(n,{overlayContainer:o}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())});e.s(["Popup",()=>o],22305);var l=e.i(71645);let o=(0,n.createOverlayComponent)(function(e,n){let a=new i.Popup(e,n.overlayContainer);return(0,t.createElementObject)(a,n)},function(e,t,n,a){let{position:i}=n;(0,l.useEffect)(function(){let{instance:n}=e;function s(e){e.popup===n&&(n.update(),a(!0))}function l(e){e.popup===n&&a(!1)}return t.map.on({popupopen:s,popupclose:l}),null==t.overlayContainer?(null!=i&&n.setLatLng(i),n.openOn(t.map)):t.overlayContainer.bindPopup(n),function(){var e;t.map.off({popupopen:s,popupclose:l}),null==(e=t.overlayContainer)||e.unbindPopup(),t.map.removeLayer(n)}},[e,t,a,i])})},36730,e=>{"use strict";e.s(["useMap",()=>a,"useMapEvents",()=>i]);var t=e.i(82310),n=e.i(71645);function a(){return(0,t.useLeafletContext)().map}function i(e){let t=a();return(0,n.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}},27828,e=>{"use strict";e.s(["Polyline",()=>s]);var t=e.i(24049),n=e.i(50699),a=e.i(82310),i=e.i(32322);let s=(0,n.createPathComponent)(function(e,n){let{positions:s,...l}=e,o=new i.Polyline(s,l);return(0,t.createElementObject)(o,(0,a.extendContext)(n,{overlayContainer:o}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)})},10945,e=>{"use strict";e.s(["MeasurementTools",()=>y,"default",()=>j],10945);var t=e.i(43476),n=e.i(71645),a=e.i(27828),i=e.i(51892),s=e.i(22305),l=e.i(36730),o=e.i(32322),r=e.i(59386);let c=(0,e.i(75254).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var d=e.i(56909),u=e.i(27612),p=e.i(19455),h=e.i(87486),m=e.i(15288),x=e.i(33793);let g=(e,t,n,a)=>{let i=Math.PI/180*(n-e),s=Math.PI/180*(a-t),l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(Math.PI/180*e)*Math.cos(Math.PI/180*n)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3},f=e=>{if(e.length<3)return 0;let t=0,n=e.length;for(let a=0;a<n;a++){let i=(a+1)%n,s=e[a].lat*(Math.PI/180),l=e[a].lng*(Math.PI/180),o=e[i].lat*(Math.PI/180);t+=(e[i].lng*(Math.PI/180)-l)*(2+Math.sin(s)+Math.sin(o))}return 6378137*Math.abs(t)*6378137/2},v=(e,t)=>{if("distance"===t)if(e<1e3)return{value:e.toFixed(1),unit:"m"};else return{value:(e/1e3).toFixed(2),unit:"km"};return e<1e4?{value:e.toFixed(1),unit:"mÂ²"}:{value:(e/1e4).toFixed(2),unit:"ha"}};function y(e){let{projectId:y,onMeasurementSave:j,className:b}=e,[M,C]=(0,n.useState)(null),[k,w]=(0,n.useState)([]),[N,P]=(0,n.useState)([]),[z,I]=(0,n.useState)(!1),O=(0,n.useRef)(0),B=(0,x.useCreateGeoMeasurement)();(0,l.useMapEvents)({click:e=>{if(!M)return;let t={id:"point-".concat(O.current++),lat:e.latlng.lat,lng:e.latlng.lng};w(e=>{let n=[...e,t];return"distance"===M&&2===n.length?(S(n,"distance"),[]):n}),I(!0)},dblclick:e=>{"area"===M&&k.length>=3&&(S(k,"area"),w([]),I(!1))}});let S=(0,n.useCallback)((e,t)=>{let n=0;if("distance"===t&&e.length>=2)for(let t=0;t<e.length-1;t++)n+=g(e[t].lat,e[t].lng,e[t+1].lat,e[t+1].lng);else"area"===t&&e.length>=3&&(n=f(e));let a=v(n,t),i={id:"measurement-".concat(Date.now()),type:t,points:[...e],value:n,unit:a.unit,label:"".concat(a.value," ").concat(a.unit)};P(e=>[...e,i]),j&&j(i)},[j]),L=e=>{P(t=>t.filter(t=>t.id!==e))},T=async e=>{if(y)try{let t="distance"===e.type?{type:"LineString",coordinates:e.points.map(e=>[e.lng,e.lat])}:{type:"Polygon",coordinates:[e.points.map(e=>[e.lng,e.lat])]},n={project_id:y,measurement_type:e.type,geometry:t,value:e.value,unit:e.unit,description:e.label};await B.mutateAsync(n)}catch(e){console.error("Failed to save measurement:",e)}},A=(()=>{if(k.length<2)return null;if("distance"===M){let e=0;for(let t=0;t<k.length-1;t++)e+=g(k[t].lat,k[t].lng,k[t+1].lat,k[t+1].lng);return v(e,"distance")}return"area"===M&&k.length>=3?v(f(k),"area"):null})();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.Card,{className:"absolute top-4 left-4 z-[1000] ".concat(b),children:[(0,t.jsx)(m.CardHeader,{className:"pb-2",children:(0,t.jsxs)(m.CardTitle,{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)(r.Ruler,{className:"w-4 h-4"}),"Measurement Tools"]})}),(0,t.jsxs)(m.CardContent,{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(p.Button,{size:"sm",variant:"distance"===M?"default":"outline",onClick:()=>{C("distance"),w([]),I(!1)},children:[(0,t.jsx)(r.Ruler,{className:"w-3 h-3 mr-1"}),"Distance"]}),(0,t.jsxs)(p.Button,{size:"sm",variant:"area"===M?"default":"outline",onClick:()=>{C("area"),w([]),I(!1)},children:[(0,t.jsx)(c,{className:"w-3 h-3 mr-1"}),"Area"]})]}),M&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:"distance"===M?"Click two points to measure distance":"Click points to draw area (double-click to finish)"}),A&&(0,t.jsxs)(h.Badge,{variant:"default",className:"text-xs",children:[A.value," ",A.unit]}),(0,t.jsx)(p.Button,{size:"sm",variant:"outline",onClick:()=>{C(null),w([]),I(!1)},className:"w-full",children:"Cancel"})]}),N.length>0&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-medium",children:"Measurements"}),(0,t.jsx)(p.Button,{size:"sm",variant:"ghost",onClick:()=>{P([]),w([]),I(!1)},children:(0,t.jsx)(u.Trash2,{className:"w-3 h-3"})})]}),N.map((e,n)=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsxs)("span",{children:[n+1,". ",e.label]}),(0,t.jsxs)("div",{className:"flex gap-1",children:[y&&(0,t.jsx)(p.Button,{size:"sm",variant:"ghost",onClick:()=>T(e),disabled:B.isPending,children:(0,t.jsx)(d.Save,{className:"w-3 h-3"})}),(0,t.jsx)(p.Button,{size:"sm",variant:"ghost",onClick:()=>L(e.id),children:(0,t.jsx)(u.Trash2,{className:"w-3 h-3"})})]})]},e.id))]})]})]}),k.length>0&&(0,t.jsxs)(t.Fragment,{children:[k.map(e=>(0,t.jsx)(i.Marker,{position:[e.lat,e.lng],icon:o.default.divIcon({html:'<div style="\n                  background-color: #ef4444;\n                  width: 8px;\n                  height: 8px;\n                  border: 2px solid white;\n                  border-radius: 50%;\n                  box-shadow: 0 1px 3px rgba(0,0,0,0.3);\n                "></div>',className:"measurement-point",iconSize:[12,12],iconAnchor:[6,6]})},e.id)),k.length>1&&(0,t.jsx)(a.Polyline,{positions:k.map(e=>[e.lat,e.lng]),color:"#ef4444",weight:2,dashArray:"5, 5",opacity:.8}),"area"===M&&k.length>=3&&(0,t.jsx)(a.Polyline,{positions:[k[k.length-1],k[0]].map(e=>[e.lat,e.lng]),color:"#ef4444",weight:2,dashArray:"5, 5",opacity:.5})]}),N.map(e=>(0,t.jsxs)(n.default.Fragment,{children:[e.points.map(e=>(0,t.jsx)(i.Marker,{position:[e.lat,e.lng],icon:o.default.divIcon({html:'<div style="\n                  background-color: #3b82f6;\n                  width: 6px;\n                  height: 6px;\n                  border: 2px solid white;\n                  border-radius: 50%;\n                  box-shadow: 0 1px 3px rgba(0,0,0,0.3);\n                "></div>',className:"measurement-point-completed",iconSize:[10,10],iconAnchor:[5,5]})},e.id)),(0,t.jsx)(a.Polyline,{positions:e.points.map(e=>[e.lat,e.lng]),color:"#3b82f6",weight:2,opacity:.8,children:(0,t.jsx)(s.Popup,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"font-semibold text-sm",children:["distance"===e.type?"Distance":"Area"," Measurement"]}),(0,t.jsx)("div",{className:"text-sm",children:e.label}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(p.Button,{size:"sm",variant:"outline",onClick:()=>L(e.id),children:"Delete"}),y&&(0,t.jsx)(p.Button,{size:"sm",onClick:()=>T(e),disabled:B.isPending,children:"Save"})]})]})})}),"area"===e.type&&e.points.length>=3&&(0,t.jsx)(a.Polyline,{positions:[e.points[e.points.length-1],e.points[0]].map(e=>[e.lat,e.lng]),color:"#3b82f6",weight:2,opacity:.8})]},e.id))]})}let j=y},2691,e=>{e.n(e.i(10945))}]);