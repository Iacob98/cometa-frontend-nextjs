(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,35203,e=>{"use strict";e.s(["default",()=>G],35203);var s=e.i(43476),l=e.i(71645),a=e.i(18566),t=e.i(7233),r=e.i(55436),d=e.i(88844),i=e.i(78894),n=e.i(15788),c=e.i(91741),o=e.i(12426),x=e.i(7486),m=e.i(86536),h=e.i(88511),u=e.i(27612),j=e.i(41071);let p=(0,e.i(75254).default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);var v=e.i(69638),g=e.i(3116),C=e.i(73884),f=e.i(87130),N=e.i(25652),b=e.i(46897),w=e.i(19455),y=e.i(93479),T=e.i(15288),k=e.i(87486),_=e.i(84774),M=e.i(55146),S=e.i(67489),D=e.i(77572),H=e.i(9694),A=e.i(75225),q=e.i(85183),I=e.i(93230),O=e.i(72526),P=e.i(34239),L=e.i(31195),B=e.i(41891),V=e.i(38814),R=e.i(22787),F=e.i(29228),U=e.i(55706),E=e.i(4382),K=e.i(86241),z=e.i(64483),Y=e.i(71436);function G(){let e=(0,a.useRouter)(),{canManageInventory:H}=(0,Y.usePermissions)(),A=(0,E.useDeleteMaterial)();(0,E.useAdjustStock)();let[q,I]=(0,l.useState)(""),[O,P]=(0,l.useState)("all"),[L,B]=(0,l.useState)("all"),{data:V,isLoading:R,error:F}=(0,E.useMaterials)({search:q||void 0,category:"all"===O?void 0:O,low_stock:"low"===L||void 0,page:1,per_page:20}),{data:U}=(0,E.useLowStockMaterials)(),{data:G}=(0,E.useSuppliers)(),{data:Z}=(0,K.useAllocations)(),{data:$}=(0,z.useMaterialOrders)({page:1,per_page:10}),ee=(null==V?void 0:V.items)||[],es=(null==$?void 0:$.items)||[],el=async(e,s)=>{confirm('Are you sure you want to delete "'.concat(s,'"? This action cannot be undone.'))&&await A.mutateAsync(e)},ea=e=>new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e),et=e=>({piece:"pcs",meter:"m",kg:"kg",ton:"t",liter:"L",m3:"m³",box:"box",pallet:"plt",roll:"roll"})[e]||e;return F?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Materials"})}),(0,s.jsx)(T.Card,{children:(0,s.jsx)(T.CardContent,{className:"py-8",children:(0,s.jsx)("div",{className:"text-center text-muted-foreground",children:"Failed to load materials. Please try again later."})})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Materials & Inventory"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Manage materials, track inventory, and monitor stock levels"})]}),H&&(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(w.Button,{variant:"outline",onClick:()=>e.push("/dashboard/materials/suppliers"),children:[(0,s.jsx)(x.Building2,{className:"mr-2 h-4 w-4"}),"Suppliers"]}),(0,s.jsxs)(w.Button,{variant:"outline",onClick:()=>e.push("/dashboard/materials/new"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Add Material"]}),(0,s.jsxs)(w.Button,{onClick:()=>e.push("/dashboard/materials/order"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Order Materials"]})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Total Materials"}),(0,s.jsx)(d.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:(null==V?void 0:V.total)||0}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"In inventory system"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Low Stock Items"}),(0,s.jsx)(i.AlertTriangle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-destructive",children:(null==U?void 0:U.length)||0}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Need reordering"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Active Orders"}),(0,s.jsx)(n.Truck,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:es.filter(e=>["pending","ordered"].includes(e.status)).length}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pending delivery"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Inventory Value"}),(0,s.jsx)(o.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:ea(ee.reduce((e,s)=>e+s.current_stock_qty*s.unit_cost,0))}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total stock value"})]})]})]}),(0,s.jsxs)(D.Tabs,{defaultValue:"inventory",className:"space-y-4",children:[(0,s.jsxs)(D.TabsList,{children:[(0,s.jsxs)(D.TabsTrigger,{value:"inventory",children:["Inventory (",ee.length,")"]}),(0,s.jsxs)(D.TabsTrigger,{value:"low-stock",children:["Low Stock (",(null==U?void 0:U.length)||0,")"]}),(0,s.jsxs)(D.TabsTrigger,{value:"allocations",children:["Allocations (",(null==Z?void 0:Z.length)||0,")"]}),(0,s.jsxs)(D.TabsTrigger,{value:"orders",children:["Orders (",es.length,")"]})]}),(0,s.jsxs)(D.TabsContent,{value:"inventory",className:"space-y-6",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{children:[(0,s.jsx)(T.CardTitle,{children:"Filter Materials"}),(0,s.jsx)(T.CardDescription,{children:"Search and filter materials by various criteria"})]}),(0,s.jsx)(T.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-col space-y-4 md:flex-row md:space-y-0 md:space-x-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(r.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(y.Input,{placeholder:"Search materials by name or description...",value:q,onChange:e=>I(e.target.value),className:"pl-8"})]})}),(0,s.jsxs)(S.Select,{value:O,onValueChange:P,children:[(0,s.jsx)(S.SelectTrigger,{className:"w-48",children:(0,s.jsx)(S.SelectValue,{placeholder:"Filter by category"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"all",children:"All Categories"}),(0,s.jsx)(S.SelectItem,{value:"cables",children:"Cables"}),(0,s.jsx)(S.SelectItem,{value:"conduits",children:"Conduits"}),(0,s.jsx)(S.SelectItem,{value:"tools",children:"Tools"}),(0,s.jsx)(S.SelectItem,{value:"equipment",children:"Equipment"}),(0,s.jsx)(S.SelectItem,{value:"consumables",children:"Consumables"})]})]}),(0,s.jsxs)(S.Select,{value:L,onValueChange:e=>B(e),children:[(0,s.jsx)(S.SelectTrigger,{className:"w-48",children:(0,s.jsx)(S.SelectValue,{placeholder:"Filter by stock"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"all",children:"All Stock Levels"}),(0,s.jsx)(S.SelectItem,{value:"low",children:"Low Stock"}),(0,s.jsx)(S.SelectItem,{value:"normal",children:"Normal Stock"})]})]})]})})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsx)(T.CardHeader,{children:(0,s.jsxs)(T.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Package,{className:"h-5 w-5"}),"Materials Inventory"]})}),(0,s.jsx)(T.CardContent,{children:R?(0,s.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,l)=>(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded flex-1"}),(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded w-20"}),(0,s.jsx)("div",{className:"h-4 bg-muted animate-pulse rounded w-16"})]},l))}):0===ee.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(d.Package,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"No materials found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:q||"all"!==O||"all"!==L?"No materials match your current filters.":"Get started by adding your first material."}),H&&(0,s.jsxs)(w.Button,{className:"mt-4",onClick:()=>e.push("/dashboard/materials/new"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Add Material"]})]}):(0,s.jsxs)(_.Table,{children:[(0,s.jsx)(_.TableHeader,{children:(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableHead,{children:"Material"}),(0,s.jsx)(_.TableHead,{children:"Category"}),(0,s.jsx)(_.TableHead,{children:"Stock Level"}),(0,s.jsx)(_.TableHead,{children:"Unit Cost"}),(0,s.jsx)(_.TableHead,{children:"Total Value"}),(0,s.jsx)(_.TableHead,{children:"Supplier"}),(0,s.jsx)(_.TableHead,{children:"Status"}),(0,s.jsx)(_.TableHead,{className:"w-[70px]",children:"Actions"})]})}),(0,s.jsx)(_.TableBody,{children:ee.map(l=>{var a;return(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:l.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:l.description})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"outline",children:l.category})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:[l.current_stock_qty," ",et(l.unit)]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Min: ",l.min_stock_level," ",et(l.unit)]})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"font-mono",children:ea(l.unit_cost)})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"font-mono font-medium",children:ea(l.current_stock_qty*l.unit_cost)})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"text-sm",children:(null==(a=l.supplier)?void 0:a.name)||"—"})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)(k.Badge,{variant:l.current_stock_qty<=l.min_stock_level?"destructive":l.current_stock_qty<=1.2*l.min_stock_level?"outline":"secondary",children:l.current_stock_qty<=l.min_stock_level?"Low Stock":l.current_stock_qty<=1.2*l.min_stock_level?"Warning":"Normal"})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)(M.DropdownMenu,{children:[(0,s.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(w.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,s.jsx)(j.MoreHorizontal,{className:"h-4 w-4"})]})}),(0,s.jsxs)(M.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(M.DropdownMenuLabel,{children:"Actions"}),(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/".concat(l.id)),children:[(0,s.jsx)(m.Eye,{className:"mr-2 h-4 w-4"}),"View Details"]}),H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/".concat(l.id)),children:[(0,s.jsx)(h.Edit,{className:"mr-2 h-4 w-4"}),"Edit Material"]}),(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/".concat(l.id,"/adjust")),children:[(0,s.jsx)(p,{className:"mr-2 h-4 w-4"}),"Adjust Stock"]}),(0,s.jsx)(M.DropdownMenuSeparator,{}),(0,s.jsxs)(M.DropdownMenuItem,{className:"text-destructive",onClick:()=>el(l.id,l.name),children:[(0,s.jsx)(u.Trash2,{className:"mr-2 h-4 w-4"}),"Delete Material"]})]})]})]})})]},l.id)})})]})})]})]}),(0,s.jsx)(D.TabsContent,{value:"low-stock",className:"space-y-6",children:(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{children:[(0,s.jsxs)(T.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(i.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Low Stock Alert"]}),(0,s.jsx)(T.CardDescription,{children:"Materials that need immediate attention"})]}),(0,s.jsx)(T.CardContent,{children:(null==U?void 0:U.length)===0?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(d.Package,{className:"mx-auto h-12 w-12 text-green-500"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"All stock levels are healthy"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"No materials are currently below minimum stock levels."})]}):(0,s.jsx)("div",{className:"space-y-4",children:null==U?void 0:U.map(l=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border border-destructive/20 rounded-lg bg-destructive/5",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"font-medium",children:l.name}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current: ",l.current_stock_qty," ",et(l.unit)," / Min: ",l.min_stock_level," ",et(l.unit)]})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)(w.Button,{variant:"outline",size:"sm",onClick:()=>e.push("/dashboard/materials/order?material=".concat(l.id)),children:[(0,s.jsx)(n.Truck,{className:"mr-2 h-4 w-4"}),"Order"]}),(0,s.jsxs)(w.Button,{variant:"outline",size:"sm",onClick:()=>e.push("/dashboard/materials/".concat(l.id)),children:[(0,s.jsx)(m.Eye,{className:"mr-2 h-4 w-4"}),"View"]})]})]},l.id))})})]})}),(0,s.jsxs)(D.TabsContent,{value:"allocations",className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Total Allocations"}),(0,s.jsx)(c.ClipboardList,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:(null==Z?void 0:Z.length)||0}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active material assignments"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Projects with Materials"}),(0,s.jsx)(b.MapPin,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:new Set(null==Z?void 0:Z.map(e=>e.project_id).filter(Boolean)).size||0}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unique projects"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Total Allocated Value"}),(0,s.jsx)(o.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:ea((null==Z?void 0:Z.reduce((e,s)=>{var l;return e+s.allocated_qty*((null==(l=s.material)?void 0:l.default_price_eur)||0)},0))||0)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total allocation value"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Utilization Rate"}),(0,s.jsx)(N.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[(null==Z?void 0:Z.length)>0?Math.round(Z.reduce((e,s)=>e+(s.used_qty||0),0)/Z.reduce((e,s)=>e+s.allocated_qty,0)*100):0,"%"]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Materials actually used"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsx)(T.CardHeader,{children:(0,s.jsx)(T.CardTitle,{children:"Allocation by Material Type"})}),(0,s.jsx)(T.CardContent,{children:(0,s.jsx)(W,{})})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsx)(T.CardHeader,{children:(0,s.jsx)(T.CardTitle,{children:"Project Allocation Distribution"})}),(0,s.jsx)(T.CardContent,{children:(0,s.jsx)(X,{})})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{children:[(0,s.jsxs)(T.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(c.ClipboardList,{className:"h-5 w-5"}),"Material Allocations"]}),(0,s.jsx)(T.CardDescription,{children:"Track material assignments to projects and teams"})]}),(0,s.jsx)(T.CardContent,{children:(null==Z?void 0:Z.length)?(0,s.jsxs)(_.Table,{children:[(0,s.jsx)(_.TableHeader,{children:(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableHead,{children:"Material"}),(0,s.jsx)(_.TableHead,{children:"Project"}),(0,s.jsx)(_.TableHead,{children:"Allocated"}),(0,s.jsx)(_.TableHead,{children:"Used"}),(0,s.jsx)(_.TableHead,{children:"Remaining"}),(0,s.jsx)(_.TableHead,{children:"Value"}),(0,s.jsx)(_.TableHead,{children:"Status"}),(0,s.jsx)(_.TableHead,{className:"w-[70px]",children:"Actions"})]})}),(0,s.jsx)(_.TableBody,{children:null==Z?void 0:Z.map(l=>{var a,t,r,d,i,n;let c=l.allocated_qty-(l.used_qty||0),o=(l.used_qty||0)/l.allocated_qty*100;return(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:null==(a=l.material)?void 0:a.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:null==(t=l.material)?void 0:t.category})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:l.project_name||"Unknown Project"}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:l.crew_name||"No Crew"})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{className:"font-medium",children:[l.allocated_qty," ",et((null==(r=l.material)?void 0:r.unit)||"piece")]})}),(0,s.jsxs)(_.TableCell,{children:[(0,s.jsxs)("div",{className:"font-medium",children:[l.used_qty||0," ",et((null==(d=l.material)?void 0:d.unit)||"piece")]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[Math.round(o),"% used"]})]}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{className:"font-medium",children:[c," ",et((null==(i=l.material)?void 0:i.unit)||"piece")]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"font-mono",children:ea(l.allocated_qty*((null==(n=l.material)?void 0:n.default_price_eur)||0))})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)(k.Badge,{variant:o>90?"default":o>50?"secondary":"outline",children:o>90?"High Usage":o>50?"In Use":"Available"})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)(M.DropdownMenu,{children:[(0,s.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(w.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,s.jsx)(j.MoreHorizontal,{className:"h-4 w-4"})]})}),(0,s.jsxs)(M.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(M.DropdownMenuLabel,{children:"Actions"}),(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/allocations/".concat(l.id)),children:[(0,s.jsx)(m.Eye,{className:"mr-2 h-4 w-4"}),"View Details"]}),H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/allocations/".concat(l.id,"/edit")),children:[(0,s.jsx)(h.Edit,{className:"mr-2 h-4 w-4"}),"Edit Allocation"]}),(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/allocations/".concat(l.id,"/usage")),children:[(0,s.jsx)(p,{className:"mr-2 h-4 w-4"}),"Update Usage"]})]})]})]})})]},l.id)})})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(c.ClipboardList,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"No allocations found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Start allocating materials to projects to track usage."}),H&&(0,s.jsxs)(w.Button,{className:"mt-4",onClick:()=>e.push("/dashboard/materials/allocate"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"New Allocation"]})]})})]})]}),(0,s.jsxs)(D.TabsContent,{value:"orders",className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Total Orders"}),(0,s.jsx)(n.Truck,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:es.length}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"All purchase orders"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Pending Orders"}),(0,s.jsx)(g.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:es.filter(e=>["pending","ordered"].includes(e.status)).length}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting delivery"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Delivered Orders"}),(0,s.jsx)(v.CheckCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:es.filter(e=>"delivered"===e.status).length}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Successfully received"})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(T.CardTitle,{className:"text-sm font-medium",children:"Total Order Value"}),(0,s.jsx)(o.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:ea(es.reduce((e,s)=>e+s.quantity*(s.unit_price||0),0))}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total purchasing value"})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,s.jsxs)(T.Card,{children:[(0,s.jsx)(T.CardHeader,{children:(0,s.jsx)(T.CardTitle,{children:"Order Status Distribution"})}),(0,s.jsx)(T.CardContent,{children:(0,s.jsx)(Q,{})})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsx)(T.CardHeader,{children:(0,s.jsx)(T.CardTitle,{children:"Monthly Order Trends"})}),(0,s.jsx)(T.CardContent,{children:(0,s.jsx)(J,{})})]})]}),(0,s.jsxs)(T.Card,{children:[(0,s.jsxs)(T.CardHeader,{children:[(0,s.jsxs)(T.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Truck,{className:"h-5 w-5"}),"Material Orders"]}),(0,s.jsx)(T.CardDescription,{children:"Manage purchase orders and deliveries from suppliers"})]}),(0,s.jsxs)(T.CardContent,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(y.Input,{placeholder:"Search orders...",className:"w-64"}),(0,s.jsxs)(w.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(f.Filter,{className:"mr-2 h-4 w-4"}),"Filter"]})]}),H&&(0,s.jsxs)(w.Button,{onClick:()=>e.push("/dashboard/materials/order/new"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"New Order"]})]}),0===es.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(n.Truck,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"No orders found"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Start by creating your first material order."}),H&&(0,s.jsxs)(w.Button,{className:"mt-4",onClick:()=>e.push("/dashboard/materials/order/new"),children:[(0,s.jsx)(t.Plus,{className:"mr-2 h-4 w-4"}),"Create Order"]})]}):(0,s.jsxs)(_.Table,{children:[(0,s.jsx)(_.TableHeader,{children:(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableHead,{children:"Order ID"}),(0,s.jsx)(_.TableHead,{children:"Material"}),(0,s.jsx)(_.TableHead,{children:"Supplier"}),(0,s.jsx)(_.TableHead,{children:"Quantity"}),(0,s.jsx)(_.TableHead,{children:"Unit Price"}),(0,s.jsx)(_.TableHead,{children:"Total"}),(0,s.jsx)(_.TableHead,{children:"Expected Delivery"}),(0,s.jsx)(_.TableHead,{children:"Status"}),(0,s.jsx)(_.TableHead,{className:"w-[70px]",children:"Actions"})]})}),(0,s.jsx)(_.TableBody,{children:es.map(l=>{var a,t,r,d,i;let c=l.quantity*(l.unit_price||0),o=l.expected_delivery_date&&new Date(l.expected_delivery_date)<new Date&&"delivered"!==l.status;return(0,s.jsxs)(_.TableRow,{children:[(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{className:"font-mono text-sm",children:["#",l.id.slice(0,8)]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:null==(a=l.material)?void 0:a.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:null==(t=l.material)?void 0:t.category})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:null==(r=l.supplier)?void 0:r.name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:null==(d=l.supplier)?void 0:d.contact_person})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{className:"font-medium",children:[l.quantity," ",et((null==(i=l.material)?void 0:i.unit)||"piece")]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"font-mono",children:ea(l.unit_price||0)})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)("div",{className:"font-mono font-medium",children:ea(c)})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)("div",{className:"text-sm ".concat(o?"text-destructive font-medium":""),children:[l.expected_delivery_date?new Date(l.expected_delivery_date).toLocaleDateString():"—",o&&(0,s.jsx)("div",{className:"text-xs text-destructive",children:"Overdue"})]})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsx)(k.Badge,{variant:"delivered"===l.status?"default":"ordered"===l.status?"secondary":"pending"===l.status?"outline":"destructive",children:"delivered"===l.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.CheckCircle,{className:"mr-1 h-3 w-3"}),"Delivered"]}):"ordered"===l.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Clock,{className:"mr-1 h-3 w-3"}),"Ordered"]}):"pending"===l.status?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Clock,{className:"mr-1 h-3 w-3"}),"Pending"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.XCircle,{className:"mr-1 h-3 w-3"}),"Cancelled"]})})}),(0,s.jsx)(_.TableCell,{children:(0,s.jsxs)(M.DropdownMenu,{children:[(0,s.jsx)(M.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsxs)(w.Button,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Open menu"}),(0,s.jsx)(j.MoreHorizontal,{className:"h-4 w-4"})]})}),(0,s.jsxs)(M.DropdownMenuContent,{align:"end",children:[(0,s.jsx)(M.DropdownMenuLabel,{children:"Actions"}),(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/orders/".concat(l.id)),children:[(0,s.jsx)(m.Eye,{className:"mr-2 h-4 w-4"}),"View Details"]}),H&&"delivered"!==l.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(M.DropdownMenuItem,{onClick:()=>e.push("/dashboard/materials/orders/".concat(l.id,"/edit")),children:[(0,s.jsx)(h.Edit,{className:"mr-2 h-4 w-4"}),"Edit Order"]}),"pending"===l.status&&(0,s.jsxs)(M.DropdownMenuItem,{children:[(0,s.jsx)(v.CheckCircle,{className:"mr-2 h-4 w-4"}),"Mark as Ordered"]}),("pending"===l.status||"ordered"===l.status)&&(0,s.jsxs)(M.DropdownMenuItem,{children:[(0,s.jsx)(n.Truck,{className:"mr-2 h-4 w-4"}),"Mark as Delivered"]})]})]})]})})]},l.id)})})]})]})]})]})]})]})}let W=()=>{let{data:e}=(0,K.useAllocations)(),l=(null==e?void 0:e.reduce((e,s)=>{var l,a,t;let r=(null==(l=s.material)?void 0:l.category)||"Other",d=e.find(e=>e.category===r);return d?(d.value+=s.allocated_qty*((null==(a=s.material)?void 0:a.default_price_eur)||0),d.count+=1):e.push({category:r,value:s.allocated_qty*((null==(t=s.material)?void 0:t.default_price_eur)||0),count:1}),e},[]))||[];return(0,s.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,s.jsxs)(H.BarChart,{data:l,children:[(0,s.jsx)(O.CartesianGrid,{strokeDasharray:"3 3"}),(0,s.jsx)(q.XAxis,{dataKey:"category"}),(0,s.jsx)(I.YAxis,{}),(0,s.jsx)(P.Tooltip,{formatter:e=>["€".concat(e.toLocaleString()),"Allocated Value"]}),(0,s.jsx)(A.Bar,{dataKey:"value",fill:"#3b82f6",name:"Allocated Value"})]})})},X=()=>{let{data:e}=(0,K.useAllocations)(),l=(null==e?void 0:e.reduce((e,s)=>{var l,a;let t=s.project_name||"Unassigned",r=e.find(e=>e.project===t);return r?r.value+=s.allocated_qty*((null==(l=s.material)?void 0:l.default_price_eur)||0):e.push({project:t.length>20?t.substring(0,20)+"...":t,value:s.allocated_qty*((null==(a=s.material)?void 0:a.default_price_eur)||0)}),e},[]))||[],a=["#3b82f6","#ef4444","#22c55e","#f59e0b","#8b5cf6","#06b6d4"];return(0,s.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,s.jsxs)(B.PieChart,{children:[(0,s.jsx)(V.Pie,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{project:s,percent:l}=e;return"".concat(s," ").concat((100*l).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"value",children:l.map((e,l)=>(0,s.jsx)(R.Cell,{fill:a[l%a.length]},"cell-".concat(l)))}),(0,s.jsx)(P.Tooltip,{formatter:e=>["€".concat(e.toLocaleString()),"Allocated Value"]})]})})},Q=()=>{let{data:e}=(0,z.useMaterialOrders)({page:1,per_page:100}),l=((null==e?void 0:e.items)||[]).reduce((e,s)=>{let l=s.status||"pending",a=e.find(e=>e.status===l);return a?(a.count+=1,a.value+=s.quantity*(s.unit_price||0)):e.push({status:l.charAt(0).toUpperCase()+l.slice(1),count:1,value:s.quantity*(s.unit_price||0)}),e},[]),a={Pending:"#f59e0b",Ordered:"#3b82f6",Delivered:"#22c55e",Cancelled:"#ef4444"};return(0,s.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,s.jsxs)(B.PieChart,{children:[(0,s.jsx)(V.Pie,{data:l,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{status:s,count:l}=e;return"".concat(s," (").concat(l,")")},outerRadius:80,fill:"#8884d8",dataKey:"count",children:l.map((e,l)=>(0,s.jsx)(R.Cell,{fill:a[e.status]||"#8b5cf6"},"cell-".concat(l)))}),(0,s.jsx)(P.Tooltip,{formatter:(e,s)=>[e,"Orders"]})]})})},J=()=>{let{data:e}=(0,z.useMaterialOrders)({page:1,per_page:100}),l=(null==e?void 0:e.items)||[],a=Array.from({length:6},(e,s)=>{let l=new Date;return l.setMonth(l.getMonth()-s),{month:l.toLocaleDateString("en-US",{month:"short",year:"2-digit"}),monthKey:"".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0")),orders:0,value:0}}).reverse();return l.forEach(e=>{if(e.created_at){let s=new Date(e.created_at),l="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0")),t=a.find(e=>e.monthKey===l);t&&(t.orders+=1,t.value+=e.quantity*(e.unit_price||0))}}),(0,s.jsx)(L.ResponsiveContainer,{width:"100%",height:300,children:(0,s.jsxs)(F.LineChart,{data:a,children:[(0,s.jsx)(O.CartesianGrid,{strokeDasharray:"3 3"}),(0,s.jsx)(q.XAxis,{dataKey:"month"}),(0,s.jsx)(I.YAxis,{}),(0,s.jsx)(P.Tooltip,{formatter:(e,s)=>["orders"===s?e:"€".concat(e.toLocaleString()),"orders"===s?"Orders":"Value"]}),(0,s.jsx)(U.Line,{type:"monotone",dataKey:"orders",stroke:"#3b82f6",strokeWidth:2,name:"orders"}),(0,s.jsx)(U.Line,{type:"monotone",dataKey:"value",stroke:"#22c55e",strokeWidth:2,name:"value"})]})})}}]);