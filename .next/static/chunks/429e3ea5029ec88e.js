(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.s(["_",()=>t])},41931,e=>{"use strict";e.s(["appointmentsApi",()=>m,"authApi",()=>i,"clearAuthTokenForAllClients",()=>j,"geoAnalysisApi",()=>C,"geoAnnotationsApi",()=>q,"geoLayersApi",()=>Q,"geoMeasurementsApi",()=>x,"geoRoutesApi",()=>P,"geospatialApi",()=>O,"housesApi",()=>g,"mapTilesApi",()=>E,"materialAllocationsApi",()=>p,"materialOrdersApi",()=>y,"materialsApi",()=>h,"notificationPreferencesApi",()=>_,"notificationTemplatesApi",()=>w,"notificationsApi",()=>f,"projectsApi",()=>o,"setAuthTokenForAllClients",()=>D,"suppliersApi",()=>d,"teamsApi",()=>l,"usersApi",()=>u,"wsApi",()=>A]);var t=e.i(47167),n=e.i(99749);let s=t.default.env.NEXT_PUBLIC_API_URL||"http://localhost:3000";class r extends Error{constructor(e,t,s){super(t),(0,n._)(this,"status",void 0),(0,n._)(this,"response",void 0),this.status=e,this.response=s,this.name="ApiError"}}class a{setAuthToken(e){this.authToken=e}clearAuthToken(){this.authToken=void 0}getHeaders(){let e={"Content-Type":"application/json"};return this.authToken&&(e.Authorization="Bearer ".concat(this.authToken)),e}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(this.baseURL).concat(e),s={...t,headers:{...this.getHeaders(),...t.headers}};try{let e=await fetch(n,s),t=e.headers.get("content-type");if(!(null==t?void 0:t.includes("application/json"))){if(!e.ok)throw new r(e.status,"HTTP ".concat(e.status,": ").concat(e.statusText));return e.text()}let a=await e.json();if(!e.ok)throw new r(e.status,a.message||a.detail||"HTTP ".concat(e.status),a);return a}catch(e){if(e instanceof r)throw e;throw new r(0,e instanceof Error?e.message:"Network error")}}async get(e,t){let n=new URL("".concat(this.baseURL).concat(e));return t&&Object.entries(t).forEach(e=>{let[t,s]=e;null!=s&&n.searchParams.append(t,String(s))}),this.request(n.toString().replace(this.baseURL,""))}async post(e,t){return this.request(e,{method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){return this.request(e,{method:"PUT",body:t?JSON.stringify(t):void 0})}async patch(e,t){return this.request(e,{method:"PATCH",body:t?JSON.stringify(t):void 0})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e){(0,n._)(this,"baseURL",void 0),(0,n._)(this,"authToken",void 0),this.baseURL=e}}let i=new class extends a{async login(e){return this.post("/login",e)}async refreshToken(e){return this.post("/refresh",{refresh_token:e})}async logout(){return this.post("/logout")}async me(){return this.get("/me")}constructor(){super("".concat(s,"/api/auth"))}},o=new class extends a{async getProjects(e){return this.get("/",e)}async getProject(e){return this.get("/".concat(e))}async createProject(e){return this.post("/",e)}async updateProject(e,t){return this.patch("/".concat(e),t)}async deleteProject(e){return this.delete("/".concat(e))}constructor(){super("".concat(s,"/api/projects"))}},c=new class extends a{async getWorkEntries(e){return this.get("/",e)}async getWorkEntry(e){return this.get("/".concat(e))}async createWorkEntry(e){return this.post("/",e)}async updateWorkEntry(e,t){return this.patch("/".concat(e),t)}async deleteWorkEntry(e){return this.delete("/".concat(e))}async approveWorkEntry(e){return this.post("/".concat(e,"/approve"))}constructor(){super("".concat(s,"/api/work-entries"))}},u=new class extends a{async getUsers(e){return this.get("/",e)}async getUser(e){return this.get("/".concat(e))}async createUser(e){return this.post("/",e)}async updateUser(e,t){return this.patch("/".concat(e),t)}async deleteUser(e){return this.delete("/".concat(e))}constructor(){super("".concat(s,"/api/users"))}},l=new class extends a{async getCrews(){return this.get("/crews")}async getCrew(e){return this.get("/crews/".concat(e))}async createCrew(e){return this.post("/crews",e)}async updateCrew(e,t){return this.patch("/crews/".concat(e),t)}async deleteCrew(e){return this.delete("/crews/".concat(e))}constructor(){super("".concat(s,"/api/teams"))}},h=new class extends a{async getMaterials(e){return this.get("/",e)}async getMaterial(e){return this.get("/".concat(e))}async createMaterial(e){return this.post("/",e)}async updateMaterial(e,t){return this.patch("/".concat(e),t)}async deleteMaterial(e){return this.delete("/".concat(e))}async getLowStockMaterials(){return this.get("/low-stock")}async adjustStock(e,t){return this.post("/".concat(e,"/adjust-stock"),t)}constructor(){super("".concat(s,"/api/materials"))}},d=new class extends a{async getSuppliers(){return this.get("/")}async getSupplier(e){return this.get("/".concat(e))}async createSupplier(e){return this.post("/",e)}async updateSupplier(e,t){return this.patch("/".concat(e),t)}async deleteSupplier(e){return this.delete("/".concat(e))}constructor(){super("".concat(s,"/api/suppliers"))}},p=new class extends a{async getAllocations(e){return this.get("/",e)}async getAllocation(e){return this.get("/".concat(e))}async createAllocation(e){return this.post("/",e)}async updateAllocation(e,t){return this.patch("/".concat(e),t)}async deleteAllocation(e){return this.delete("/".concat(e))}async recordUsage(e,t){return this.post("/".concat(e,"/usage"),t)}constructor(){super("".concat(s,"/api/material-allocations"))}},y=new class extends a{async getOrders(e){return this.get("/",e)}async getOrder(e){return this.get("/".concat(e))}async createOrder(e){return this.post("/",e)}async updateOrder(e,t){return this.patch("/".concat(e),t)}async deleteOrder(e){return this.delete("/".concat(e))}async updateOrderStatus(e,t){return this.patch("/".concat(e,"/status"),{status:t})}async addOrderItem(e,t){return this.post("/".concat(e,"/items"),t)}async removeOrderItem(e,t){return this.delete("/".concat(e,"/items/").concat(t))}constructor(){super("".concat(s,"/api/material-orders"))}},g=new class extends a{async getHouses(e){return this.get("/",e)}async getHouse(e){return this.get("/".concat(e))}async createHouse(e){return this.post("/",e)}async updateHouse(e,t){return this.patch("/".concat(e),t)}async deleteHouse(e){return this.delete("/".concat(e))}async scheduleAppointment(e){return this.post("/appointments",e)}async startConnection(e){let t=new FormData;return t.append("house_id",e.house_id),t.append("worker_id",e.worker_id),t.append("before_photo",e.before_photo),t.append("gps_location",JSON.stringify(e.gps_location)),e.notes&&t.append("notes",e.notes),this.request("/start-connection",{method:"POST",body:t,headers:{...this.getHeaders()}})}async completeConnection(e){let t=new FormData;return t.append("house_id",e.house_id),t.append("connection_type",e.connection_type),e.after_photos.forEach((e,n)=>{t.append("after_photos",e)}),t.append("measurements",JSON.stringify(e.measurements)),t.append("quality_checks",JSON.stringify(e.quality_checks)),e.customer_signature&&t.append("customer_signature",e.customer_signature),e.notes&&t.append("notes",e.notes),this.request("/complete-connection",{method:"POST",body:t,headers:{...this.getHeaders()}})}async getProjectHouses(e){let t=await fetch("/api/housing-units?project_id=".concat(e));if(!t.ok)throw Error("Failed to fetch project houses");return(await t.json()).items||[]}async getTeamHouses(e){return this.get("/team/".concat(e))}constructor(){super("".concat(s,"/api/houses"))}},m=new class extends a{async getAppointments(e){return this.get("/",e)}async getAppointment(e){return this.get("/".concat(e))}async updateAppointment(e,t){return this.patch("/".concat(e),t)}async cancelAppointment(e,t){return this.patch("/".concat(e,"/cancel"),{reason:t})}async rescheduleAppointment(e,t){return this.patch("/".concat(e,"/reschedule"),{scheduled_date:t})}async confirmAppointment(e){return this.patch("/".concat(e,"/confirm"))}async startAppointment(e){return this.patch("/".concat(e,"/start"))}async completeAppointment(e,t){return this.patch("/".concat(e,"/complete"),{notes:t})}constructor(){super("".concat(s,"/api/appointments"))}},f=new class extends a{async getNotifications(e){return this.get("/",e)}async getNotification(e){return this.get("/".concat(e))}async createNotification(e){return this.post("/",e)}async markAsRead(e){return this.patch("/".concat(e,"/read"))}async markAllAsRead(e){return this.patch("/user/".concat(e,"/read-all"))}async deleteNotification(e){return this.delete("/".concat(e))}async getUnreadCount(e){return this.get("/user/".concat(e,"/unread-count"))}constructor(){super("".concat(s,"/api/notifications"))}},_=new class extends a{async getPreferences(e){return this.get("/user/".concat(e))}async updatePreferences(e,t){return this.patch("/user/".concat(e),t)}constructor(){super("".concat(s,"/api/notification-preferences"))}},w=new class extends a{async getTemplates(){return this.get("/")}async getTemplate(e){return this.get("/".concat(e))}async updateTemplate(e,t){return this.patch("/".concat(e),t)}constructor(){super("".concat(s,"/api/notification-templates"))}},A=new class{connect(e){return new Promise((n,s)=>{let r="".concat(t.default.env.NEXT_PUBLIC_WS_URL||"ws://localhost:8080","/ws/").concat(e);this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.authToken&&this.send("auth",{token:this.authToken}),n()},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t)}catch(e){console.error("Failed to parse WebSocket message:",e)}},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.reconnect(e)},this.ws.onerror=e=>{console.error("WebSocket error:",e),s(e)}})}reconnect(e){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log("Attempting to reconnect... (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.connect(e).catch(console.error)},this.reconnectInterval))}handleMessage(e){(this.messageHandlers.get(e.type)||[]).forEach(t=>t(e.data))}send(e,t){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let n={type:e,data:t,timestamp:new Date().toISOString()};this.ws.send(JSON.stringify(n))}}subscribe(e,t){this.messageHandlers.has(e)||this.messageHandlers.set(e,[]),this.messageHandlers.get(e).push(t)}unsubscribe(e,t){let n=this.messageHandlers.get(e);if(n){let e=n.indexOf(t);e>-1&&n.splice(e,1)}}disconnect(){this.ws&&(this.ws.close(),this.ws=void 0),this.messageHandlers.clear()}setAuthToken(e){this.authToken=e}constructor(e){(0,n._)(this,"authToken",void 0),(0,n._)(this,"ws",void 0),(0,n._)(this,"reconnectAttempts",void 0),(0,n._)(this,"maxReconnectAttempts",void 0),(0,n._)(this,"reconnectInterval",void 0),(0,n._)(this,"messageHandlers",void 0),this.authToken=e,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.messageHandlers=new Map}},k=new class extends a{async getDocuments(e){return this.get("/",e)}async getDocument(e){return this.get("/".concat(e))}async uploadDocument(e){let t=new FormData;return t.append("file",e.file),e.category&&t.append("category",e.category),e.tags&&t.append("tags",JSON.stringify(e.tags)),e.project_id&&t.append("project_id",e.project_id),e.house_id&&t.append("house_id",e.house_id),e.work_entry_id&&t.append("work_entry_id",e.work_entry_id),e.team_id&&t.append("team_id",e.team_id),e.access_level&&t.append("access_level",e.access_level),e.description&&t.append("description",e.description),e.custom_fields&&t.append("custom_fields",JSON.stringify(e.custom_fields)),this.request("/upload",{method:"POST",body:t,headers:{Authorization:this.getHeaders().Authorization}})}async updateDocument(e,t){return this.patch("/".concat(e),t)}async deleteDocument(e){return this.delete("/".concat(e))}async downloadDocument(e){let t=await fetch("".concat(this.baseURL,"/").concat(e,"/download"),{headers:this.getHeaders()});if(!t.ok)throw new r(t.status,"Download failed: ".concat(t.statusText));return t.blob()}async getDocumentVersions(e){return this.get("/".concat(e,"/versions"))}async createNewVersion(e,t,n){let s=new FormData;return s.append("file",t),n&&s.append("comment",n),this.request("/".concat(e,"/versions"),{method:"POST",body:s,headers:{Authorization:this.getHeaders().Authorization}})}async revertToVersion(e,t){return this.post("/".concat(e,"/versions/").concat(t,"/revert"))}async searchDocuments(e){return this.post("/search",e)}async classifyDocument(e){return this.post("/classify",e)}async getOCRResult(e){return this.get("/".concat(e,"/ocr"))}async triggerOCR(e){return this.post("/".concat(e,"/ocr"))}constructor(){super("".concat(s,"/api/documents"))}},b=new class extends a{async getCategories(){return this.get("/")}async getCategory(e){return this.get("/".concat(e))}async createCategory(e){return this.post("/",e)}async updateCategory(e,t){return this.patch("/".concat(e),t)}async deleteCategory(e){return this.delete("/".concat(e))}constructor(){super("".concat(s,"/api/document-categories"))}},T=new class extends a{async getDocumentAccess(e){return this.get("/document/".concat(e))}async grantAccess(e){return this.post("/grant",e)}async revokeAccess(e){return this.delete("/".concat(e))}async updateAccess(e,t){return this.patch("/".concat(e),t)}constructor(){super("".concat(s,"/api/document-access"))}},S=new class extends a{async createShare(e){return this.post("/",e)}async getShare(e){return this.get("/token/".concat(e))}async getDocumentShares(e){return this.get("/document/".concat(e))}async updateShare(e,t){return this.patch("/".concat(e),t)}async deleteShare(e){return this.delete("/".concat(e))}async accessSharedDocument(e,t){return this.post("/access/".concat(e),{password:t})}constructor(){super("".concat(s,"/api/document-shares"))}},M=new class extends a{async getTemplates(){return this.get("/")}async getTemplate(e){return this.get("/".concat(e))}async createTemplate(e){return this.post("/",e)}async updateTemplate(e,t){return this.patch("/".concat(e),t)}async deleteTemplate(e){return this.delete("/".concat(e))}async createDocumentFromTemplate(e,t){return this.post("/".concat(e,"/create-document"),t)}constructor(){super("".concat(s,"/api/document-templates"))}},O=new class extends a{async getFeatures(e){return this.get("/features",e)}async getFeature(e){return this.get("/features/".concat(e))}async createFeature(e){return this.post("/features",e)}async updateFeature(e,t){return this.patch("/features/".concat(e),t)}async deleteFeature(e){return this.delete("/features/".concat(e))}async searchNearby(e){return this.post("/features/search/nearby",e)}async getProjectBounds(e){return this.get("/projects/".concat(e,"/bounds"))}async calculateSegmentLength(e){return this.get("/segments/".concat(e,"/length"))}async getProjectFeatures(e){return this.get("/projects/".concat(e,"/features"))}constructor(){super("".concat(s,"/api/geospatial"))}},P=new class extends a{async getRoutes(e){return this.get("/",e?{project_id:e}:void 0)}async getRoute(e){return this.get("/".concat(e))}async createRoute(e){return this.post("/",e)}async updateRoute(e,t){return this.patch("/".concat(e),t)}async deleteRoute(e){return this.delete("/".concat(e))}async optimizeRoute(e,t){return this.post("/".concat(e,"/optimize"),t||{})}async calculateRoute(e,t){return this.post("/calculate",{waypoints:e,route_type:t})}constructor(){super("".concat(s,"/api/geo-routes"))}},Q=new class extends a{async getLayers(e){return this.get("/",e?{project_id:e}:void 0)}async getLayer(e){return this.get("/".concat(e))}async createLayer(e){return this.post("/",e)}async updateLayer(e,t){return this.patch("/".concat(e),t)}async deleteLayer(e){return this.delete("/".concat(e))}async toggleLayerVisibility(e,t){return this.patch("/".concat(e,"/visibility"),{is_visible:t})}async updateLayerOpacity(e,t){return this.patch("/".concat(e,"/opacity"),{opacity:t})}async reorderLayers(e){return this.post("/reorder",{layer_ids:e})}constructor(){super("".concat(s,"/api/geo-layers"))}},x=new class extends a{async getMeasurements(e){return this.get("/",e?{project_id:e}:void 0)}async getMeasurement(e){return this.get("/".concat(e))}async createMeasurement(e){return this.post("/",e)}async updateMeasurement(e,t){return this.patch("/".concat(e),t)}async deleteMeasurement(e){return this.delete("/".concat(e))}async calculateDistance(e){return this.post("/calculate/distance",{coordinates:e})}async calculateArea(e){return this.post("/calculate/area",{coordinates:e})}constructor(){super("".concat(s,"/api/geo-measurements"))}},q=new class extends a{async getAnnotations(e){return this.get("/",e?{project_id:e}:void 0)}async getAnnotation(e){return this.get("/".concat(e))}async createAnnotation(e){return this.post("/",e)}async updateAnnotation(e,t){return this.patch("/".concat(e),t)}async deleteAnnotation(e){return this.delete("/".concat(e))}constructor(){super("".concat(s,"/api/geo-annotations"))}},E=new class extends a{async getTiles(){return this.get("/")}async getTile(e){return this.get("/".concat(e))}async createTile(e){return this.post("/",e)}async updateTile(e,t){return this.patch("/".concat(e),t)}async deleteTile(e){return this.delete("/".concat(e))}async setActiveTile(e){return this.post("/".concat(e,"/activate"))}constructor(){super("".concat(s,"/api/map-tiles"))}},C=new class extends a{async getAnalyses(e){return this.get("/",e?{project_id:e}:void 0)}async getAnalysis(e){return this.get("/".concat(e))}async createAnalysis(e){return this.post("/",e)}async deleteAnalysis(e){return this.delete("/".concat(e))}async getAnalysisResult(e){return this.get("/".concat(e,"/result"))}async runBufferAnalysis(e,t,n){return this.post("/buffer",{input_features:e,parameters:{buffer_distance:t,unit:n}})}async runIntersectionAnalysis(e){return this.post("/intersection",{input_features:e,parameters:{}})}async runRouteOptimization(e,t){return this.post("/route-optimization",{input_features:e,parameters:t})}constructor(){super("".concat(s,"/api/geo-analysis"))}};function D(e){i.setAuthToken(e),o.setAuthToken(e),c.setAuthToken(e),u.setAuthToken(e),l.setAuthToken(e),h.setAuthToken(e),d.setAuthToken(e),p.setAuthToken(e),y.setAuthToken(e),g.setAuthToken(e),m.setAuthToken(e),f.setAuthToken(e),_.setAuthToken(e),w.setAuthToken(e),A.setAuthToken(e),k.setAuthToken(e),b.setAuthToken(e),T.setAuthToken(e),S.setAuthToken(e),M.setAuthToken(e),O.setAuthToken(e),P.setAuthToken(e),Q.setAuthToken(e),x.setAuthToken(e),q.setAuthToken(e),E.setAuthToken(e),C.setAuthToken(e)}function j(){i.clearAuthToken(),o.clearAuthToken(),c.clearAuthToken(),u.clearAuthToken(),l.clearAuthToken(),h.clearAuthToken(),d.clearAuthToken(),p.clearAuthToken(),y.clearAuthToken(),g.clearAuthToken(),m.clearAuthToken(),f.clearAuthToken(),_.clearAuthToken(),w.clearAuthToken(),k.clearAuthToken(),b.clearAuthToken(),T.clearAuthToken(),S.clearAuthToken(),M.clearAuthToken(),O.clearAuthToken(),P.clearAuthToken(),Q.clearAuthToken(),x.clearAuthToken(),q.clearAuthToken(),E.clearAuthToken(),C.clearAuthToken()}},71436,e=>{"use strict";e.s(["getStoredToken",()=>l,"getStoredUser",()=>h,"initializeAuth",()=>p,"useAuth",()=>y,"useLogin",()=>g,"useLogout",()=>m,"usePermissions",()=>f,"useRequireAuth",()=>_]);var t=e.i(66027),n=e.i(54616),s=e.i(12598),r=e.i(46696),a=e.i(41931);let i={all:["auth"],user:()=>[...i.all,"user"],token:()=>[...i.all,"token"]},o="cometa_auth_token",c="cometa_refresh_token",u="cometa_user";function l(){return localStorage.getItem(o)}function h(){try{let e=localStorage.getItem(u);return e?JSON.parse(e):null}catch(e){return null}}function d(){localStorage.removeItem(o),localStorage.removeItem(c),localStorage.removeItem(u),document.cookie="cometa_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",(0,a.clearAuthTokenForAllClients)()}function p(){let e=l();e&&(0,a.setAuthTokenForAllClients)(e)}function y(){return(0,t.useQuery)({queryKey:i.user(),queryFn:()=>{let e=h();if(!e)throw Error("Not authenticated");return e},staleTime:1/0,retry:!1})}function g(){let e=(0,s.useQueryClient)();return(0,n.useMutation)({mutationFn:e=>a.authApi.login(e),onSuccess:t=>{localStorage.setItem(o,t.access_token),localStorage.setItem(c,t.refresh_token),localStorage.setItem(u,JSON.stringify({...t.user,permissions:t.permissions}));let n=new Date;n.setTime(n.getTime()+1e3*t.expires_in);let s="https:"===window.location.protocol;document.cookie="cometa_auth_token=".concat(t.access_token,"; expires=").concat(n.toUTCString(),"; path=/; samesite=strict").concat(s?"; secure":""),(0,a.setAuthTokenForAllClients)(t.access_token);let l={...t.user,permissions:t.permissions};e.setQueryData(i.user(),l),r.toast.success("Welcome back, ".concat(t.user.first_name,"!")),window.location.href="/dashboard"},onError:e=>{r.toast.error("Login failed: ".concat(e.message))}})}function m(){let e=(0,s.useQueryClient)();return(0,n.useMutation)({mutationFn:()=>a.authApi.logout(),onSuccess:()=>{d(),e.removeQueries({queryKey:i.all}),e.clear(),r.toast.success("Logged out successfully")},onError:t=>{d(),e.removeQueries({queryKey:i.all}),e.clear(),r.toast.error("Logout failed")},onSettled:()=>{window.location.href="/login"}})}function f(){let{data:e}=y(),t=t=>(null==e?void 0:e.role)===t,n=t=>null!=e&&!!e.role&&t.includes(e.role);return{user:e,hasPermission:t=>{var n,s;return null!=(s=null==e||null==(n=e.permissions)?void 0:n.includes(t))&&s},hasRole:t,hasAnyRole:n,isAdmin:t("admin"),isProjectManager:t("pm"),isForeman:t("foreman"),isWorker:n(["crew","worker"]),isViewer:t("viewer"),canManageTeams:n(["admin","pm","foreman"]),canApproveWork:n(["admin","pm","foreman"]),canManageWork:n(["admin","pm","foreman","crew","worker"]),canViewFinances:n(["admin","pm","foreman"]),canManageFinances:n(["admin","pm"]),canManageInventory:n(["admin","pm","foreman"])}}function _(){let{data:e,isLoading:t,error:n}=y();return{user:e,isLoading:t,isAuthenticated:!!e&&!n,error:n}}},23281,e=>{"use strict";e.s(["WebSocketProvider",()=>c,"useWebSocket",()=>u]);var t=e.i(43476),n=e.i(71645),s=e.i(12598),r=e.i(46696),a=e.i(71436),i=e.i(41931);let o=(0,n.createContext)(null);function c(e){let{children:c}=e,{user:u,token:l}=(0,a.useAuth)(),h=(0,s.useQueryClient)(),d=(0,n.useRef)(!1),p=(0,n.useRef)(0),y=n.default.useCallback(e=>{h.invalidateQueries({queryKey:["notifications"]}),(null==u?void 0:u.id)&&h.invalidateQueries({queryKey:["notifications","unread-count",u.id]}),h.setQueryData(["notifications","detail",e.id],e),("high"===e.priority||"urgent"===e.priority)&&r.toast.info(e.title,{description:e.body,action:"urgent"===e.priority?{label:"View",onClick:()=>{console.log("Navigate to notification:",e.id)}}:void 0})},[h,null==u?void 0:u.id]),g=n.default.useCallback(e=>{var t,n;switch(console.log("Realtime update received:",e),e.entity_type){case"project":h.invalidateQueries({queryKey:["projects"]}),e.entity_id&&h.invalidateQueries({queryKey:["projects","detail",e.entity_id]});break;case"work_entry":h.invalidateQueries({queryKey:["work-entries"]}),e.entity_id&&h.invalidateQueries({queryKey:["work-entries","detail",e.entity_id]});break;case"material":h.invalidateQueries({queryKey:["materials"]}),e.entity_id&&h.invalidateQueries({queryKey:["materials","detail",e.entity_id]});break;case"material_allocation":h.invalidateQueries({queryKey:["material-allocations"]});break;case"house":h.invalidateQueries({queryKey:["houses"]}),e.entity_id&&h.invalidateQueries({queryKey:["houses","detail",e.entity_id]});break;case"appointment":h.invalidateQueries({queryKey:["appointments"]}),e.entity_id&&h.invalidateQueries({queryKey:["appointments","detail",e.entity_id]});break;case"crew":h.invalidateQueries({queryKey:["crews"]}),e.entity_id&&h.invalidateQueries({queryKey:["crews","detail",e.entity_id]});break;default:console.log("Unknown entity type for realtime update:",e.entity_type)}if("status_changed"===e.type&&(null==(t=e.data)?void 0:t.status)){let t=e.entity_type.replace("_"," ");r.toast.info("".concat(t," status updated"),{description:"Status changed to: ".concat(e.data.status)})}if("assignment_changed"===e.type&&(null==u?void 0:u.id)&&(null==(n=e.data)?void 0:n.assigned_to)===u.id){let t=e.entity_type.replace("_"," ");r.toast.info("New ".concat(t," assigned"),{description:"You have been assigned to a ".concat(t)})}},[h,null==u?void 0:u.id]),m=n.default.useCallback(e=>{console.log("User status update:",e)},[]),f=n.default.useCallback(e=>{console.log("Typing indicator:",e)},[]),_=n.default.useCallback(async()=>{if((null==u?void 0:u.id)&&l)try{i.wsApi.setAuthToken(l),await i.wsApi.connect(u.id),d.current=!0,p.current=0,console.log("WebSocket connected successfully"),i.wsApi.subscribe("notification",y),i.wsApi.subscribe("realtime_update",g),i.wsApi.subscribe("user_status",m),i.wsApi.subscribe("typing_indicator",f),i.wsApi.send("user_status",{status:"online",timestamp:new Date().toISOString()})}catch(e){if(console.error("WebSocket connection failed:",e),d.current=!1,p.current<5){p.current++;let e=1e3*Math.pow(2,p.current);console.log("Retrying WebSocket connection in ".concat(e,"ms (attempt ").concat(p.current,"/").concat(5,")")),setTimeout(()=>{_()},e)}else console.error("Max WebSocket connection attempts reached"),r.toast.error("Failed to establish real-time connection",{description:"Some features may not work properly. Please refresh the page."})}},[null==u?void 0:u.id,l,y,g,m,f]),w=n.default.useCallback(()=>{d.current&&(i.wsApi.send("user_status",{status:"offline",timestamp:new Date().toISOString()}),i.wsApi.unsubscribe("notification",y),i.wsApi.unsubscribe("realtime_update",g),i.wsApi.unsubscribe("user_status",m),i.wsApi.unsubscribe("typing_indicator",f),i.wsApi.disconnect(),d.current=!1,p.current=0,console.log("WebSocket disconnected"))},[y,g,m,f]);(0,n.useEffect)(()=>((null==u?void 0:u.id)&&l?_():w(),()=>{w()}),[null==u?void 0:u.id,l,_,w]),(0,n.useEffect)(()=>{let e=()=>{document.hidden?d.current&&i.wsApi.send("user_status",{status:"away",timestamp:new Date().toISOString()}):(null==u?void 0:u.id)&&l&&(d.current?i.wsApi.send("user_status",{status:"online",timestamp:new Date().toISOString()}):_())};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[null==u?void 0:u.id,l,_]),(0,n.useEffect)(()=>{let e=()=>{d.current&&i.wsApi.send("user_status",{status:"offline",timestamp:new Date().toISOString()})};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[]);let A={isConnected:d.current,send:(e,t)=>{d.current?i.wsApi.send(e,t):console.warn("WebSocket not connected, cannot send message:",{type:e,data:t})},subscribe:(e,t)=>{i.wsApi.subscribe(e,t)},unsubscribe:(e,t)=>{i.wsApi.unsubscribe(e,t)}};return(0,t.jsx)(o.Provider,{value:A,children:c})}function u(){let e=(0,n.useContext)(o);if(!e)throw Error("useWebSocket must be used within a WebSocketProvider");return e}},91961,e=>{"use strict";e.s(["Providers",()=>N],91961);var t,n,s,r,a,i,o,c,u,l,h,d,p=e.i(43476),y=e.i(39946),g=e.i(70292),m=e.i(62351),f=e.i(26005);function _(e,t){var n=(0,f._)(e,t,"update");if(n.set){if(!n.get)throw TypeError("attempted to read set only private field");return"__destrWrapper"in n||(n.__destrWrapper={set value(v){n.set.call(e,v)},get value(){return n.get.call(e)}}),n.__destrWrapper}if(!n.writable)throw TypeError("attempted to set read only private field");return n}var w=e.i(19273),A=e.i(86491),k=e.i(40143),b=e.i(15823),T=(t=new WeakMap,class extends b.Subscribable{build(e,t,n){var s;let r=t.queryKey,a=null!=(s=t.queryHash)?s:(0,w.hashQueryKeyByOptions)(r,t),i=this.get(a);return i||(i=new A.Query({client:e,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(i)),i}add(e){(0,y._)(this,t).has(e.queryHash)||((0,y._)(this,t).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){let n=(0,y._)(this,t).get(e.queryHash);n&&(e.destroy(),n===e&&(0,y._)(this,t).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){k.notifyManager.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return(0,y._)(this,t).get(e)}getAll(){return[...(0,y._)(this,t).values()]}find(e){let t={exact:!0,...e};return this.getAll().find(e=>(0,w.matchQuery)(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getAll();return Object.keys(e).length>0?t.filter(t=>(0,w.matchQuery)(e,t)):t}notify(e){k.notifyManager.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){k.notifyManager.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){k.notifyManager.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}constructor(e={}){super(),(0,g._)(this,t,{writable:!0,value:void 0}),this.config=e,(0,m._)(this,t,new Map)}}),S=e.i(14272),M=b,O=(n=new WeakMap,s=new WeakMap,r=new WeakMap,class extends M.Subscribable{build(e,t,n){let s=new S.Mutation({client:e,mutationCache:this,mutationId:++_(this,r).value,options:e.defaultMutationOptions(t),state:n});return this.add(s),s}add(e){(0,y._)(this,n).add(e);let t=P(e);if("string"==typeof t){let n=(0,y._)(this,s).get(t);n?n.push(e):(0,y._)(this,s).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if((0,y._)(this,n).delete(e)){let t=P(e);if("string"==typeof t){let n=(0,y._)(this,s).get(t);if(n)if(n.length>1){let t=n.indexOf(e);-1!==t&&n.splice(t,1)}else n[0]===e&&(0,y._)(this,s).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){let t=P(e);if("string"!=typeof t)return!0;{let n=(0,y._)(this,s).get(t),r=null==n?void 0:n.find(e=>"pending"===e.state.status);return!r||r===e}}runNext(e){let t=P(e);if("string"!=typeof t)return Promise.resolve();{var n,r;let a=null==(n=(0,y._)(this,s).get(t))?void 0:n.find(t=>t!==e&&t.state.isPaused);return null!=(r=null==a?void 0:a.continue())?r:Promise.resolve()}}clear(){k.notifyManager.batch(()=>{(0,y._)(this,n).forEach(e=>{this.notify({type:"removed",mutation:e})}),(0,y._)(this,n).clear(),(0,y._)(this,s).clear()})}getAll(){return Array.from((0,y._)(this,n))}find(e){let t={exact:!0,...e};return this.getAll().find(e=>(0,w.matchMutation)(t,e))}findAll(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getAll().filter(t=>(0,w.matchMutation)(e,t))}notify(e){k.notifyManager.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){let e=this.getAll().filter(e=>e.state.isPaused);return k.notifyManager.batch(()=>Promise.all(e.map(e=>e.continue().catch(w.noop))))}constructor(e={}){super(),(0,g._)(this,n,{writable:!0,value:void 0}),(0,g._)(this,s,{writable:!0,value:void 0}),(0,g._)(this,r,{writable:!0,value:void 0}),this.config=e,(0,m._)(this,n,new Set),(0,m._)(this,s,new Map),(0,m._)(this,r,0)}});function P(e){var t;return null==(t=e.options.scope)?void 0:t.id}var Q=e.i(75555),x=e.i(14448);function q(e){return{onFetch:(t,n)=>{var s,r,a,i,o;let c=t.options,u=null==(a=t.fetchOptions)||null==(r=a.meta)||null==(s=r.fetchMore)?void 0:s.direction,l=(null==(i=t.state.data)?void 0:i.pages)||[],h=(null==(o=t.state.data)?void 0:o.pageParams)||[],d={pages:[],pageParams:[]},p=0,y=async()=>{let n=!1,s=(0,w.ensureQueryFn)(t.options,t.fetchOptions),r=async(e,r,a)=>{if(n)return Promise.reject();if(null==r&&e.pages.length)return Promise.resolve(e);let i=(()=>{let e={client:t.client,queryKey:t.queryKey,pageParam:r,direction:a?"backward":"forward",meta:t.options.meta};return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(t.signal.aborted?n=!0:t.signal.addEventListener("abort",()=>{n=!0}),t.signal)}),e})(),o=await s(i),{maxPages:c}=t.options,u=a?w.addToStart:w.addToEnd;return{pages:u(e.pages,o,c),pageParams:u(e.pageParams,r,c)}};if(u&&l.length){let e="backward"===u,t={pages:l,pageParams:h},n=(e?function(e,t){var n;let{pages:s,pageParams:r}=t;return s.length>0?null==(n=e.getPreviousPageParam)?void 0:n.call(e,s[0],s,r[0],r):void 0}:E)(c,t);d=await r(t,n,e)}else{let t=null!=e?e:l.length;do{var a;let e=0===p?null!=(a=h[0])?a:c.initialPageParam:E(c,d);if(p>0&&null==e)break;d=await r(d,e),p++}while(p<t)}return d};t.options.persister?t.fetchFn=()=>{var e,s;return null==(e=(s=t.options).persister)?void 0:e.call(s,y,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=y}}}function E(e,t){let{pages:n,pageParams:s}=t,r=n.length-1;return n.length>0?e.getNextPageParam(n[r],n,s[r],s):void 0}var C=(a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,class{mount(){_(this,l).value++,1===(0,y._)(this,l)&&((0,m._)(this,h,Q.focusManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),(0,y._)(this,a).onFocus())})),(0,m._)(this,d,x.onlineManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),(0,y._)(this,a).onOnline())})))}unmount(){var e,t;_(this,l).value--,0===(0,y._)(this,l)&&(null==(e=(0,y._)(this,h))||e.call(this),(0,m._)(this,h,void 0),null==(t=(0,y._)(this,d))||t.call(this),(0,m._)(this,d,void 0))}isFetching(e){return(0,y._)(this,a).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return(0,y._)(this,i).findAll({...e,status:"pending"}).length}getQueryData(e){var t;let n=this.defaultQueryOptions({queryKey:e});return null==(t=(0,y._)(this,a).get(n.queryHash))?void 0:t.state.data}ensureQueryData(e){let t=this.defaultQueryOptions(e),n=(0,y._)(this,a).build(this,t),s=n.state.data;return void 0===s?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime((0,w.resolveStaleTime)(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return(0,y._)(this,a).findAll(e).map(e=>{let{queryKey:t,state:n}=e;return[t,n.data]})}setQueryData(e,t,n){let s=this.defaultQueryOptions({queryKey:e}),r=(0,y._)(this,a).get(s.queryHash),i=null==r?void 0:r.state.data,o=(0,w.functionalUpdate)(t,i);if(void 0!==o)return(0,y._)(this,a).build(this,s).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return k.notifyManager.batch(()=>(0,y._)(this,a).findAll(e).map(e=>{let{queryKey:s}=e;return[s,this.setQueryData(s,t,n)]}))}getQueryState(e){var t;let n=this.defaultQueryOptions({queryKey:e});return null==(t=(0,y._)(this,a).get(n.queryHash))?void 0:t.state}removeQueries(e){let t=(0,y._)(this,a);k.notifyManager.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){let n=(0,y._)(this,a);return k.notifyManager.batch(()=>(n.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={revert:!0,...t};return Promise.all(k.notifyManager.batch(()=>(0,y._)(this,a).findAll(e).map(e=>e.cancel(n)))).then(w.noop).catch(w.noop)}invalidateQueries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return k.notifyManager.batch(()=>{var n,s;return((0,y._)(this,a).findAll(e).forEach(e=>{e.invalidate()}),(null==e?void 0:e.refetchType)==="none")?Promise.resolve():this.refetchQueries({...e,type:null!=(s=null!=(n=null==e?void 0:e.refetchType)?n:null==e?void 0:e.type)?s:"active"},t)})}refetchQueries(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={...n,cancelRefetch:null==(t=n.cancelRefetch)||t};return Promise.all(k.notifyManager.batch(()=>(0,y._)(this,a).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,s);return s.throwOnError||(t=t.catch(w.noop)),"paused"===e.state.fetchStatus?Promise.resolve():t}))).then(w.noop)}fetchQuery(e){let t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);let n=(0,y._)(this,a).build(this,t);return n.isStaleByTime((0,w.resolveStaleTime)(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(w.noop).catch(w.noop)}fetchInfiniteQuery(e){return e.behavior=q(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(w.noop).catch(w.noop)}ensureInfiniteQueryData(e){return e.behavior=q(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return x.onlineManager.isOnline()?(0,y._)(this,i).resumePausedMutations():Promise.resolve()}getQueryCache(){return(0,y._)(this,a)}getMutationCache(){return(0,y._)(this,i)}getDefaultOptions(){return(0,y._)(this,o)}setDefaultOptions(e){(0,m._)(this,o,e)}setQueryDefaults(e,t){(0,y._)(this,c).set((0,w.hashKey)(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){let t=[...(0,y._)(this,c).values()],n={};return t.forEach(t=>{(0,w.partialMatchKey)(e,t.queryKey)&&Object.assign(n,t.defaultOptions)}),n}setMutationDefaults(e,t){(0,y._)(this,u).set((0,w.hashKey)(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){let t=[...(0,y._)(this,u).values()],n={};return t.forEach(t=>{(0,w.partialMatchKey)(e,t.mutationKey)&&Object.assign(n,t.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;let t={...(0,y._)(this,o).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=(0,w.hashQueryKeyByOptions)(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===w.skipToken&&(t.enabled=!1),t}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:{...(0,y._)(this,o).mutations,...(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){(0,y._)(this,a).clear(),(0,y._)(this,i).clear()}constructor(e={}){(0,g._)(this,a,{writable:!0,value:void 0}),(0,g._)(this,i,{writable:!0,value:void 0}),(0,g._)(this,o,{writable:!0,value:void 0}),(0,g._)(this,c,{writable:!0,value:void 0}),(0,g._)(this,u,{writable:!0,value:void 0}),(0,g._)(this,l,{writable:!0,value:void 0}),(0,g._)(this,h,{writable:!0,value:void 0}),(0,g._)(this,d,{writable:!0,value:void 0}),(0,m._)(this,a,e.queryCache||new T),(0,m._)(this,i,e.mutationCache||new O),(0,m._)(this,o,e.defaultOptions||{}),(0,m._)(this,c,new Map),(0,m._)(this,u,new Map),(0,m._)(this,l,0)}}),D=e.i(12598);e.i(47167);var j=function(){return null},W=e.i(71645),R=(e,t,n,s,r,a,i,o)=>{let c=document.documentElement,u=["light","dark"];function l(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,s=n&&a?r.map(e=>a[e]||e):r;n?(c.classList.remove(...s),c.classList.add(a&&a[t]?a[t]:t)):c.setAttribute(e,t)}),n=t,o&&u.includes(n)&&(c.style.colorScheme=n)}if(s)l(s);else try{let e=localStorage.getItem(t)||n,s=i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;l(s)}catch(e){}},K=W.createContext(void 0),H={setTheme:e=>{},themes:[]};W.memo(e=>{let{forcedTheme:t,storageKey:n,attribute:s,enableSystem:r,enableColorScheme:a,defaultTheme:i,value:o,themes:c,nonce:u,scriptProps:l}=e,h=JSON.stringify([s,n,i,t,c,o,r,a]).slice(1,-1);return W.createElement("script",{...l,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:"(".concat(R.toString(),")(").concat(h,")")}})});var F=e.i(46696);let L=e=>{let{...t}=e,{theme:n="system"}=(()=>{var e;return null!=(e=W.useContext(K))?e:H})();return(0,p.jsx)(F.Toaster,{theme:n,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var I=e.i(23281);function N(e){let{children:t}=e,[n]=(0,W.useState)(()=>new C({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0,retry:(e,t)=>{if(t instanceof Error&&"status"in t){let n=t.status;if(n>=400&&n<500)return 408===n;if(n>=500&&n<600)return e<2}return e<3},retryDelay:e=>{let t=Math.min(1e3*2**e,3e4),n=.1*Math.random()*t;return t+n},networkMode:"online"},mutations:{retry:(e,t)=>{if(t instanceof Error&&"status"in t){let n=t.status;if(n>=500&&n<600)return e<2;if(408===n||504===n)return e<3}return!1},networkMode:"online"}}}));return(0,p.jsx)(D.QueryClientProvider,{client:n,children:(0,p.jsxs)(I.WebSocketProvider,{children:[t,(0,p.jsx)(L,{position:"bottom-right",richColors:!0}),(0,p.jsx)(j,{initialIsOpen:!1})]})})}}]);