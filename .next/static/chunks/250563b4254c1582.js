(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,24687,e=>{"use strict";e.s(["Textarea",()=>a]);var t=e.i(43476),r=e.i(71645),s=e.i(75157);let a=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...i})});a.displayName="Textarea"},31278,e=>{"use strict";e.s(["Loader2",()=>t],31278);let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},46897,e=>{"use strict";e.s(["MapPin",()=>t],46897);let t=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},3116,e=>{"use strict";e.s(["Clock",()=>t],3116);let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},57428,e=>{"use strict";e.s(["Checkbox",()=>Q],57428);var t=e.i(43476),r=e.i(71645),s=e.i(20783),a=e.i(30030),i=e.i(81140),n=e.i(69340),l=e.i(99682),o=e.i(35804),c=e.i(96626),d=e.i(48425),u="Checkbox",[m,f]=(0,a.createContextScope)(u),[x,p]=m(u);function h(e){let{__scopeCheckbox:s,checked:a,children:i,defaultChecked:l,disabled:o,form:c,name:d,onCheckedChange:m,required:f,value:p="on",internal_do_not_use_render:h}=e,[y,v]=(0,n.useControllableState)({prop:a,defaultProp:null!=l&&l,onChange:m,caller:u}),[g,j]=r.useState(null),[w,b]=r.useState(null),N=r.useRef(!1),C=!g||!!c||!!g.closest("form"),T={checked:y,disabled:o,setChecked:v,control:g,setControl:j,name:d,form:c,value:p,hasConsumerStoppedPropagationRef:N,required:f,defaultChecked:!k(l)&&l,isFormControl:C,bubbleInput:w,setBubbleInput:b};return(0,t.jsx)(x,{scope:s,...T,children:"function"==typeof h?h(T):i})}var y="CheckboxTrigger",v=r.forwardRef((e,a)=>{let{__scopeCheckbox:n,onKeyDown:l,onClick:o,...c}=e,{control:u,value:m,disabled:f,checked:x,required:h,setControl:v,setChecked:g,hasConsumerStoppedPropagationRef:j,isFormControl:w,bubbleInput:b}=p(y,n),N=(0,s.useComposedRefs)(a,v),T=r.useRef(x);return r.useEffect(()=>{let e=null==u?void 0:u.form;if(e){let t=()=>g(T.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[u,g]),(0,t.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":k(x)?"mixed":x,"aria-required":h,"data-state":C(x),"data-disabled":f?"":void 0,disabled:f,value:m,...c,ref:N,onKeyDown:(0,i.composeEventHandlers)(l,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.composeEventHandlers)(o,e=>{g(e=>!!k(e)||!e),b&&w&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})})});v.displayName=y;var g=r.forwardRef((e,r)=>{let{__scopeCheckbox:s,name:a,checked:i,defaultChecked:n,required:l,disabled:o,value:c,onCheckedChange:d,form:u,...m}=e;return(0,t.jsx)(h,{__scopeCheckbox:s,checked:i,defaultChecked:n,disabled:o,required:l,onCheckedChange:d,name:a,form:u,value:c,internal_do_not_use_render:e=>{let{isFormControl:a}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v,{...m,ref:r,__scopeCheckbox:s}),a&&(0,t.jsx)(N,{__scopeCheckbox:s})]})}})});g.displayName=u;var j="CheckboxIndicator",w=r.forwardRef((e,r)=>{let{__scopeCheckbox:s,forceMount:a,...i}=e,n=p(j,s);return(0,t.jsx)(c.Presence,{present:a||k(n.checked)||!0===n.checked,children:(0,t.jsx)(d.Primitive.span,{"data-state":C(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:r,style:{pointerEvents:"none",...e.style}})})});w.displayName=j;var b="CheckboxBubbleInput",N=r.forwardRef((e,a)=>{let{__scopeCheckbox:i,...n}=e,{control:c,hasConsumerStoppedPropagationRef:u,checked:m,defaultChecked:f,required:x,disabled:h,name:y,value:v,form:g,bubbleInput:j,setBubbleInput:w}=p(b,i),N=(0,s.useComposedRefs)(a,w),C=(0,l.usePrevious)(m),T=(0,o.useSize)(c);r.useEffect(()=>{if(!j)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!u.current;if(C!==m&&e){let r=new Event("click",{bubbles:t});j.indeterminate=k(m),e.call(j,!k(m)&&m),j.dispatchEvent(r)}},[j,C,m,u]);let _=r.useRef(!k(m)&&m);return(0,t.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=f?f:_.current,required:x,disabled:h,name:y,value:v,form:g,...n,tabIndex:-1,ref:N,style:{...n.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function k(e){return"indeterminate"===e}function C(e){return k(e)?"indeterminate":e?"checked":"unchecked"}N.displayName=b;var T=e.i(43531),_=e.i(75157);let Q=r.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(g,{ref:r,className:(0,_.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,t.jsx)(w,{className:(0,_.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(T.Check,{className:"h-4 w-4"})})})});Q.displayName=g.displayName},7233,e=>{"use strict";e.s(["Plus",()=>t],7233);let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},84774,e=>{"use strict";e.s(["Table",()=>a,"TableBody",()=>n,"TableCell",()=>c,"TableHead",()=>o,"TableHeader",()=>i,"TableRow",()=>l]);var t=e.i(43476),r=e.i(71645),s=e.i(75157);let a=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",a),...i})})});a.displayName="Table";let i=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",a),...i})});i.displayName="TableHeader";let n=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",a),...i})});n.displayName="TableBody",r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...i})}).displayName="TableFooter";let l=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...i})});l.displayName="TableRow";let o=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("th",{ref:r,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...i})});o.displayName="TableHead";let c=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("td",{ref:r,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...i})});c.displayName="TableCell",r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",a),...i})}).displayName="TableCaption"},27612,e=>{"use strict";e.s(["Trash2",()=>t],27612);let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},88511,e=>{"use strict";e.s(["Edit",()=>t],88511);let t=(0,e.i(75254).default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},86536,e=>{"use strict";e.s(["Eye",()=>t],86536);let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},46835,e=>{"use strict";e.s(["useDeleteUser",()=>c,"useProjectManagers",()=>d,"useUpdateUser",()=>o,"useUsers",()=>l]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["users"],lists:()=>[...n.all,"list"],list:e=>[...n.lists(),e],details:()=>[...n.all,"detail"],detail:e=>[...n.details(),e]};function l(e){return(0,t.useQuery)({queryKey:n.list(e||{}),queryFn:()=>i.usersApi.getUsers(e),staleTime:3e5})}function o(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.usersApi.updateUser(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.detail(r)});let a=e.getQueryData(n.detail(r));return e.setQueryData(n.detail(r),e=>e?{...e,...s}:e),{previousUser:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousUser)&&e.setQueryData(n.detail(i),s.previousUser),a.toast.error("Failed to update user: ".concat(t.message))},onSuccess:()=>{e.invalidateQueries({queryKey:n.lists()}),a.toast.success("User updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.detail(a)})}})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.usersApi.deleteUser(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.detail(r)}),e.invalidateQueries({queryKey:n.lists()}),a.toast.success("User deleted successfully")},onError:e=>{a.toast.error("Failed to delete user: ".concat(e.message))}})}function d(){return l({role:"pm",page:1,per_page:50})}},48256,e=>{"use strict";e.s(["Globe",()=>t],48256);let t=(0,e.i(75254).default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},79002,e=>{"use strict";e.s(["UserPlus",()=>t],79002);let t=(0,e.i(75254).default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},8406,e=>{"use strict";e.s(["useToast",()=>r]);var t=e.i(46696);function r(){return{toast:e=>{let{title:r,description:s,variant:a="default",duration:i=5e3}=e;"destructive"===a?t.toast.error(r||"Error",{description:s,duration:i}):t.toast.success(r||"Success",{description:s,duration:i})}}}},20306,e=>{"use strict";e.s(["useCreateCrew",()=>c,"useCreateTeam",()=>x,"useCrew",()=>o,"useDeleteCrew",()=>u,"useForemenUsers",()=>f,"useGlobalTeams",()=>m,"useProjectTeams",()=>p,"useTeams",()=>l,"useUpdateCrew",()=>d,"useUpdateTeam",()=>h]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["teams"],crews:()=>[...n.all,"crews"],crew:e=>[...n.all,"crew",e]};function l(){return(0,t.useQuery)({queryKey:n.crews(),queryFn:async()=>{let e=await fetch("/api/crews");if(!e.ok)throw Error("Failed to fetch crews");return(await e.json()).crews||[]},staleTime:3e4})}function o(e){return(0,t.useQuery)({queryKey:n.crew(e),queryFn:()=>i.teamsApi.getCrew(e),enabled:!!e,staleTime:3e5})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.teamsApi.createCrew(e),onSuccess:t=>{e.invalidateQueries({queryKey:n.crews()}),e.setQueryData(n.crew(t.id),t),a.toast.success("Team created successfully")},onError:e=>{a.toast.error("Failed to create team: ".concat(e.message))}})}function d(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.teamsApi.updateCrew(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.crew(r)});let a=e.getQueryData(n.crew(r));return e.setQueryData(n.crew(r),e=>e?{...e,...s}:e),{previousCrew:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousCrew)&&e.setQueryData(n.crew(i),s.previousCrew),a.toast.error("Failed to update team: ".concat(t.message))},onSuccess:()=>{e.invalidateQueries({queryKey:n.crews()}),a.toast.success("Team updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.crew(a)})}})}function u(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.teamsApi.deleteCrew(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.crew(r)}),e.invalidateQueries({queryKey:n.crews()}),a.toast.success("Team deleted successfully")},onError:e=>{a.toast.error("Failed to delete team: ".concat(e.message))}})}function m(){return(0,t.useQuery)({queryKey:["global-teams"],queryFn:async()=>{let e=await fetch("/api/crews");if(!e.ok)throw Error("Failed to fetch global teams");let t=(await e.json()).crews||[],r={};return t.forEach(e=>{e.project_id&&(r[e.name]=(r[e.name]||0)+1)}),t.map(e=>{var t;return{id:e.id,name:e.name,foreman_name:(null==(t=e.foreman)?void 0:t.full_name)||e.foreman_name,is_active:"active"===e.status,project_count:r[e.name]||0,specialization:"mixed"}})}})}function f(){return(0,t.useQuery)({queryKey:["foremen-users"],queryFn:async()=>{let e=await fetch("/api/users?role=foreman&is_active=true");if(!e.ok){let e=await fetch("/api/users?role=pm&is_active=true");if(!e.ok)throw Error("Failed to fetch users");return(await e.json()).items||[]}let t=await e.json();if(0===t.items.length){let e=await fetch("/api/users?is_active=true");if(!e.ok)throw Error("Failed to fetch users");return((await e.json()).items||[]).filter(e=>"foreman"===e.role||"pm"===e.role)}return t.items||[]}})}function x(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let t=await fetch("/api/crews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create team");return t.json()},onSuccess:(t,r)=>{r.project_id&&(e.invalidateQueries({queryKey:["project-teams",r.project_id]}),e.invalidateQueries({queryKey:["project-preparation",r.project_id]})),e.invalidateQueries({queryKey:["global-teams"]}),e.invalidateQueries({queryKey:n.crews()}),a.toast.success(t.message||"Team created successfully")},onError:e=>{a.toast.error(e.message)}})}function p(e){return(0,t.useQuery)({queryKey:["project-teams",e],queryFn:async()=>{let t=await fetch("/api/crews?project_id=".concat(e));if(!t.ok)throw Error("Failed to fetch project teams");return(await t.json()).crews||[]},enabled:!!e})}function h(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let{id:t,data:r}=e,s=await fetch("/api/crews/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error((await s.json()).error||"Failed to update team");return s.json()},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["project-teams"]}),e.invalidateQueries({queryKey:["global-teams"]}),e.invalidateQueries({queryKey:n.crews()}),e.invalidateQueries({queryKey:["project-preparation"]}),a.toast.success(t.message||"Team updated successfully")},onError:e=>{a.toast.error(e.message)}})}},43432,e=>{"use strict";e.s(["Phone",()=>t],43432);let t=(0,e.i(75254).default)("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]])},63488,e=>{"use strict";e.s(["Mail",()=>t],63488);let t=(0,e.i(75254).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},40160,e=>{"use strict";e.s(["Download",()=>t],40160);let t=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},69074,e=>{"use strict";e.s(["Upload",()=>t],69074);let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},68148,e=>{"use strict";e.s(["Progress",()=>g],68148);var t=e.i(43476),r=e.i(71645),s=e.i(30030),a=e.i(48425),i="Progress",[n,l]=(0,s.createContextScope)(i),[o,c]=n(i),d=r.forwardRef((e,r)=>{var s,i,n,l;let{__scopeProgress:c,value:d=null,max:u,getValueLabel:m=f,...v}=e;(u||0===u)&&!h(u)&&console.error((s="".concat(u),i="Progress","Invalid prop `max` of value `".concat(s,"` supplied to `").concat(i,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let g=h(u)?u:100;null===d||y(d,g)||console.error((n="".concat(d),l="Progress","Invalid prop `value` of value `".concat(n,"` supplied to `").concat(l,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let j=y(d,g)?d:null,w=p(j)?m(j,g):void 0;return(0,t.jsx)(o,{scope:c,value:j,max:g,children:(0,t.jsx)(a.Primitive.div,{"aria-valuemax":g,"aria-valuemin":0,"aria-valuenow":p(j)?j:void 0,"aria-valuetext":w,role:"progressbar","data-state":x(j,g),"data-value":null!=j?j:void 0,"data-max":g,...v,ref:r})})});d.displayName=i;var u="ProgressIndicator",m=r.forwardRef((e,r)=>{var s;let{__scopeProgress:i,...n}=e,l=c(u,i);return(0,t.jsx)(a.Primitive.div,{"data-state":x(l.value,l.max),"data-value":null!=(s=l.value)?s:void 0,"data-max":l.max,...n,ref:r})});function f(e,t){return"".concat(Math.round(e/t*100),"%")}function x(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function p(e){return"number"==typeof e}function h(e){return p(e)&&!isNaN(e)&&e>0}function y(e,t){return p(e)&&!isNaN(e)&&e<=t&&e>=0}m.displayName=u;var v=e.i(75157);let g=r.forwardRef((e,r)=>{let{className:s,value:a,...i}=e;return(0,t.jsx)(d,{ref:r,className:(0,v.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,t.jsx)(m,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});g.displayName=d.displayName},98919,e=>{"use strict";e.s(["Shield",()=>t],98919);let t=(0,e.i(75254).default)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},32548,e=>{"use strict";e.s(["default",()=>N]);var t=e.i(43476),r=e.i(71645),s=e.i(66027),a=e.i(12598),i=e.i(78583),n=e.i(98919),l=e.i(78894),o=e.i(69638),c=e.i(3116),d=e.i(40160),u=e.i(86536),m=e.i(37727),f=e.i(7233),x=e.i(76639),p=e.i(19455),h=e.i(15288),y=e.i(87486),v=e.i(77572),g=e.i(40446);async function j(e){let t=await fetch("/api/users/".concat(e,"/documents"));if(!t.ok)throw Error("Failed to fetch documents");return t.json()}function w(e){let{document:r}=e,s=function(e){switch(e){case"active":return"bg-green-500";case"expired":return"bg-red-500";case"expiring_soon":return"bg-yellow-500";case"pending":return"bg-blue-500";default:return"bg-gray-500"}}(r.status),f=function(e){switch(e){case"active":return(0,t.jsx)(o.CheckCircle,{className:"h-4 w-4"});case"expired":return(0,t.jsx)(l.AlertTriangle,{className:"h-4 w-4"});case"expiring_soon":case"pending":return(0,t.jsx)(c.Clock,{className:"h-4 w-4"});case"inactive":return(0,t.jsx)(m.X,{className:"h-4 w-4"});default:return(0,t.jsx)(i.FileText,{className:"h-4 w-4"})}}(r.status),x=function(e){switch(e){case"active":return"Действителен";case"expired":return"Истёк";case"expiring_soon":return"Истекает скоро";case"pending":return"В ожидании";case"inactive":return"Неактивен";default:return"Неизвестен"}}(r.status),v=(0,a.useQueryClient)(),g=async()=>{try{console.log('💾 Скачиваю документ "'.concat(r.file_name,'" для работника ID: ').concat(r.user_id));let e="/api/users/".concat(r.user_id,"/documents/").concat(r.id,"/download"),t=await fetch(e);if(!t.ok)throw Error("Failed to download document");let s=await t.blob(),a=window.URL.createObjectURL(s),i=window.document.createElement("a");i.href=a,i.download=r.file_name,window.document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),window.document.body.removeChild(i)}catch(e){console.error("Download failed:",e),alert("Ошибка при скачивании документа")}},j=async()=>{if(window.confirm('Вы уверены, что хотите удалить документ "'.concat(r.file_name,'"?')))try{if(console.log('🗑️ Удаляю документ "'.concat(r.file_name,'" для работника ID: ').concat(r.user_id)),!(await fetch("/api/users/".concat(r.user_id,"/documents/").concat(r.id),{method:"DELETE"})).ok)throw Error("Failed to delete document");console.log('✅ Документ "'.concat(r.file_name,'" успешно удален')),v.invalidateQueries({queryKey:["worker-documents",r.user_id]}),alert("Документ успешно удален")}catch(e){console.error("Delete failed:",e),alert("Ошибка при удалении документа")}};return(0,t.jsxs)(h.Card,{className:"mb-4",children:[(0,t.jsx)(h.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(h.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.category.color}}),r.category.name_ru||r.category.name_en]}),(0,t.jsxs)(y.Badge,{variant:"secondary",className:"".concat(s," text-white flex items-center gap-1"),children:[f,x]})]})}),(0,t.jsxs)(h.CardContent,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[r.document_number&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"Номер документа:"}),(0,t.jsx)("p",{children:r.document_number})]}),r.issuing_authority&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"Выдавший орган:"}),(0,t.jsx)("p",{children:r.issuing_authority})]}),r.issue_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"Дата выдачи:"}),(0,t.jsx)("p",{children:new Date(r.issue_date).toLocaleDateString("ru-RU")})]}),r.expiry_date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"Дата истечения:"}),(0,t.jsx)("p",{className:"expired"===r.status?"text-red-600 font-medium":"expiring_soon"===r.status?"text-yellow-600 font-medium":"",children:new Date(r.expiry_date).toLocaleDateString("ru-RU")})]})]}),r.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-muted-foreground",children:"Примечания:"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:r.notes})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(i.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:r.file_name}),(0,t.jsxs)("span",{children:["(",function(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}(r.file_size),")"]}),r.is_verified&&(0,t.jsxs)(y.Badge,{variant:"outline",className:"text-green-600 border-green-600",children:[(0,t.jsx)(n.Shield,{className:"h-3 w-3 mr-1"}),"Проверен"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>{let e="/api/users/".concat(r.user_id,"/documents/").concat(r.id,"/view");console.log('👁️ Открываю документ "'.concat(r.file_name,'" для просмотра')),window.open(e,"_blank")},children:[(0,t.jsx)(u.Eye,{className:"h-4 w-4 mr-1"}),"Просмотр"]}),(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:g,children:[(0,t.jsx)(d.Download,{className:"h-4 w-4 mr-1"}),"Скачать"]}),(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:j,className:"text-red-600 hover:text-red-700",children:[(0,t.jsx)(m.X,{className:"h-4 w-4 mr-1"}),"Удалить"]})]})]})]})]})}function b(e){let{documents:r}=e,s=r.reduce((e,t)=>{let r=t.category.name_ru||t.category.name_en;return e[r]||(e[r]=[]),e[r].push(t),e},{});return(0,t.jsx)("div",{className:"space-y-6",children:Object.entries(s).map(e=>{let[r,s]=e;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg mb-3 flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s[0].category.color}}),r,(0,t.jsx)(y.Badge,{variant:"outline",children:s.length})]}),s.map(e=>(0,t.jsx)(w,{document:e},e.id))]},r)})})}function N(e){let{userId:n,userName:l,trigger:o}=e,[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),y=(0,a.useQueryClient)(),{data:w,isLoading:N,error:k}=(0,s.useQuery)({queryKey:["worker-documents",n],queryFn:()=>j(n),enabled:c}),C=(0,t.jsxs)(p.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(i.FileText,{className:"h-4 w-4 mr-1"}),"Документы"]});return(0,t.jsxs)(x.Dialog,{open:c,onOpenChange:d,children:[(0,t.jsx)(x.DialogTrigger,{asChild:!0,children:o||C}),(0,t.jsxs)(x.DialogContent,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsx)(x.DialogHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(x.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(i.FileText,{className:"h-5 w-5"}),"Документы работника: ",l]}),(0,t.jsx)(x.DialogDescription,{children:"Просмотр всех документов работника (страховка, разрешения, удостоверения)"})]}),(0,t.jsxs)(p.Button,{onClick:()=>m(!0),className:"flex items-center gap-2",children:[(0,t.jsx)(f.Plus,{className:"h-4 w-4"}),"Добавить документ"]})]})}),N&&(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)("div",{className:"h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent"})}),k&&(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-destructive",children:"Ошибка загрузки документов"})}),w&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(h.Card,{children:(0,t.jsxs)(h.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:w.stats.total}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Всего"})]})}),(0,t.jsx)(h.Card,{children:(0,t.jsxs)(h.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:w.stats.active}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Действительных"})]})}),(0,t.jsx)(h.Card,{children:(0,t.jsxs)(h.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:w.stats.expiring_soon}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Истекают скоро"})]})}),(0,t.jsx)(h.Card,{children:(0,t.jsxs)(h.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:w.stats.expired}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Истёкших"})]})})]}),0===w.documents.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(i.FileText,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-semibold",children:"Нет документов"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"У этого работника пока нет загруженных документов."})]}):(0,t.jsxs)(v.Tabs,{defaultValue:"all",className:"w-full",children:[(0,t.jsxs)(v.TabsList,{className:"grid w-full grid-cols-4",children:[(0,t.jsxs)(v.TabsTrigger,{value:"all",children:["Все (",w.stats.total,")"]}),(0,t.jsxs)(v.TabsTrigger,{value:"active",children:["Действительные (",w.stats.active,")"]}),(0,t.jsxs)(v.TabsTrigger,{value:"expiring",children:["Истекают (",w.stats.expiring_soon,")"]}),(0,t.jsxs)(v.TabsTrigger,{value:"expired",children:["Истёкшие (",w.stats.expired,")"]})]}),(0,t.jsx)(v.TabsContent,{value:"all",className:"mt-6",children:(0,t.jsx)(b,{documents:w.documents})}),(0,t.jsx)(v.TabsContent,{value:"active",className:"mt-6",children:(0,t.jsx)(b,{documents:w.documents.filter(e=>"active"===e.status)})}),(0,t.jsx)(v.TabsContent,{value:"expiring",className:"mt-6",children:(0,t.jsx)(b,{documents:w.documents.filter(e=>"expiring_soon"===e.status)})}),(0,t.jsx)(v.TabsContent,{value:"expired",className:"mt-6",children:(0,t.jsx)(b,{documents:w.documents.filter(e=>"expired"===e.status)})})]})]})]}),(0,t.jsx)(x.Dialog,{open:u,onOpenChange:m,children:(0,t.jsxs)(x.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(x.DialogHeader,{children:[(0,t.jsxs)(x.DialogTitle,{children:["Загрузить документ для ",l]}),(0,t.jsx)(x.DialogDescription,{children:"Загрузите новый документ (паспорт, разрешение на работу, страховка и т.д.)"})]}),(0,t.jsx)(g.DocumentUpload,{userId:n,onUploadComplete:e=>{console.log('✅ Документ "'.concat(e.file_name,'" успешно добавлен для работника: ').concat(l," (ID: ").concat(n,")")),m(!1),y.invalidateQueries({queryKey:["worker-documents",n]}),y.invalidateQueries({queryKey:["user-documents-categories",n]})}})]})})]})}}]);