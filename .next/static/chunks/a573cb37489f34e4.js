(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";e.s(["ArrowLeft",()=>r],71689);let r=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},72436,e=>{"use strict";e.s(["Separator",()=>c],72436);var r=e.i(43476),a=e.i(71645),s=e.i(48425),t="horizontal",i=["horizontal","vertical"],n=a.forwardRef((e,a)=>{var n;let{decorative:l,orientation:c=t,...d}=e,o=(n=c,i.includes(n))?c:t;return(0,r.jsx)(s.Primitive.div,{"data-orientation":o,...l?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"},...d,ref:a})});n.displayName="Separator";var l=e.i(75157);let c=a.forwardRef((e,a)=>{let{className:s,orientation:t="horizontal",decorative:i=!0,...c}=e;return(0,r.jsx)(n,{ref:a,decorative:i,orientation:t,className:(0,l.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",s),...c})});c.displayName=n.displayName},55838,(e,r,a)=>{"use strict";var s=e.r(71645),t="function"==typeof Object.is?Object.is:function(e,r){return e===r&&(0!==e||1/e==1/r)||e!=e&&r!=r},i=s.useState,n=s.useEffect,l=s.useLayoutEffect,c=s.useDebugValue;function d(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!t(e,a)}catch(e){return!0}}var o="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,r){return r()}:function(e,r){var a=r(),s=i({inst:{value:a,getSnapshot:r}}),t=s[0].inst,o=s[1];return l(function(){t.value=a,t.getSnapshot=r,d(t)&&o({inst:t})},[e,a,r]),n(function(){return d(t)&&o({inst:t}),e(function(){d(t)&&o({inst:t})})},[e]),c(a),a};a.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:o},2239,(e,r,a)=>{"use strict";r.exports=e.r(55838)},99676,e=>{"use strict";e.s(["Avatar",()=>N,"AvatarFallback",()=>b,"AvatarImage",()=>g],99676);var r=e.i(43476),a=e.i(71645),s=e.i(30030),t=e.i(30207),i=e.i(34620),n=e.i(48425),l=e.i(2239);function c(){return()=>{}}var d="Avatar",[o,u]=(0,s.createContextScope)(d),[m,x]=o(d),f=a.forwardRef((e,s)=>{let{__scopeAvatar:t,...i}=e,[l,c]=a.useState("idle");return(0,r.jsx)(m,{scope:t,imageLoadingStatus:l,onImageLoadingStatusChange:c,children:(0,r.jsx)(n.Primitive.span,{...i,ref:s})})});f.displayName=d;var h="AvatarImage",v=a.forwardRef((e,s)=>{let{__scopeAvatar:d,src:o,onLoadingStatusChange:u=()=>{},...m}=e,f=x(h,d),v=function(e,r){let{referrerPolicy:s,crossOrigin:t}=r,n=(0,l.useSyncExternalStore)(c,()=>!0,()=>!1),d=a.useRef(null),o=n?(d.current||(d.current=new window.Image),d.current):null,[u,m]=a.useState(()=>y(o,e));return(0,i.useLayoutEffect)(()=>{m(y(o,e))},[o,e]),(0,i.useLayoutEffect)(()=>{let e=e=>()=>{m(e)};if(!o)return;let r=e("loaded"),a=e("error");return o.addEventListener("load",r),o.addEventListener("error",a),s&&(o.referrerPolicy=s),"string"==typeof t&&(o.crossOrigin=t),()=>{o.removeEventListener("load",r),o.removeEventListener("error",a)}},[o,t,s]),u}(o,m),p=(0,t.useCallbackRef)(e=>{u(e),f.onImageLoadingStatusChange(e)});return(0,i.useLayoutEffect)(()=>{"idle"!==v&&p(v)},[v,p]),"loaded"===v?(0,r.jsx)(n.Primitive.img,{...m,ref:s,src:o}):null});v.displayName=h;var p="AvatarFallback",j=a.forwardRef((e,s)=>{let{__scopeAvatar:t,delayMs:i,...l}=e,c=x(p,t),[d,o]=a.useState(void 0===i);return a.useEffect(()=>{if(void 0!==i){let e=window.setTimeout(()=>o(!0),i);return()=>window.clearTimeout(e)}},[i]),d&&"loaded"!==c.imageLoadingStatus?(0,r.jsx)(n.Primitive.span,{...l,ref:s}):null});function y(e,r){return e?r?(e.src!==r&&(e.src=r),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}j.displayName=p;var w=e.i(75157);let N=a.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(f,{ref:a,className:(0,w.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t})});N.displayName=f.displayName;let g=a.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(v,{ref:a,className:(0,w.cn)("aspect-square h-full w-full",s),...t})});g.displayName=v.displayName;let b=a.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(j,{ref:a,className:(0,w.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t})});b.displayName=j.displayName},79002,e=>{"use strict";e.s(["UserPlus",()=>r],79002);let r=(0,e.i(75254).default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},8406,e=>{"use strict";e.s(["useToast",()=>a]);var r=e.i(46696);function a(){return{toast:e=>{let{title:a,description:s,variant:t="default",duration:i=5e3}=e;"destructive"===t?r.toast.error(a||"Error",{description:s,duration:i}):r.toast.success(a||"Success",{description:s,duration:i})}}}},93763,e=>{"use strict";e.s(["default",()=>b],93763);var r=e.i(43476),a=e.i(18566),s=e.i(71645),t=e.i(66027),i=e.i(54616),n=e.i(12598),l=e.i(71689),c=e.i(61911),d=e.i(79002);let o=(0,e.i(75254).default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var u=e.i(55436),m=e.i(19455),x=e.i(93479),f=e.i(15288),h=e.i(87486),v=e.i(99676),p=e.i(72436),j=e.i(8406);async function y(e){let r=await fetch("/api/crews?team_id=".concat(e));if(!r.ok)throw Error("Failed to fetch team");return((await r.json()).crews||[])[0]||null}async function w(){let e=await fetch("/api/users?page=1&per_page=100");if(!e.ok)throw Error("Failed to fetch users");return(await e.json()).items||[]}async function N(e,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"crew",s=await fetch("/api/crews/".concat(e,"/members"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:r,role_in_crew:a})});if(!s.ok)throw Error("Failed to add member to team");return s.json()}async function g(e,r){let a=await fetch("/api/crews/".concat(e,"/members/").concat(r),{method:"DELETE"});if(!a.ok)throw Error("Failed to remove member from team");return a.json()}function b(){var e,b;let k=(0,a.useRouter)(),C=(0,a.useParams)().id,{toast:S}=(0,j.useToast)(),A=(0,n.useQueryClient)(),[E,L]=(0,s.useState)(""),{data:_,isLoading:F}=(0,t.useQuery)({queryKey:["team",C],queryFn:()=>y(C),enabled:!!C}),{data:M=[],isLoading:T}=(0,t.useQuery)({queryKey:["users"],queryFn:w}),P=(0,i.useMutation)({mutationFn:e=>{let{userId:r,role:a}=e;return N(C,r,a)},onSuccess:()=>{A.invalidateQueries({queryKey:["team",C]}),A.invalidateQueries({queryKey:["teams"]}),S({title:"Member Added",description:"Member successfully added to team"})},onError:e=>{S({title:"Error",description:"Failed to add member to team",variant:"destructive"}),console.error("Add member error:",e)}}),R=(0,i.useMutation)({mutationFn:e=>g(C,e),onSuccess:()=>{A.invalidateQueries({queryKey:["team",C]}),A.invalidateQueries({queryKey:["teams"]}),S({title:"Member Removed",description:"Member removed from team"})},onError:e=>{S({title:"Error",description:"Failed to remove member from team",variant:"destructive"}),console.error("Remove member error:",e)}}),q=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"member";P.mutate({userId:e,role:r})};if(F)return(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"h-8 w-8 animate-pulse bg-muted rounded"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-8 w-48 animate-pulse bg-muted rounded"}),(0,r.jsx)("div",{className:"h-4 w-64 animate-pulse bg-muted rounded"})]})]})});if(!_)return(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(m.Button,{variant:"ghost",size:"sm",onClick:()=>k.back(),children:[(0,r.jsx)(l.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Назад"]}),(0,r.jsx)("div",{children:(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-destructive",children:"Team Not Found"})})]})});let z=_.members.map(e=>e.user_id);_.foreman&&z.push(_.foreman.id);let B=M.filter(e=>!z.includes(e.id)).filter(e=>{var r;if(!E)return!0;let a=E.toLowerCase();return e.full_name.toLowerCase().includes(a)||(null==(r=e.email)?void 0:r.toLowerCase().includes(a))||e.role.toLowerCase().includes(a)});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)(m.Button,{variant:"ghost",size:"sm",onClick:()=>k.push("/dashboard/teams"),className:"flex items-center space-x-2",children:[(0,r.jsx)(l.ArrowLeft,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Back to Teams"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold tracking-tight",children:["Team Members: ",_.name]}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Manage team members"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(f.Card,{children:[(0,r.jsxs)(f.CardHeader,{children:[(0,r.jsxs)(f.CardTitle,{className:"flex items-center space-x-2",children:[(0,r.jsx)(c.Users,{className:"h-5 w-5"}),(0,r.jsxs)("span",{children:["Current Members (",_.members.length+ +!!_.foreman,")"]})]}),(0,r.jsx)(f.CardDescription,{children:"Members of this team"})]}),(0,r.jsxs)(f.CardContent,{className:"space-y-4",children:[_.foreman&&(0,r.jsx)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/50",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(v.Avatar,{className:"h-10 w-10",children:[(0,r.jsx)(v.AvatarImage,{src:""}),(0,r.jsxs)(v.AvatarFallback,{children:[null==(e=_.foreman.first_name)?void 0:e[0],null==(b=_.foreman.last_name)?void 0:b[0]]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:_.foreman.full_name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(h.Badge,{variant:"secondary",children:"Foreman"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:_.foreman.email})]})]})]})}),_.members.length>0?_.members.map(e=>{var a,s;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(v.Avatar,{className:"h-10 w-10",children:[(0,r.jsx)(v.AvatarImage,{src:""}),(0,r.jsxs)(v.AvatarFallback,{children:[null==(a=e.first_name)?void 0:a[0],null==(s=e.last_name)?void 0:s[0]]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.full_name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(h.Badge,{variant:"outline",children:(e=>{if(!e)return"Member";switch(e){case"leader":case"foreman":return"Leader";case"member":case"worker":case"operator":return"Member";case"trainee":return"Trainee";default:return e.charAt(0).toUpperCase()+e.slice(1)}})(e.role_in_crew)}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:e.email})]})]})]}),(0,r.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{var r;return r=e.user_id,void R.mutate(r)},disabled:R.isPending,children:(0,r.jsx)(o,{className:"h-4 w-4"})})]},e.user_id)}):(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(c.Users,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,r.jsx)("p",{children:"No team members"})]})]})]}),(0,r.jsxs)(f.Card,{children:[(0,r.jsxs)(f.CardHeader,{children:[(0,r.jsxs)(f.CardTitle,{className:"flex items-center space-x-2",children:[(0,r.jsx)(d.UserPlus,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Add Members"})]}),(0,r.jsx)(f.CardDescription,{children:"Available users to add to the team"})]}),(0,r.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(u.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(x.Input,{placeholder:"Search users...",value:E,onChange:e=>L(e.target.value),className:"pl-10"})]}),(0,r.jsx)(p.Separator,{}),(0,r.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T?(0,r.jsxs)("div",{className:"text-center py-4",children:[(0,r.jsx)("div",{className:"animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full mx-auto"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Loading users..."})]}):B.length>0?B.map(e=>{var a,s;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsxs)(v.Avatar,{className:"h-8 w-8",children:[(0,r.jsx)(v.AvatarImage,{src:""}),(0,r.jsxs)(v.AvatarFallback,{children:[null==(a=e.first_name)?void 0:a[0],null==(s=e.last_name)?void 0:s[0]]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.full_name}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(h.Badge,{variant:"outline",children:(e=>{switch(e){case"admin":return"Admin";case"pm":return"Project Manager";case"foreman":return"Foreman";case"crew":case"worker":return"Worker";case"viewer":return"Viewer";default:return e.charAt(0).toUpperCase()+e.slice(1)}})(e.role)}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:e.email})]})]})]}),(0,r.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>q(e.id,"member"),disabled:P.isPending,children:(0,r.jsx)(d.UserPlus,{className:"h-4 w-4"})})]},e.id)}):(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(u.Search,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,r.jsx)("p",{children:E?"No users found":"All users are already in the team"})]})})]})]})]})]})}}]);