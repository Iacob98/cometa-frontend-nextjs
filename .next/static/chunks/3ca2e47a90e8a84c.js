(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";e.s(["ArrowLeft",()=>t],71689);let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},32661,e=>{"use strict";e.s(["useCreateProject",()=>c,"useDeleteProject",()=>u,"useProject",()=>l,"useProjectStats",()=>m,"useProjects",()=>o,"useUpdateProject",()=>d]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696),i=e.i(41931);let n={all:["projects"],lists:()=>[...n.all,"list"],list:e=>[...n.lists(),e],details:()=>[...n.all,"detail"],detail:e=>[...n.details(),e]};function o(e){return(0,t.useQuery)({queryKey:n.list(e||{}),queryFn:()=>i.projectsApi.getProjects(e),staleTime:3e5})}function l(e){return(0,t.useQuery)({queryKey:n.detail(e),queryFn:()=>i.projectsApi.getProject(e),enabled:!!e,staleTime:3e5})}function c(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.projectsApi.createProject(e),onSuccess:t=>{e.invalidateQueries({queryKey:n.lists()}),e.setQueryData(n.detail(t.id),t),a.toast.success("Project created successfully")},onError:e=>{a.toast.error("Failed to create project: ".concat(e.message))}})}function d(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return i.projectsApi.updateProject(t,r)},onMutate:async t=>{let{id:r,data:s}=t;await e.cancelQueries({queryKey:n.detail(r)});let a=e.getQueryData(n.detail(r));return e.setQueryData(n.detail(r),e=>e?{...e,...s}:e),{previousProject:a}},onError:(t,r,s)=>{let{id:i}=r;(null==s?void 0:s.previousProject)&&e.setQueryData(n.detail(i),s.previousProject),a.toast.error("Failed to update project: ".concat(t.message))},onSuccess:t=>{e.invalidateQueries({queryKey:n.lists()}),a.toast.success("Project updated successfully")},onSettled:(t,r,s)=>{let{id:a}=s;e.invalidateQueries({queryKey:n.detail(a)})}})}function u(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i.projectsApi.deleteProject(e),onSuccess:(t,r)=>{e.removeQueries({queryKey:n.detail(r)}),e.invalidateQueries({queryKey:n.lists()}),a.toast.success("Project deleted successfully")},onError:e=>{a.toast.error("Failed to delete project: ".concat(e.message))}})}function m(e){return(0,t.useQuery)({queryKey:[...n.detail(e),"stats"],queryFn:async()=>{let t=await fetch("/api/projects/".concat(e,"/stats"));if(!t.ok)throw Error("Failed to fetch project statistics");return t.json()},staleTime:12e4,enabled:!!e})}},24687,e=>{"use strict";e.s(["Textarea",()=>a]);var t=e.i(43476),r=e.i(71645),s=e.i(75157);let a=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:r,...i})});a.displayName="Textarea"},57428,e=>{"use strict";e.s(["Checkbox",()=>k],57428);var t=e.i(43476),r=e.i(71645),s=e.i(20783),a=e.i(30030),i=e.i(81140),n=e.i(69340),o=e.i(99682),l=e.i(35804),c=e.i(96626),d=e.i(48425),u="Checkbox",[m,p]=(0,a.createContextScope)(u),[h,f]=m(u);function y(e){let{__scopeCheckbox:s,checked:a,children:i,defaultChecked:o,disabled:l,form:c,name:d,onCheckedChange:m,required:p,value:f="on",internal_do_not_use_render:y}=e,[j,x]=(0,n.useControllableState)({prop:a,defaultProp:null!=o&&o,onChange:m,caller:u}),[g,b]=r.useState(null),[v,F]=r.useState(null),w=r.useRef(!1),_=!g||!!c||!!g.closest("form"),N={checked:j,disabled:l,setChecked:x,control:g,setControl:b,name:d,form:c,value:f,hasConsumerStoppedPropagationRef:w,required:p,defaultChecked:!C(o)&&o,isFormControl:_,bubbleInput:v,setBubbleInput:F};return(0,t.jsx)(h,{scope:s,...N,children:"function"==typeof y?y(N):i})}var j="CheckboxTrigger",x=r.forwardRef((e,a)=>{let{__scopeCheckbox:n,onKeyDown:o,onClick:l,...c}=e,{control:u,value:m,disabled:p,checked:h,required:y,setControl:x,setChecked:g,hasConsumerStoppedPropagationRef:b,isFormControl:v,bubbleInput:F}=f(j,n),w=(0,s.useComposedRefs)(a,x),N=r.useRef(h);return r.useEffect(()=>{let e=null==u?void 0:u.form;if(e){let t=()=>g(N.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[u,g]),(0,t.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":C(h)?"mixed":h,"aria-required":y,"data-state":_(h),"data-disabled":p?"":void 0,disabled:p,value:m,...c,ref:w,onKeyDown:(0,i.composeEventHandlers)(o,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.composeEventHandlers)(l,e=>{g(e=>!!C(e)||!e),F&&v&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});x.displayName=j;var g=r.forwardRef((e,r)=>{let{__scopeCheckbox:s,name:a,checked:i,defaultChecked:n,required:o,disabled:l,value:c,onCheckedChange:d,form:u,...m}=e;return(0,t.jsx)(y,{__scopeCheckbox:s,checked:i,defaultChecked:n,disabled:l,required:o,onCheckedChange:d,name:a,form:u,value:c,internal_do_not_use_render:e=>{let{isFormControl:a}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x,{...m,ref:r,__scopeCheckbox:s}),a&&(0,t.jsx)(w,{__scopeCheckbox:s})]})}})});g.displayName=u;var b="CheckboxIndicator",v=r.forwardRef((e,r)=>{let{__scopeCheckbox:s,forceMount:a,...i}=e,n=f(b,s);return(0,t.jsx)(c.Presence,{present:a||C(n.checked)||!0===n.checked,children:(0,t.jsx)(d.Primitive.span,{"data-state":_(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:r,style:{pointerEvents:"none",...e.style}})})});v.displayName=b;var F="CheckboxBubbleInput",w=r.forwardRef((e,a)=>{let{__scopeCheckbox:i,...n}=e,{control:c,hasConsumerStoppedPropagationRef:u,checked:m,defaultChecked:p,required:h,disabled:y,name:j,value:x,form:g,bubbleInput:b,setBubbleInput:v}=f(F,i),w=(0,s.useComposedRefs)(a,v),_=(0,o.usePrevious)(m),N=(0,l.useSize)(c);r.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!u.current;if(_!==m&&e){let r=new Event("click",{bubbles:t});b.indeterminate=C(m),e.call(b,!C(m)&&m),b.dispatchEvent(r)}},[b,_,m,u]);let S=r.useRef(!C(m)&&m);return(0,t.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=p?p:S.current,required:h,disabled:y,name:j,value:x,form:g,...n,tabIndex:-1,ref:w,style:{...n.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function _(e){return C(e)?"indeterminate":e?"checked":"unchecked"}w.displayName=F;var N=e.i(43531),S=e.i(75157);let k=r.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(g,{ref:r,className:(0,S.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,t.jsx)(v,{className:(0,S.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(N.Check,{className:"h-4 w-4"})})})});k.displayName=g.displayName},84774,e=>{"use strict";e.s(["Table",()=>a,"TableBody",()=>n,"TableCell",()=>c,"TableHead",()=>l,"TableHeader",()=>i,"TableRow",()=>o]);var t=e.i(43476),r=e.i(71645),s=e.i(75157);let a=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:r,className:(0,s.cn)("w-full caption-bottom text-sm",a),...i})})});a.displayName="Table";let i=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("thead",{ref:r,className:(0,s.cn)("[&_tr]:border-b",a),...i})});i.displayName="TableHeader";let n=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tbody",{ref:r,className:(0,s.cn)("[&_tr:last-child]:border-0",a),...i})});n.displayName="TableBody",r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tfoot",{ref:r,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...i})}).displayName="TableFooter";let o=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("tr",{ref:r,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...i})});o.displayName="TableRow";let l=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("th",{ref:r,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...i})});l.displayName="TableHead";let c=r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("td",{ref:r,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...i})});c.displayName="TableCell",r.forwardRef((e,r)=>{let{className:a,...i}=e;return(0,t.jsx)("caption",{ref:r,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",a),...i})}).displayName="TableCaption"},27612,e=>{"use strict";e.s(["Trash2",()=>t],27612);let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},7233,e=>{"use strict";e.s(["Plus",()=>t],7233);let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},64483,49933,e=>{"use strict";e.s(["useCreateMaterialOrderWithBudget",()=>f,"useDeleteMaterialOrder",()=>j,"useMaterialOrder",()=>h,"useMaterialOrders",()=>p,"useUpdateMaterialOrder",()=>y],64483);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696);function i(e){return(0,t.useQuery)({queryKey:["material-order-budget",e],queryFn:async()=>{let t=await fetch("/api/materials/orders/".concat(e,"/budget"));if(!t.ok)throw Error("Failed to fetch budget impact");return t.json()},enabled:!!e})}function n(){let e=function(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:async e=>{let{orderId:t,data:r}=e,s=await fetch("/api/materials/orders/".concat(t,"/budget"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error((await s.json()).error||"Failed to create budget transaction");return s.json()},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["material-order-budget",r.orderId]}),e.invalidateQueries({queryKey:["material-orders"]}),e.invalidateQueries({queryKey:["financial-summary"]}),e.invalidateQueries({queryKey:["project",t.project_id]}),a.toast.success("Budget transaction created: €".concat(t.amount_deducted.toFixed(2)," deducted"))},onError:e=>{a.toast.error(e.message||"Failed to create budget transaction")}})}();return{deductFromBudget:async function(t){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!r)return null;try{return await e.mutateAsync({orderId:t,data:{deduct_from_budget:!0}})}catch(e){return console.error("Auto budget deduction failed:",e),null}},isLoading:e.isPending,error:e.error}}e.s(["useAutoBudgetDeduction",()=>n,"useMaterialOrderBudgetImpact",()=>i],49933);let o={all:["material-orders"],lists:()=>[...o.all,"list"],list:e=>[...o.lists(),e],details:()=>[...o.all,"detail"],detail:e=>[...o.details(),e]};async function l(e){let t=new URLSearchParams;(null==e?void 0:e.project_id)&&t.set("project_id",e.project_id),(null==e?void 0:e.supplier_id)&&t.set("supplier_id",e.supplier_id),(null==e?void 0:e.status)&&t.set("status",e.status),(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.per_page)&&t.set("per_page",e.per_page.toString());let r=await fetch("/api/materials/orders?".concat(t.toString()));if(!r.ok)throw Error("Failed to fetch material orders");return r.json()}async function c(e){let t=await fetch("/api/materials/orders/".concat(e));if(!t.ok)throw Error("Failed to fetch material order");return t.json()}async function d(e){let t=await fetch("/api/materials/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create material order");return t.json()}async function u(e,t){let r=await fetch("/api/materials/orders/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json()).error||"Failed to update material order");return r.json()}async function m(e){let t=await fetch("/api/materials/orders/".concat(e),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete material order")}function p(e){return(0,t.useQuery)({queryKey:o.list(e||{}),queryFn:()=>l(e),staleTime:3e5})}function h(e){return(0,t.useQuery)({queryKey:o.detail(e),queryFn:()=>c(e),enabled:!!e,staleTime:3e5})}function f(){let e=function(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:d,onSuccess:t=>{e.invalidateQueries({queryKey:o.lists()}),e.setQueryData(o.detail(t.id),t),a.toast.success("Material order created successfully")},onError:e=>{a.toast.error("Failed to create order: ".concat(e.message))}})}(),{deductFromBudget:t}=n();return(0,r.useMutation)({mutationFn:async r=>{let{deduct_from_budget:s=!0,...i}=r,n=await e.mutateAsync(i);if(s&&n.project_id)try{await t(n.id,!0)}catch(e){console.warn("Budget deduction failed, but order was created:",e),a.toast.warning("Order created but budget deduction failed. Please manage manually.")}return n},onSuccess:e=>{a.toast.success("Order created and €".concat(e.total_cost_eur.toFixed(2)," deducted from project budget"))},onError:e=>{a.toast.error("Failed to create order: ".concat(e.message))}})}function y(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>{let{id:t,data:r}=e;return u(t,r)},onSuccess:t=>{e.setQueryData(o.detail(t.id),t),e.invalidateQueries({queryKey:o.lists()}),a.toast.success("Order updated successfully")},onError:e=>{a.toast.error("Failed to update order: ".concat(e.message))}})}function j(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:m,onSuccess:(t,r)=>{e.removeQueries({queryKey:o.detail(r)}),e.invalidateQueries({queryKey:o.lists()}),a.toast.success("Order deleted successfully")},onError:e=>{a.toast.error("Failed to delete order: ".concat(e.message))}})}},927,e=>{"use strict";e.s(["useCreateSupplier",()=>b,"useCreateSupplierContact",()=>C,"useCreateSupplierMaterial",()=>S,"useCreateSupplierProjectAssignment",()=>T,"useDeleteSupplier",()=>F,"useDeleteSupplierContact",()=>_,"useSupplier",()=>g,"useSupplierContacts",()=>w,"useSupplierMaterials",()=>N,"useSupplierProjects",()=>k,"useSuppliers",()=>x,"useUpdateSupplier",()=>v]);var t=e.i(66027),r=e.i(54616),s=e.i(12598),a=e.i(46696);let i={all:["suppliers"],lists:()=>[...i.all,"list"],list:e=>[...i.lists(),{filters:e}],details:()=>[...i.all,"detail"],detail:e=>[...i.details(),e]};async function n(){let e=await fetch("/api/suppliers");if(!e.ok)throw Error("Failed to fetch suppliers");return((await e.json()).items||[]).map(e=>({...e,org_name:e.name}))}async function o(e){let t=await fetch("/api/suppliers/".concat(e));if(!t.ok)throw Error("Failed to fetch supplier");return t.json()}async function l(e){let t={...e,name:e.org_name,org_name:void 0},r=await fetch("/api/suppliers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Failed to create supplier");let s=await r.json();return{...s,org_name:s.name}}async function c(e){let{id:t,...r}=e,s=await fetch("/api/suppliers/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw Error("Failed to update supplier");return s.json()}async function d(e){if(!(await fetch("/api/suppliers/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete supplier")}async function u(e){let t=await fetch("/api/suppliers/".concat(e,"/contacts"));if(!t.ok)throw Error("Failed to fetch supplier contacts");return t.json()}async function m(e,t){let r=await fetch("/api/suppliers/".concat(e,"/contacts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Failed to create supplier contact");return r.json()}async function p(e,t){if(!(await fetch("/api/suppliers/".concat(e,"/contacts/").concat(t),{method:"DELETE"})).ok)throw Error("Failed to delete supplier contact")}async function h(e,t){let r=new URL("/api/suppliers/".concat(e,"/materials"),window.location.origin);t&&r.searchParams.set("project_id",t);let s=await fetch(r.toString());if(!s.ok)throw Error("Failed to fetch supplier materials");return s.json()}async function f(e,t){let r=await fetch("/api/suppliers/".concat(e,"/materials"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Unknown error"}))).error||"Failed to create supplier material (".concat(r.status,")"));return r.json()}async function y(e){let t=await fetch("/api/suppliers/".concat(e,"/projects"));if(!t.ok)throw Error("Failed to fetch supplier projects");return t.json()}async function j(e,t){let r=await fetch("/api/suppliers/".concat(e,"/projects"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Failed to assign supplier to project");return r.json()}function x(){return(0,t.useQuery)({queryKey:i.lists(),queryFn:n,staleTime:3e5})}function g(e){return(0,t.useQuery)({queryKey:i.detail(e),queryFn:()=>o(e),enabled:!!e,staleTime:3e5})}function b(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:l,onSuccess:t=>{e.setQueryData(i.lists(),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...e,t]}),e.invalidateQueries({queryKey:i.all}),a.toast.success("Supplier created successfully")},onError:e=>{a.toast.error("Failed to create supplier: ".concat(e.message))}})}function v(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:c,onSuccess:t=>{e.setQueryData(i.lists(),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(e=>e.id===t.id?t:e)}),e.setQueryData(i.detail(t.id),t),e.invalidateQueries({queryKey:i.all}),a.toast.success("Supplier updated successfully")},onError:e=>{a.toast.error("Failed to update supplier: ".concat(e.message))}})}function F(){let e=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:d,onSuccess:(t,r)=>{e.setQueryData(i.lists(),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(e=>e.id!==r)}),e.removeQueries({queryKey:i.detail(r)}),e.invalidateQueries({queryKey:i.all}),a.toast.success("Supplier deleted successfully")},onError:e=>{a.toast.error("Failed to delete supplier: ".concat(e.message))}})}function w(e){return(0,t.useQuery)({queryKey:[...i.detail(e),"contacts"],queryFn:()=>u(e),enabled:!!e,staleTime:3e5})}function C(e){let t=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>m(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:[...i.detail(e),"contacts"]}),a.toast.success("Contact created successfully")},onError:e=>{a.toast.error("Failed to create contact: ".concat(e.message))}})}function _(e){let t=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>p(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:[...i.detail(e),"contacts"]}),a.toast.success("Contact deleted successfully")},onError:e=>{a.toast.error("Failed to delete contact: ".concat(e.message))}})}function N(e,r){return(0,t.useQuery)({queryKey:[...i.detail(e),"materials",{projectId:r}],queryFn:()=>h(e,r),enabled:!!e,staleTime:3e5})}function S(e){let t=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>f(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:[...i.detail(e),"materials"]}),a.toast.success("Material created successfully")},onError:e=>{a.toast.error("Failed to create material: ".concat(e.message))}})}function k(e){return(0,t.useQuery)({queryKey:[...i.detail(e),"projects"],queryFn:()=>y(e),enabled:!!e,staleTime:3e5})}function T(e){let t=(0,s.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>j(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:[...i.detail(e),"projects"]}),a.toast.success("Supplier assigned to project successfully")},onError:e=>{a.toast.error("Failed to assign supplier to project: ".concat(e.message))}})}},1928,e=>{"use strict";e.s(["ShoppingCart",()=>t],1928);let t=(0,e.i(75254).default)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},20449,e=>{"use strict";e.s(["default",()=>C]);var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(53145),i=e.i(94814),n=e.i(81307),o=e.i(71689),l=e.i(7233),c=e.i(27612),d=e.i(88844),u=e.i(1928),m=e.i(19455),p=e.i(93479),h=e.i(24687),f=e.i(15288),y=e.i(3133),j=e.i(57428),x=e.i(67489),g=e.i(84774),b=e.i(64483),v=e.i(32661),F=e.i(927);let w=n.z.object({project_id:n.z.string().min(1,"Project is required"),supplier_id:n.z.string().min(1,"Supplier is required"),expected_delivery_date:n.z.string().optional(),notes:n.z.string().optional(),deduct_from_budget:n.z.boolean().default(!0),items:n.z.array(n.z.object({material_id:n.z.string().min(1,"Material is required"),quantity:n.z.coerce.number().positive("Quantity must be positive"),unit_cost:n.z.coerce.number().positive("Unit cost must be positive").optional()})).min(1,"At least one item is required")});function C(){let e=(0,s.useRouter)(),n=(0,s.useSearchParams)().get("project_id")||"",[C,_]=(0,r.useState)(""),N=(0,b.useCreateMaterialOrderWithBudget)(),{data:S}=(0,v.useProjects)(),{data:k=[]}=(0,F.useSuppliers)(),{data:T=[]}=(0,F.useSupplierMaterials)(C),q=(null==S?void 0:S.items)||[],E=(0,a.useForm)({resolver:(0,i.zodResolver)(w),defaultValues:{project_id:n,supplier_id:"",expected_delivery_date:"",notes:"",deduct_from_budget:!0,items:[{material_id:"",quantity:1,unit_cost:0}]}}),{fields:Q,append:P,remove:M}=(0,a.useFieldArray)({control:E.control,name:"items"}),O=E.watch("supplier_id");O!==C&&(_(O),C&&O!==C&&E.setValue("items",[{material_id:"",quantity:1,unit_cost:0}]));let K=async t=>{try{for(let e of t.items){let r={project_id:t.project_id,supplier_material_id:e.material_id,quantity:e.quantity,unit_price_eur:e.unit_cost||void 0,expected_delivery_date:t.expected_delivery_date||void 0,notes:t.notes||void 0,deduct_from_budget:t.deduct_from_budget};await N.mutateAsync(r)}e.push("/dashboard/materials")}catch(e){console.error("Failed to create order:",e)}},R=q.find(e=>e.id===E.watch("project_id")),D=k.find(e=>e.id===C);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(m.Button,{variant:"ghost",size:"sm",onClick:()=>e.back(),className:"flex items-center space-x-2",children:[(0,t.jsx)(o.ArrowLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Back"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Materials"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Create a material order for your project"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(f.Card,{children:[(0,t.jsxs)(f.CardHeader,{children:[(0,t.jsxs)(f.CardTitle,{className:"flex items-center space-x-2",children:[(0,t.jsx)(u.ShoppingCart,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Order Details"})]}),(0,t.jsx)(f.CardDescription,{children:"Select project, supplier, and materials to order"})]}),(0,t.jsx)(f.CardContent,{children:(0,t.jsx)(y.Form,{...E,children:(0,t.jsxs)("form",{onSubmit:E.handleSubmit(K),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(y.FormField,{control:E.control,name:"project_id",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Project *"}),(0,t.jsxs)(x.Select,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(x.SelectTrigger,{children:(0,t.jsx)(x.SelectValue,{placeholder:"Select project"})})}),(0,t.jsx)(x.SelectContent,{children:q.map(e=>(0,t.jsx)(x.SelectItem,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:E.control,name:"supplier_id",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Supplier *"}),(0,t.jsxs)(x.Select,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(x.SelectTrigger,{children:(0,t.jsx)(x.SelectValue,{placeholder:"Select supplier"})})}),(0,t.jsx)(x.SelectContent,{children:k.map(e=>(0,t.jsx)(x.SelectItem,{value:e.id,children:e.org_name},e.id))})]}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:E.control,name:"expected_delivery_date",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Expected Delivery Date"}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(p.Input,{type:"date",...r})}),(0,t.jsx)(y.FormMessage,{})]})}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Materials"}),(0,t.jsxs)(m.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{P({material_id:"",quantity:1,unit_cost:0})},disabled:!C,children:[(0,t.jsx)(l.Plus,{className:"mr-2 h-4 w-4"}),"Add Item"]})]}),!C&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Please select a supplier to add materials"}),C&&0===T.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No materials available from this supplier"}),C&&T.length>0&&(0,t.jsx)("div",{className:"border rounded-lg",children:(0,t.jsxs)(g.Table,{children:[(0,t.jsx)(g.TableHeader,{children:(0,t.jsxs)(g.TableRow,{children:[(0,t.jsx)(g.TableHead,{children:"Material"}),(0,t.jsx)(g.TableHead,{children:"Quantity"}),(0,t.jsx)(g.TableHead,{children:"Unit Cost (€)"}),(0,t.jsx)(g.TableHead,{children:"Total (€)"}),(0,t.jsx)(g.TableHead,{className:"w-[50px]"})]})}),(0,t.jsx)(g.TableBody,{children:Q.map((e,r)=>{let s=T.find(e=>e.id===E.watch("items.".concat(r,".material_id"))),a=E.watch("items.".concat(r,".quantity"))||0,i=E.watch("items.".concat(r,".unit_cost"))||(null==s?void 0:s.unit_price_eur)||0;return(0,t.jsxs)(g.TableRow,{children:[(0,t.jsxs)(g.TableCell,{children:[(0,t.jsx)(y.FormField,{control:E.control,name:"items.".concat(r,".material_id"),render:e=>{let{field:s}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsxs)(x.Select,{onValueChange:e=>{s.onChange(e);let t=T.find(t=>t.id===e);t&&E.setValue("items.".concat(r,".unit_cost"),t.unit_price_eur)},value:s.value,children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(x.SelectTrigger,{children:(0,t.jsx)(x.SelectValue,{placeholder:"Select material"})})}),(0,t.jsx)(x.SelectContent,{children:T.map(e=>(0,t.jsx)(x.SelectItem,{value:e.id,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.material_type}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["€",e.unit_price_eur,"/",e.unit]})]})},e.id))})]}),(0,t.jsx)(y.FormMessage,{})]})}}),s&&(0,t.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["Unit: ",s.unit,s.min_order_quantity>1&&(0,t.jsxs)("span",{className:"ml-1",children:["(Min: ",s.min_order_quantity,")"]})]})]}),(0,t.jsx)(g.TableCell,{children:(0,t.jsx)(y.FormField,{control:E.control,name:"items.".concat(r,".quantity"),render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(p.Input,{type:"number",step:"0.001",min:(null==s?void 0:s.min_order_quantity)||1,...r})}),(0,t.jsx)(y.FormMessage,{})]})}})}),(0,t.jsx)(g.TableCell,{children:(0,t.jsx)(y.FormField,{control:E.control,name:"items.".concat(r,".unit_cost"),render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(p.Input,{type:"number",step:"0.01",min:"0",...r})}),(0,t.jsx)(y.FormMessage,{})]})}})}),(0,t.jsx)(g.TableCell,{children:(0,t.jsxs)("span",{className:"font-medium",children:["€",(a*i).toFixed(2)]})}),(0,t.jsx)(g.TableCell,{children:Q.length>1&&(0,t.jsx)(m.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>M(r),children:(0,t.jsx)(c.Trash2,{className:"h-4 w-4"})})})]},e.id)})})]})})]}),(0,t.jsx)(y.FormField,{control:E.control,name:"notes",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{children:[(0,t.jsx)(y.FormLabel,{children:"Notes"}),(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(h.Textarea,{placeholder:"Additional notes for this order...",rows:3,...r})}),(0,t.jsx)(y.FormMessage,{})]})}}),(0,t.jsx)(y.FormField,{control:E.control,name:"deduct_from_budget",render:e=>{let{field:r}=e;return(0,t.jsxs)(y.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,t.jsx)(y.FormControl,{children:(0,t.jsx)(j.Checkbox,{checked:r.value,onCheckedChange:r.onChange})}),(0,t.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,t.jsx)(y.FormLabel,{children:"Automatically deduct from project budget"}),(0,t.jsx)(y.FormDescription,{children:"When enabled, the order cost will be automatically deducted from the project's budget as an expense transaction. You can manage this manually later if disabled."})]})]})}}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(m.Button,{type:"button",variant:"outline",onClick:()=>e.back(),children:"Cancel"}),(0,t.jsxs)(m.Button,{type:"submit",disabled:N.isPending,children:[N.isPending?(0,t.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-background border-t-transparent mr-2"}):(0,t.jsx)(d.Package,{className:"mr-2 h-4 w-4"}),"Create Order"]})]})]})})})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(f.Card,{children:[(0,t.jsx)(f.CardHeader,{children:(0,t.jsx)(f.CardTitle,{children:"Order Summary"})}),(0,t.jsxs)(f.CardContent,{className:"space-y-4",children:[R&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:"Project"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:R.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:R.customer})]}),D&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-sm",children:"Supplier"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:D.org_name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:D.contact_person})]}),(0,t.jsxs)("div",{className:"pt-2 border-t",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:"Total Cost"}),(0,t.jsxs)("span",{className:"text-lg font-bold",children:["€",E.getValues("items").reduce((e,t)=>e+t.quantity*(t.unit_cost||0),0).toFixed(2)]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Excludes delivery costs"})]})]})]}),(0,t.jsxs)(f.Card,{children:[(0,t.jsx)(f.CardHeader,{children:(0,t.jsx)(f.CardTitle,{children:"Order Information"})}),(0,t.jsxs)(f.CardContent,{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:"Order Process"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:'Orders are created with "pending" status and can be tracked through delivery'})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:"Costs"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Order costs will be deducted from the project budget automatically"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium",children:"Delivery"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Check with supplier for delivery costs and minimum order requirements"})]})]})]})]})]})]})}}]);