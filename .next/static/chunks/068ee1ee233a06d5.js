(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71689,e=>{"use strict";e.s(["ArrowLeft",()=>t],71689);let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},56909,e=>{"use strict";e.s(["Save",()=>t],56909);let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},77126,e=>{"use strict";e.s(["useCrewEquipmentAssignments",()=>m,"useDeleteAssignment",()=>c,"useEquipment",()=>i,"useEquipmentAnalytics",()=>d,"useEquipmentAssignments",()=>l,"useUpdateAssignment",()=>o]);var t=e.i(54616),s=e.i(66027),n=e.i(12598),a=e.i(46696);let r={getEquipment:async e=>{let t=new URLSearchParams;(null==e?void 0:e.type)&&t.append("type",e.type),(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.owned)&&t.append("owned",e.owned),(null==e?void 0:e.search)&&t.append("search",e.search),(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.per_page)&&t.append("per_page",e.per_page.toString());let s="/api/equipment".concat(t.toString()?"?".concat(t.toString()):""),n=await fetch(s);if(!n.ok)throw Error("Failed to fetch equipment");return n.json()},getAssignments:async e=>{let t=new URLSearchParams;(null==e?void 0:e.equipment_id)&&t.append("equipment_id",e.equipment_id),(null==e?void 0:e.project_id)&&t.append("project_id",e.project_id),(null==e?void 0:e.crew_id)&&t.append("crew_id",e.crew_id),(null==e?void 0:e.active_only)&&t.append("active_only",e.active_only.toString());let s="/api/resources/unified-assignments".concat(t.toString()?"?".concat(t.toString()):""),n=await fetch(s);if(!n.ok)throw Error("Failed to fetch unified assignments");return n.json()},updateAssignment:async(e,t)=>{let s=await fetch("/api/resources/equipment-assignments/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error((await s.json()).error||"Failed to update assignment");return s.json()},deleteAssignment:async e=>{let t=await fetch("/api/resources/equipment-assignments/".concat(e),{method:"DELETE"});if(!t.ok)throw Error((await t.json()).error||"Failed to delete assignment");return t.json()},getAnalytics:async()=>{let e=await fetch("/api/equipment/analytics");if(!e.ok)throw Error("Failed to fetch equipment analytics");return e.json()}};function i(e){return(0,s.useQuery)({queryKey:["equipment",e],queryFn:()=>r.getEquipment(e)})}function l(e){return(0,s.useQuery)({queryKey:["equipment-assignments",e],queryFn:()=>r.getAssignments(e),staleTime:3e4})}function o(){let e=(0,n.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>{let{id:t,data:s}=e;return r.updateAssignment(t,s)},onSuccess:t=>{e.invalidateQueries({queryKey:["equipment-assignments"]}),e.invalidateQueries({queryKey:["equipment"]}),a.toast.success(t.message||"Assignment updated successfully")},onError:e=>{a.toast.error(e.message)}})}function c(){let e=(0,n.useQueryClient)();return(0,t.useMutation)({mutationFn:r.deleteAssignment,onSuccess:t=>{e.invalidateQueries({queryKey:["equipment-assignments"]}),e.invalidateQueries({queryKey:["equipment"]}),a.toast.success(t.message||"Assignment deleted successfully")},onError:e=>{a.toast.error(e.message)}})}function d(){return(0,s.useQuery)({queryKey:["equipment-analytics"],queryFn:()=>r.getAnalytics(),staleTime:3e5})}function m(e){return(0,s.useQuery)({queryKey:["equipment-assignments","crew",e],queryFn:async()=>{let t=await fetch("/api/resources/equipment-assignments?crew_id=".concat(e,"&active_only=true"));if(!t.ok)throw Error("Failed to fetch equipment assignments");return t.json()},enabled:!!e,staleTime:3e4})}},95116,e=>{"use strict";e.s(["Wrench",()=>t],95116);let t=(0,e.i(75254).default)("wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]])},57428,e=>{"use strict";e.s(["Checkbox",()=>F],57428);var t=e.i(43476),s=e.i(71645),n=e.i(20783),a=e.i(30030),r=e.i(81140),i=e.i(69340),l=e.i(99682),o=e.i(35804),c=e.i(96626),d=e.i(48425),m="Checkbox",[u,p]=(0,a.createContextScope)(m),[h,x]=u(m);function f(e){let{__scopeCheckbox:n,checked:a,children:r,defaultChecked:l,disabled:o,form:c,name:d,onCheckedChange:u,required:p,value:x="on",internal_do_not_use_render:f}=e,[g,y]=(0,i.useControllableState)({prop:a,defaultProp:null!=l&&l,onChange:u,caller:m}),[j,v]=s.useState(null),[b,w]=s.useState(null),N=s.useRef(!1),k=!j||!!c||!!j.closest("form"),q={checked:g,disabled:o,setChecked:y,control:j,setControl:v,name:d,form:c,value:x,hasConsumerStoppedPropagationRef:N,required:p,defaultChecked:!_(l)&&l,isFormControl:k,bubbleInput:b,setBubbleInput:w};return(0,t.jsx)(h,{scope:n,...q,children:"function"==typeof f?f(q):r})}var g="CheckboxTrigger",y=s.forwardRef((e,a)=>{let{__scopeCheckbox:i,onKeyDown:l,onClick:o,...c}=e,{control:m,value:u,disabled:p,checked:h,required:f,setControl:y,setChecked:j,hasConsumerStoppedPropagationRef:v,isFormControl:b,bubbleInput:w}=x(g,i),N=(0,n.useComposedRefs)(a,y),q=s.useRef(h);return s.useEffect(()=>{let e=null==m?void 0:m.form;if(e){let t=()=>j(q.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[m,j]),(0,t.jsx)(d.Primitive.button,{type:"button",role:"checkbox","aria-checked":_(h)?"mixed":h,"aria-required":f,"data-state":k(h),"data-disabled":p?"":void 0,disabled:p,value:u,...c,ref:N,onKeyDown:(0,r.composeEventHandlers)(l,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,r.composeEventHandlers)(o,e=>{j(e=>!!_(e)||!e),w&&b&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})})});y.displayName=g;var j=s.forwardRef((e,s)=>{let{__scopeCheckbox:n,name:a,checked:r,defaultChecked:i,required:l,disabled:o,value:c,onCheckedChange:d,form:m,...u}=e;return(0,t.jsx)(f,{__scopeCheckbox:n,checked:r,defaultChecked:i,disabled:o,required:l,onCheckedChange:d,name:a,form:m,value:c,internal_do_not_use_render:e=>{let{isFormControl:a}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y,{...u,ref:s,__scopeCheckbox:n}),a&&(0,t.jsx)(N,{__scopeCheckbox:n})]})}})});j.displayName=m;var v="CheckboxIndicator",b=s.forwardRef((e,s)=>{let{__scopeCheckbox:n,forceMount:a,...r}=e,i=x(v,n);return(0,t.jsx)(c.Presence,{present:a||_(i.checked)||!0===i.checked,children:(0,t.jsx)(d.Primitive.span,{"data-state":k(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:s,style:{pointerEvents:"none",...e.style}})})});b.displayName=v;var w="CheckboxBubbleInput",N=s.forwardRef((e,a)=>{let{__scopeCheckbox:r,...i}=e,{control:c,hasConsumerStoppedPropagationRef:m,checked:u,defaultChecked:p,required:h,disabled:f,name:g,value:y,form:j,bubbleInput:v,setBubbleInput:b}=x(w,r),N=(0,n.useComposedRefs)(a,b),k=(0,l.usePrevious)(u),q=(0,o.useSize)(c);s.useEffect(()=>{if(!v)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!m.current;if(k!==u&&e){let s=new Event("click",{bubbles:t});v.indeterminate=_(u),e.call(v,!_(u)&&u),v.dispatchEvent(s)}},[v,k,u,m]);let C=s.useRef(!_(u)&&u);return(0,t.jsx)(d.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=p?p:C.current,required:h,disabled:f,name:g,value:y,form:j,...i,tabIndex:-1,ref:N,style:{...i.style,...q,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function _(e){return"indeterminate"===e}function k(e){return _(e)?"indeterminate":e?"checked":"unchecked"}N.displayName=w;var q=e.i(43531),C=e.i(75157);let F=s.forwardRef((e,s)=>{let{className:n,...a}=e;return(0,t.jsx)(j,{ref:s,className:(0,C.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...a,children:(0,t.jsx)(b,{className:(0,C.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(q.Check,{className:"h-4 w-4"})})})});F.displayName=j.displayName},31278,e=>{"use strict";e.s(["Loader2",()=>t],31278);let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},72436,e=>{"use strict";e.s(["Separator",()=>o],72436);var t=e.i(43476),s=e.i(71645),n=e.i(48425),a="horizontal",r=["horizontal","vertical"],i=s.forwardRef((e,s)=>{var i;let{decorative:l,orientation:o=a,...c}=e,d=(i=o,r.includes(i))?o:a;return(0,t.jsx)(n.Primitive.div,{"data-orientation":d,...l?{role:"none"}:{"aria-orientation":"vertical"===d?d:void 0,role:"separator"},...c,ref:s})});i.displayName="Separator";var l=e.i(75157);let o=s.forwardRef((e,s)=>{let{className:n,orientation:a="horizontal",decorative:r=!0,...o}=e;return(0,t.jsx)(i,{ref:s,decorative:r,orientation:a,className:(0,l.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",n),...o})});o.displayName=i.displayName},72714,e=>{"use strict";e.s(["default",()=>_]);var t=e.i(43476),s=e.i(94814),n=e.i(53145),a=e.i(81307),r=e.i(71645),i=e.i(18566),l=e.i(71689),o=e.i(56909),c=e.i(31278),d=e.i(87316),m=e.i(61911),u=e.i(95116),p=e.i(7486),h=e.i(46696),x=e.i(19455),f=e.i(3133),g=e.i(93479),y=e.i(15288),j=e.i(72436),v=e.i(57428),b=e.i(87486),w=e.i(77126);let N=a.z.object({to_ts:a.z.string().optional(),is_permanent:a.z.boolean().default(!1),rental_cost_per_day:a.z.string().optional().transform(e=>e?parseFloat(e):void 0)});function _(){let e=(0,i.useRouter)(),a=(0,i.useParams)().id,[_,k]=(0,r.useState)(!1),[q,C]=(0,r.useState)(!0),[F,E]=(0,r.useState)(null),S=(0,w.useUpdateAssignment)(),A=(0,n.useForm)({resolver:(0,s.zodResolver)(N),defaultValues:{to_ts:"",is_permanent:!1}});async function R(t){if(F){k(!0);try{let s={to_ts:t.to_ts||void 0,is_permanent:t.is_permanent,rental_cost_per_day:t.rental_cost_per_day};await S.mutateAsync({id:a,data:s}),h.toast.success("Assignment updated successfully!"),e.push("/dashboard/equipment")}catch(e){console.error("Assignment update error:",e),h.toast.error(e instanceof Error?e.message:"Failed to update assignment")}finally{k(!1)}}}return((0,r.useEffect)(()=>{let t=async()=>{try{var t;C(!0);let e=await fetch("/api/equipment/assignments?assignment_id=".concat(a));if(!e.ok)throw Error("Failed to load assignment");let s=(await e.json()).find(e=>e.id===a);if(!s)throw Error("Assignment not found");E(s),A.setValue("to_ts",s.to_ts?s.to_ts.slice(0,16):""),A.setValue("is_permanent",s.is_permanent),A.setValue("rental_cost_per_day",(null==(t=s.rental_cost_per_day)?void 0:t.toString())||"")}catch(t){console.error("Failed to load assignment:",t),h.toast.error("Failed to load assignment details"),e.push("/dashboard/equipment")}finally{C(!1)}};a&&t()},[a,A,e]),q)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(c.Loader2,{className:"h-8 w-8 animate-spin"})}):F?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)(x.Button,{variant:"ghost",size:"sm",onClick:()=>e.back(),className:"flex items-center",children:[(0,t.jsx)(l.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Edit Equipment Assignment"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Modify assignment details for ",F.equipment.name]})]})]})}),(0,t.jsx)(j.Separator,{}),(0,t.jsxs)(y.Card,{children:[(0,t.jsxs)(y.CardHeader,{children:[(0,t.jsxs)(y.CardTitle,{className:"flex items-center",children:[(0,t.jsx)(u.Wrench,{className:"h-5 w-5 mr-2"}),"Assignment Information"]}),(0,t.jsx)(y.CardDescription,{children:"Current assignment details (read-only)"})]}),(0,t.jsx)(y.CardContent,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Equipment"}),(0,t.jsxs)("div",{className:"flex items-center p-3 bg-muted rounded-md",children:[(0,t.jsx)(u.Wrench,{className:"h-4 w-4 mr-2"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:F.equipment.name}),F.equipment.inventory_no&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Inventory: ",F.equipment.inventory_no]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Project"}),(0,t.jsxs)("div",{className:"flex items-center p-3 bg-muted rounded-md",children:[(0,t.jsx)(p.Building2,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("div",{className:"font-medium",children:F.project_name||F.project_id})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Assigned Crew"}),(0,t.jsxs)("div",{className:"flex items-center p-3 bg-muted rounded-md",children:[(0,t.jsx)(m.Users,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("div",{className:"font-medium",children:F.crew_name||"Unassigned"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Start Date"}),(0,t.jsxs)("div",{className:"flex items-center p-3 bg-muted rounded-md",children:[(0,t.jsx)(d.Calendar,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("div",{className:"font-medium",children:new Date(F.from_ts).toLocaleString()})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Status"}),(0,t.jsx)("div",{children:(0,t.jsx)(b.Badge,{className:F.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:F.is_active?"Active":"Inactive"})})]})]})})]}),(0,t.jsx)("div",{className:"max-w-4xl",children:(0,t.jsx)(f.Form,{...A,children:(0,t.jsxs)("form",{onSubmit:A.handleSubmit(R),className:"space-y-8",children:[(0,t.jsxs)(y.Card,{children:[(0,t.jsxs)(y.CardHeader,{children:[(0,t.jsxs)(y.CardTitle,{className:"flex items-center",children:[(0,t.jsx)(d.Calendar,{className:"h-5 w-5 mr-2"}),"Edit Assignment Details"]}),(0,t.jsx)(y.CardDescription,{children:"Modify the assignment end date and rental cost"})]}),(0,t.jsxs)(y.CardContent,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsx)(f.FormField,{control:A.control,name:"to_ts",render:e=>{let{field:s}=e;return(0,t.jsxs)(f.FormItem,{children:[(0,t.jsx)(f.FormLabel,{children:"End Date & Time"}),(0,t.jsx)(f.FormControl,{children:(0,t.jsx)(g.Input,{type:"datetime-local",...s,disabled:A.watch("is_permanent")})}),(0,t.jsx)(f.FormDescription,{children:"When the assignment should end (leave empty for ongoing)"}),(0,t.jsx)(f.FormMessage,{})]})}}),(0,t.jsx)(f.FormField,{control:A.control,name:"rental_cost_per_day",render:e=>{let{field:s}=e;return(0,t.jsxs)(f.FormItem,{children:[(0,t.jsx)(f.FormLabel,{children:"Daily Rental Cost (€)"}),(0,t.jsx)(f.FormControl,{children:(0,t.jsx)(g.Input,{type:"number",step:"0.01",placeholder:"0.00",...s})}),(0,t.jsx)(f.FormDescription,{children:"Daily cost for this assignment"}),(0,t.jsx)(f.FormMessage,{})]})}})]}),(0,t.jsx)(f.FormField,{control:A.control,name:"is_permanent",render:e=>{let{field:s}=e;return(0,t.jsxs)(f.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,t.jsx)(f.FormControl,{children:(0,t.jsx)(v.Checkbox,{checked:s.value,onCheckedChange:e=>{s.onChange(e),e&&A.setValue("to_ts","")}})}),(0,t.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,t.jsx)(f.FormLabel,{children:"Permanent Assignment"}),(0,t.jsx)(f.FormDescription,{children:"Check if this is a permanent assignment (no end date)"})]}),(0,t.jsx)(f.FormMessage,{})]})}})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end space-x-4 pt-6",children:[(0,t.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>e.back(),disabled:_,children:"Cancel"}),(0,t.jsx)(x.Button,{type:"submit",disabled:_,children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Updating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Save,{className:"h-4 w-4 mr-2"}),"Update Assignment"]})})]})]})})})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Assignment not found"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"The assignment could not be loaded."}),(0,t.jsx)(x.Button,{onClick:()=>e.push("/dashboard/equipment"),className:"mt-4",children:"Back to Equipment"})]})}}]);